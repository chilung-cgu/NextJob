# ğŸ–¥ï¸ OpenBMC æ¶æ§‹è¤‡ç¿’

> é€™æ˜¯ä½ çš„å„ªå‹¢ï¼é¢è©¦æ™‚å¯ä»¥æ·±å…¥å±•ç¤ºä½ çš„å°ˆæ¥­

---

## ğŸ“Œ OpenBMC æ˜¯ä»€éº¼ï¼Ÿ

```
OpenBMC æ˜¯ä¸€å€‹ Linux åŸºé‡‘æœƒçš„é–‹æºå°ˆæ¡ˆï¼Œç”¨æ–¼ï¼š
- ä¼ºæœå™¨çš„ Baseboard Management Controller (BMC)
- æä¾›é ç«¯ç®¡ç†å’Œç›£æ§åŠŸèƒ½
- æ›¿ä»£å°ˆæœ‰çš„ BMC éŸŒé«”

ä¸»è¦è²¢ç»è€…ï¼š
- IBMã€Googleã€Facebookã€Microsoft
- Intelã€AMDã€NVIDIA
- Ampereã€Arm

ä½ çš„ OpenBMC ç¶“é©—å° NVIDIA/AMD éå¸¸æœ‰åƒ¹å€¼ï¼
```

---

## ğŸ”· OpenBMC æ•´é«”æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OpenBMC æ¶æ§‹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  Management Interfaces               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Redfish â”‚  â”‚  IPMI   â”‚  â”‚   SSH   â”‚  â”‚  WebUI â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â”‚            â”‚            â”‚            â”‚           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     D-Bus                            â”‚   â”‚
â”‚  â”‚     (phosphor-dbus-interfaces - å…±äº« API å®šç¾©)       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â”‚            â”‚            â”‚            â”‚           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Phosphor   â”‚ â”‚ Phosphor   â”‚ â”‚Phosphor â”‚ â”‚Phosphor â”‚     â”‚
â”‚  â”‚ Inventory  â”‚ â”‚   LED     â”‚ â”‚  Hwmon  â”‚ â”‚ Logging â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                 Linux Kernel                         â”‚   â”‚
â”‚  â”‚  (Device Drivers, I2C, SPI, GPIO, hwmon, etc.)      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  Hardware                            â”‚   â”‚
â”‚  â”‚  (CPU, GPU, DIMM, PSU, Fan, Sensors, etc.)          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”· æ ¸å¿ƒå…ƒä»¶è©³è§£

### 1. D-Bus

```
D-Bus æ˜¯ OpenBMC çš„æ ¸å¿ƒé€šè¨Šæ©Ÿåˆ¶ã€‚

é‡è¦æ¦‚å¿µï¼š
- Service Nameï¼šå¦‚ xyz.openbmc_project.Hwmon
- Object Pathï¼šå¦‚ /xyz/openbmc_project/sensors/temperature/cpu0
- Interfaceï¼šå¦‚ xyz.openbmc_project.Sensor.Value
- Propertyï¼šå¦‚ Value, Unit, Scale

å¸¸ç”¨å‘½ä»¤ï¼š
# åˆ—å‡ºæ‰€æœ‰æœå‹™
busctl list

# æŸ¥çœ‹æœå‹™çš„ç‰©ä»¶æ¨¹
busctl tree xyz.openbmc_project.Hwmon

# æŸ¥çœ‹ç‰©ä»¶çš„ä»‹é¢
busctl introspect xyz.openbmc_project.Hwmon /xyz/openbmc_project/sensors/temperature/cpu0

# è®€å–å±¬æ€§
busctl get-property xyz.openbmc_project.Hwmon /xyz/openbmc_project/sensors/temperature/cpu0 xyz.openbmc_project.Sensor.Value Value

# å‘¼å«æ–¹æ³•
busctl call xyz.openbmc_project.State.Host /xyz/openbmc_project/state/host0 xyz.openbmc_project.State.Host RequestedHostTransition s "xyz.openbmc_project.State.Host.Transition.On"
```

### 2. phosphor-dbus-interfaces

```
é€™å€‹ repository å®šç¾©äº† OpenBMC çš„ D-Bus APIã€‚

è·¯å¾‘çµæ§‹ï¼š
yaml/
â””â”€â”€ xyz/
    â””â”€â”€ openbmc_project/
        â”œâ”€â”€ Sensor/
        â”‚   â””â”€â”€ Value.interface.yaml
        â”œâ”€â”€ State/
        â”‚   â”œâ”€â”€ Host.interface.yaml
        â”‚   â””â”€â”€ Chassis.interface.yaml
        â””â”€â”€ Inventory/
            â””â”€â”€ Item.interface.yaml

Interface å®šç¾©ç¯„ä¾‹ï¼š
# xyz/openbmc_project/Sensor/Value.interface.yaml
description: A sensor value
properties:
  - name: Value
    type: double
    description: The sensor value
  - name: Unit
    type: string
    description: The unit of measurement
```

### 3. phosphor-hwmon

```
è² è²¬è®€å–ç¡¬é«”æ„Ÿæ¸¬å™¨æ•¸å€¼ã€‚

é‹ä½œæ–¹å¼ï¼š
1. è®€å– Linux hwmon sysfs (/sys/class/hwmon)
2. å°‡æ•¸å€¼é€é D-Bus ç™¼å¸ƒ
3. æä¾› Sensor.Value ä»‹é¢

è¨­å®šæª”ä½ç½®ï¼š
/etc/default/obmc/hwmon/

è¨­å®šæª”ç¯„ä¾‹ï¼š
# 48-0048.conf (I2C device at address 0x48)
LABEL_temp1=cpu0_temp
LABEL_temp2=cpu1_temp
```

### 4. phosphor-inventory-manager

```
ç®¡ç†ç³»çµ±ç¡¬é«”æ¸…å–®ã€‚

åŠŸèƒ½ï¼š
- è¿½è¹¤ç³»çµ±ä¸­çš„æ‰€æœ‰ç¡¬é«”å…ƒä»¶
- è¨˜éŒ„å…ƒä»¶ç‹€æ…‹ï¼ˆPresent, Functionalï¼‰
- æä¾› FRU (Field Replaceable Unit) è³‡è¨Š
```

### 5. phosphor-logging

```
è™•ç†ç³»çµ±æ—¥èªŒå’ŒéŒ¯èª¤ã€‚

åŠŸèƒ½ï¼š
- è¨˜éŒ„ç³»çµ±äº‹ä»¶
- ç®¡ç† SEL (System Event Log)
- é€é Redfish å’Œ IPMI æä¾›æ—¥èªŒå­˜å–
```

---

## ğŸ”· ç®¡ç†ä»‹é¢

### IPMI

```
IPMI (Intelligent Platform Management Interface)

å¸¸è¦‹æ“ä½œï¼š
# é›»æºæ§åˆ¶
ipmitool -I lanplus -H <bmc-ip> -U admin -P password power on
ipmitool -I lanplus -H <bmc-ip> -U admin -P password power off
ipmitool -I lanplus -H <bmc-ip> -U admin -P password power cycle

# è®€å–æ„Ÿæ¸¬å™¨
ipmitool -I lanplus -H <bmc-ip> -U admin -P password sensor list

# æŸ¥çœ‹ SEL
ipmitool -I lanplus -H <bmc-ip> -U admin -P password sel list

# SOL (Serial over LAN)
ipmitool -I lanplus -H <bmc-ip> -U admin -P password sol activate
```

### Redfish

```
Redfish æ˜¯ç¾ä»£çš„ RESTful API æ¨™æº–ã€‚

å„ªé»ï¼ˆç›¸è¼ƒæ–¼ IPMIï¼‰ï¼š
- åŸºæ–¼ HTTPSï¼Œæ›´å®‰å…¨
- JSON æ ¼å¼ï¼Œæ˜“æ–¼ä½¿ç”¨
- æ›´è±å¯Œçš„åŠŸèƒ½å’Œæ“´å±•æ€§

ç¯„ä¾‹ APIï¼š
# å–å¾—ç³»çµ±è³‡è¨Š
GET /redfish/v1/Systems/system

# å–å¾— Chassis è³‡è¨Š
GET /redfish/v1/Chassis/chassis

# å–å¾—æ„Ÿæ¸¬å™¨
GET /redfish/v1/Chassis/chassis/Sensors

# é›»æºæ§åˆ¶
POST /redfish/v1/Systems/system/Actions/ComputerSystem.Reset
{
    "ResetType": "On"
}
```

---

## ğŸ”· Build System (Yocto)

```
OpenBMC ä½¿ç”¨ Yocto Project ä½œç‚º build systemã€‚

é‡è¦ç›®éŒ„ï¼š
poky/              # Yocto æ ¸å¿ƒ
meta-openembedded/ # ç¤¾ç¾¤ layers
meta-phosphor/     # OpenBMC æ ¸å¿ƒ recipes
meta-xxx/          # å» å•†ç‰¹å®šçš„ layer

å¸¸ç”¨å‘½ä»¤ï¼š
# åˆå§‹åŒ– build ç’°å¢ƒ
source setup <machine>

# é–‹å§‹ build
bitbake obmc-phosphor-image

# Build å–®ä¸€ package
bitbake phosphor-hwmon

# é–‹ç™¼æ¨¡å¼
devtool modify phosphor-hwmon
devtool build phosphor-hwmon
devtool reset phosphor-hwmon
```

---

## ğŸ“ é¢è©¦æœƒå•çš„ OpenBMC å•é¡Œ

**Q1ï¼šOpenBMC çš„æ•´é«”æ¶æ§‹æ˜¯ä»€éº¼ï¼Ÿ**
```
OpenBMC æ˜¯ä¸€å€‹åŸºæ–¼ Linux çš„ BMC éŸŒé«”å°ˆæ¡ˆã€‚

æ¶æ§‹åˆ†å±¤ï¼š
1. Hardwareï¼šBMC SoCã€sensorsã€å…¶ä»–ç¡¬é«”
2. Linux Kernelï¼šæä¾› driverï¼ˆI2Cã€GPIOã€hwmonï¼‰
3. Phosphor Servicesï¼šé€é D-Bus æä¾›ç³»çµ±æœå‹™
4. Management Interfacesï¼šIPMIã€Redfishã€WebUI

æ ¸å¿ƒç‰¹é»æ˜¯ä½¿ç”¨ D-Bus ä½œç‚º IPC æ©Ÿåˆ¶ï¼Œ
æ‰€æœ‰æœå‹™é€é D-Bus ä»‹é¢äº’ç›¸æºé€šã€‚
```

**Q2ï¼šD-Bus åœ¨ OpenBMC ä¸­æ‰®æ¼”ä»€éº¼è§’è‰²ï¼Ÿ**
```
D-Bus æ˜¯ OpenBMC çš„æ ¸å¿ƒé€šè¨Šæ©Ÿåˆ¶ã€‚

åŠŸèƒ½ï¼š
1. æœå‹™ç™¼ç¾ï¼šæœå‹™å¯å‹•æ…‹è¨»å†Šå’Œç™¼ç¾
2. æ–¹æ³•å‘¼å«ï¼šé¡ä¼¼ RPC
3. å±¬æ€§å­˜å–ï¼šè®€å–å’Œè¨­å®šç‹€æ…‹
4. ä¿¡è™Ÿå»£æ’­ï¼šäº‹ä»¶é€šçŸ¥

å¥½è™•ï¼š
- é¬†è€¦åˆï¼šæœå‹™å¯ç¨ç«‹é–‹ç™¼å’Œæ›´æ–°
- æ¨™æº–åŒ–ï¼šçµ±ä¸€çš„ API å®šç¾©
- å¯ç›£æ§ï¼šbusctl å¯è§€å¯Ÿæ‰€æœ‰é€šè¨Š
```

**Q3ï¼šä½ åœ¨ OpenBMC åšéä»€éº¼åŠŸèƒ½ï¼Ÿï¼ˆæº–å‚™ä½ è‡ªå·±çš„æ•…äº‹ï¼ï¼‰**
```
ç¯„ä¾‹å›ç­”æ¡†æ¶ï¼ˆSTARï¼‰ï¼š

Situationï¼šæˆ‘å€‘éœ€è¦æ–°å¢ä¸€å€‹æº«åº¦æ„Ÿæ¸¬å™¨çš„æ”¯æ´...
Taskï¼šæˆ‘è² è²¬å¯¦ä½œ...
Actionï¼š
1. é¦–å…ˆç ”ç©¶äº† phosphor-hwmon çš„æ¶æ§‹
2. æ–°å¢äº† hwmon è¨­å®šæª”
3. é©—è­‰ D-Bus ä¸Šå¯ä»¥çœ‹åˆ° sensor æ•¸å€¼
4. å’Œ Redfish åœ˜éšŠç¢ºèª API æ­£ç¢ºå›å‚³
Resultï¼šæˆåŠŸä¸Šç·šï¼Œå®¢æˆ¶å¯ä»¥é€é Redfish ç›£æ§æº«åº¦...
```

**Q4ï¼šIPMI å’Œ Redfish çš„å·®ç•°ï¼Ÿ**
```
IPMIï¼š
- è¼ƒèˆŠçš„æ¨™æº–
- äºŒé€²ä½å”å®š
- å®‰å…¨æ€§è¼ƒå¼±
- åŠŸèƒ½è¼ƒå›ºå®š

Redfishï¼š
- ç¾ä»£ RESTful API
- JSON æ ¼å¼
- HTTPS åŠ å¯†
- æ“´å±•æ€§å¥½
- DMTF ç¶­è­·

è¶¨å‹¢ï¼šæ–°ç³»çµ±å„ªå…ˆä½¿ç”¨ Redfishï¼ŒIPMI ä¿æŒç›¸å®¹æ€§
```

**Q5ï¼šå¦‚ä½• debug OpenBMC å•é¡Œï¼Ÿ**
```
1. æŸ¥çœ‹æ—¥èªŒï¼š
   journalctl -f
   journalctl -u <service-name>

2. D-Bus ç›£æ§ï¼š
   busctl monitor
   busctl introspect <service> <object>

3. æ„Ÿæ¸¬å™¨ç›¸é—œï¼š
   cat /sys/class/hwmon/hwmon*/temp*_input
   
4. ç‹€æ…‹æª¢æŸ¥ï¼š
   systemctl status <service>

5. ç¶²è·¯å•é¡Œï¼š
   ip addr
   ping <host-ip>
```

---

## âœ… é¢è©¦å‰è¤‡ç¿’æ¸…å–®

```
â˜ èƒ½ç•«å‡º OpenBMC æ¶æ§‹åœ–
â˜ èƒ½è§£é‡‹ D-Bus çš„å·¥ä½œåŸç†
â˜ èƒ½èªªæ˜ phosphor-hwmon å¦‚ä½•å–å¾— sensor æ•¸æ“š
â˜ çŸ¥é“ IPMI å’Œ Redfish çš„å·®ç•°
â˜ æº–å‚™å¥½ 2-3 å€‹è‡ªå·±åšéçš„åŠŸèƒ½æ¡ˆä¾‹
â˜ æœƒä½¿ç”¨ busctl æŸ¥è©¢ D-Bus
â˜ çŸ¥é“ Yocto build system åŸºæœ¬æ“ä½œ
```
