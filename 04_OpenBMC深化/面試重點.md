# ğŸ¯ BMC ç›¸é—œé¢è©¦é‡é»

> é‡å° NVIDIA / AMD / Intel çš„ BMC éŸŒé«”è·ä½ç‰¹åˆ¥æº–å‚™  
> æœ¬æ–‡ä»¶æ¶µè“‹å¤–å•† IC åŸå» é¢è©¦æ‰€éœ€çš„æ·±åº¦æŠ€è¡“çŸ¥è­˜

---

## ğŸ“Œ BMC æ˜¯ä»€éº¼ï¼Ÿ

### ğŸ’¡ ç”Ÿæ´»åŒ–æ¯”å–»

```
æƒ³åƒä¼ºæœå™¨æ˜¯ä¸€æ¶é£›æ©Ÿï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä¼ºæœå™¨ = é£›æ©Ÿ                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  CPU/GPU = å¼•æ“        RAM = æ²¹ç®±       Disk = è²¨è‰™        â”‚
â”‚  OS = é£›è¡Œå“¡           Application = ä¹˜å®¢                   â”‚
â”‚                                                             â”‚
â”‚  é‚£ BMC æ˜¯ä»€éº¼ï¼Ÿ                                            â”‚
â”‚  BMC = é»‘ç›’å­ (Flight Recorder) + é ç«¯æ§åˆ¶å¡”                â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  BMC çš„åŠŸèƒ½ï¼š                                        â”‚   â”‚
â”‚  â”‚  âœ… å³ä½¿é£›æ©Ÿï¼ˆä¼ºæœå™¨ï¼‰å¼•æ“é—œé–‰ï¼Œä»å¯é‹ä½œ             â”‚   â”‚
â”‚  â”‚  âœ… è¨˜éŒ„æ‰€æœ‰äº‹ä»¶ï¼ˆSEL = System Event Logï¼‰           â”‚   â”‚
â”‚  â”‚  âœ… é ç«¯é–‹é—œæ©Ÿï¼ˆä¸ç”¨èµ°åˆ°æ©Ÿæˆ¿ï¼‰                       â”‚   â”‚
â”‚  â”‚  âœ… ç›£æ§æº«åº¦ã€é›»å£“ã€é¢¨æ‰‡ï¼ˆé£›æ©Ÿçš„å¥åº·æŒ‡æ¨™ï¼‰           â”‚   â”‚
â”‚  â”‚  âœ… ç·Šæ€¥æ™‚å¯æ¥ç®¡æ§åˆ¶ï¼ˆKVM over IP = é ç«¯é§•é§›è‰™ï¼‰     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”§ BMC ç¡¬é«”æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BMC ç¡¬é«”æ¶æ§‹è©³è§£                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚   BMC æ˜¯ä¸€å€‹ç¨ç«‹çš„åµŒå…¥å¼ç³»çµ±ï¼Œç„Šåœ¨ä¸»æ©Ÿæ¿ä¸Šï¼š                â”‚
â”‚                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  BMC SoCï¼ˆå¦‚ ASPEED AST2600ï¼‰                       â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚  â”‚  CPU: ARM Cortex-A7 é›™æ ¸å¿ƒ                  â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  RAM: 512MB ~ 1GB DDR4                      â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  Flash: 32~64MB SPI Flashï¼ˆå­˜éŸŒé«”ï¼‰         â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  ç¶²è·¯: Gigabit Ethernet (ç¨ç«‹æˆ–å…±äº«)        â”‚   â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â”‚                                                       â”‚   â”‚
â”‚   â”‚  ä»‹é¢ï¼š                                                â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚
â”‚   â”‚  â”‚  I2C   â”‚ â”‚  SPI   â”‚ â”‚  GPIO  â”‚ â”‚  UART  â”‚         â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â”‚   â”‚
â”‚   â”‚      â”‚         â”‚          â”‚          â”‚               â”‚   â”‚
â”‚   â”‚      â–¼         â–¼          â–¼          â–¼               â”‚   â”‚
â”‚   â”‚  Sensors   SPI Flash   Power/LED   Debug Console     â”‚   â”‚
â”‚   â”‚                                                       â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚   â”‚
â”‚   â”‚  â”‚  LPC   â”‚ â”‚  PCIe  â”‚ â”‚ Ethernetâ”‚                    â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                    â”‚   â”‚
â”‚   â”‚      â”‚         â”‚          â”‚                          â”‚   â”‚
â”‚   â”‚      â–¼         â–¼          â–¼                          â”‚   â”‚
â”‚   â”‚   Host CPU   High-speed  Network (Redfish/IPMI)      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Š BMC èˆ‡ Host çš„é€šè¨Šæ–¹å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    é€šè¨Šæ–¹å¼    â”‚                   èªªæ˜                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ LPC (Legacy)   â”‚ å‚³çµ±æ–¹å¼ï¼Œé€é KCS/BT channel å‚³é€ IPMI   â”‚
â”‚                â”‚ é€Ÿåº¦è¼ƒæ…¢ï¼Œä½†ç›¸å®¹æ€§å¥½                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PCIe (ç¾ä»£)    â”‚ é«˜é€Ÿé€šé“ï¼Œç”¨æ–¼ MCTP/PLDM                  â”‚
â”‚                â”‚ AST2600 é–‹å§‹æ”¯æ´                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ USB            â”‚ Virtual Mediaï¼ˆé ç«¯æ›è¼‰ ISOï¼‰             â”‚
â”‚                â”‚ Virtual Keyboard/Mouse                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ I2C/SMBus      â”‚ è®€å– Host CPU æº«åº¦ï¼ˆPECI è½‰æ›ï¼‰           â”‚
â”‚                â”‚ å­˜å– DIMM SPDã€Host GPIO                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GPIO           â”‚ é›»æºæ§åˆ¶è¨Šè™Ÿ (Power Button, Reset)        â”‚
â”‚                â”‚ é›»æºç‹€æ…‹ (Power Good, SLP_S3)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ UART           â”‚ SOL (Serial over LAN) - Host Console      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”· BMC ç›¸é—œå”å®šï¼ˆæ·±å…¥ç‰ˆï¼‰

### IPMIï¼ˆé¢è©¦å¿…è€ƒï¼ï¼‰

```
IPMI (Intelligent Platform Management Interface)
ç”± Intel æ–¼ 1998 å¹´åˆ¶å®šï¼Œæ˜¯ BMC çš„å‚³çµ±æ¨™æº–å”å®šã€‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     IPMI æ¶æ§‹                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  Remote Client  â”‚     â”‚      Host       â”‚               â”‚
â”‚  â”‚  (ipmitool)     â”‚     â”‚   (OS è£¡é¢)     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚           â”‚                       â”‚                         â”‚
â”‚           â”‚ RMCP/RMCP+            â”‚ KCS/BT/SSIF             â”‚
â”‚           â”‚ (LAN, UDP 623)        â”‚ (LPC/PCIe)              â”‚
â”‚           â”‚                       â”‚                         â”‚
â”‚           â–¼                       â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     BMC                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚              IPMI Message Handler              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   NetFn + CMD â†’ å°æ‡‰çš„è™•ç†å‡½æ•¸                 â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**NetFn (Network Function) è©³è§£ï¼š**
| NetFn | åç¨± | èªªæ˜ |
| :--- | :--- | :--- |
| 0x00 | Chassis | é›»æºæ§åˆ¶ã€Chassis ç‹€æ…‹ |
| 0x04 | Sensor/Event | æ„Ÿæ¸¬å™¨è®€å–ã€äº‹ä»¶ |
| 0x06 | App | BMC è³‡è¨Šã€Watchdog |
| 0x0A | Storage | SELã€SDRã€FRU |
| 0x0C | Transport | LAN è¨­å®š |
| 0x2C | Group Extension | DCMIã€SMBIOS |
| 0x2E | OEM/Group | å„å» å•†è‡ªå®šç¾©æŒ‡ä»¤ |
| 0x30+ | OEM | å» å•†å°ˆç”¨ |

**å¸¸ç”¨ IPMI Commandsï¼ˆé¢è©¦é«˜é »ï¼ï¼‰ï¼š**
```bash
# é›»æºæ§åˆ¶
ipmitool power on      # Chassis Ctrl (0x00, 0x02), Data: 0x01
ipmitool power off     # Chassis Ctrl (0x00, 0x02), Data: 0x00
ipmitool power cycle   # Chassis Ctrl (0x00, 0x02), Data: 0x02
ipmitool power status  # Get Chassis Status (0x00, 0x01)

# æ„Ÿæ¸¬å™¨
ipmitool sensor list   # Get Sensor Reading (0x04, 0x2D)
ipmitool sdr list      # Get SDR (0x0A, 0x23)

# SEL (System Event Log)
ipmitool sel list      # Get SEL Entry (0x0A, 0x43)
ipmitool sel clear     # Clear SEL (0x0A, 0x47)

# FRU (Field Replaceable Unit)
ipmitool fru print     # Read FRU Data (0x0A, 0x11)

# BMC è³‡è¨Š
ipmitool mc info       # Get Device ID (0x06, 0x01)
ipmitool mc reset cold # Cold Reset (0x06, 0x02)

# SOL (Serial over LAN)
ipmitool sol activate  # é€£æ¥ Host Console
```

**IPMI å®‰å…¨æ€§å•é¡Œï¼ˆé¢è©¦å¿…çŸ¥ï¼ï¼‰ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ IPMI å®‰å…¨æ€§å¼±é»ï¼ˆç‚ºä»€éº¼è¦ç”¨ Redfish å–ä»£ï¼‰              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Cipher Suite 0 æ¼æ´ï¼ˆCVE-2013-4786ï¼‰                   â”‚
â”‚     - å…è¨±ç„¡èªè­‰å­˜å–ï¼                                      â”‚
â”‚     - å¾ˆå¤šå¯¦ä½œé è¨­å•Ÿç”¨                                      â”‚
â”‚                                                             â”‚
â”‚  2. IPMI v1.5 å¯†ç¢¼å•é¡Œ                                      â”‚
â”‚     - å¯†ç¢¼ä»¥æ˜æ–‡æˆ–å¼±åŠ å¯†å‚³è¼¸                                â”‚
â”‚     - å®¹æ˜“è¢«å—…æ¢                                            â”‚
â”‚                                                             â”‚
â”‚  3. IPMI v2.0 RMCP+ ä»æœ‰å•é¡Œ                                â”‚
â”‚     - RAKP å”å®šæœ‰å·²çŸ¥å¼±é»                                   â”‚
â”‚     - å¯†ç¢¼ Hash å¯è¢«é›¢ç·šæš´åŠ›ç ´è§£                            â”‚
â”‚                                                             â”‚
â”‚  4. é è¨­å¯†ç¢¼                                                â”‚
â”‚     - å¾ˆå¤š BMC ä½¿ç”¨é è¨­çš„ admin/admin                       â”‚
â”‚                                                             â”‚
â”‚  çµè«–ï¼šåœ¨å®‰å…¨æ•æ„Ÿç’°å¢ƒï¼Œæ‡‰è©²ä½¿ç”¨ Redfish (HTTPS) å–ä»£ IPMI   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### IPMI æ·±å…¥ï¼šKCS/BT Channel å¯¦ä½œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   IPMI System Interface                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  IPMI å®šç¾©ä¸‰ç¨® Host â†” BMC çš„ System Interfaceï¼š             â”‚
â”‚                                                             â”‚
â”‚  1. KCS (Keyboard Controller Style)                         â”‚
â”‚     - æœ€å¸¸è¦‹çš„å¯¦ä½œæ–¹å¼                                       â”‚
â”‚     - ä½¿ç”¨ LPC I/O Port å­˜å–                                 â”‚
â”‚     - å…¸å‹ I/O Port: 0xCA2 (Data), 0xCA3 (Cmd/Status)        â”‚
â”‚     - æ²¿ç”¨éµç›¤æ§åˆ¶å™¨çš„æš«å­˜å™¨çµæ§‹                             â”‚
â”‚                                                             â”‚
â”‚  2. BT (Block Transfer)                                      â”‚
â”‚     - è¼ƒå¿«çš„è³‡æ–™å‚³è¼¸                                         â”‚
â”‚     - æ”¯æ´å¤šå­—ç¯€æ‰¹æ¬¡å‚³è¼¸                                     â”‚
â”‚     - å…¸å‹ I/O Port: 0xE4 (Data), 0xE5 (Ctrl)                â”‚
â”‚                                                             â”‚
â”‚  3. SSIF (SMBus System Interface)                            â”‚
â”‚     - é€é SMBusï¼ˆI2Cï¼‰é€šè¨Š                                  â”‚
â”‚     - ä¸éœ€è¦ LPCï¼Œé©åˆæŸäº›æ¶æ§‹                               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**KCS Interface æš«å­˜å™¨çµæ§‹ï¼š**
```c
/* KCS Interface Registers */
/* ä»¥ AST2600 ç‚ºä¾‹ï¼ŒBase I/O = 0xCA2 */

/* Status Register (I/O Offset: 0x01) */
/*
 * Bit 7 (S1)  : State (èˆ‡ S0 çµ„åˆæˆç‹€æ…‹æ©Ÿ)
 * Bit 6 (S0)  : State
 * Bit 5       : Reserved
 * Bit 4 (CD)  : Command/Data - 1=Command, 0=Data
 * Bit 3 (SMS_ATN): BMC æœ‰è³‡æ–™è¦å›å‚³
 * Bit 2 (IBF) : Input Buffer Full - Host å¯«å…¥å¾Œè¨­ç‚º 1
 * Bit 1 (Reserved)
 * Bit 0 (OBF) : Output Buffer Full - BMC å¯«å…¥å¾Œè¨­ç‚º 1
 *
 * ç‹€æ…‹çµ„åˆ (S1:S0):
 *   00 = Idle State
 *   01 = Read State
 *   10 = Write State
 *   11 = Error State
 */

/* Host â†’ BMC ç™¼é€ IPMI Request æµç¨‹ */
/*
 * 1. ç­‰å¾… IBF = 0ï¼ˆç¢ºä¿å‰ä¸€ç­†è³‡æ–™è™•ç†å®Œï¼‰
 * 2. å¯«å…¥ WRITE_START (0x61) åˆ° Command Register
 * 3. ç­‰å¾… IBF = 0
 * 4. ä¾åºå¯«å…¥è³‡æ–™ï¼š
 *    - NetFn/LUN (1 byte)
 *    - Command (1 byte)
 *    - Data (0-N bytes)
 * 5. æ¯æ¬¡å¯«å…¥å¾Œç­‰å¾… IBF = 0
 * 6. æœ€å¾Œå¯«å…¥ WRITE_END (0x62)
 * 7. ç­‰å¾…ç‹€æ…‹è®Šç‚º Read State (S1:S0 = 01)
 * 8. è®€å– Response è³‡æ–™
 */

/* Linux Kernel KCS Driver ä½ç½® */
/* drivers/char/ipmi/ipmi_kcs_sm.c - KCS ç‹€æ…‹æ©Ÿå¯¦ä½œ */
/* drivers/char/ipmi/ipmi_si_intf.c - IPMI SI interface */
```

**BT Interface æš«å­˜å™¨çµæ§‹ï¼š**
```c
/* BT Interface Registers */
/* Block Transfer æ¯” KCS æ›´æœ‰æ•ˆç‡ */

/* æš«å­˜å™¨ï¼š
 * - BT_CTRL: Control Register
 * - BT_BMC2HOST_BUF: BMCâ†’Host è³‡æ–™ç·©è¡
 * - BT_HOST2BMC_BUF: Hostâ†’BMC è³‡æ–™ç·©è¡
 * - BT_INTMASK: ä¸­æ–·é®ç½©
 */

/* å‚³è¼¸å„ªå‹¢ï¼š
 * - å¯å–®æ¬¡å‚³è¼¸æ•´å€‹ Messageï¼ˆä¸ç”¨é€ byte ç­‰å¾…ï¼‰
 * - BMC å’Œ Host å„æœ‰ç¨ç«‹çš„ 256-byte ç·©è¡å€
 * - æ”¯æ´ä¸­æ–·é©…å‹•ï¼ˆä¸éœ€ Pollingï¼‰
 */

/* OpenBMC BT è¨­å®š (Device Tree) */
/*
 * ipmb@15d00000 {
 *     compatible = "aspeed,ast2600-ipmb";
 *     reg = <0x15d00000 0x1000>;
 *     interrupts = <GIC_SPI 143 IRQ_TYPE_LEVEL_HIGH>;
 *     aspeed,lpc-io-reg = <0xe4>;
 * };
 */
```

### IPMI å®Œæ•´ NetFn/CMD åƒè€ƒ

| NetFn | CMD | æè¿° |
| :--- | :--- | :--- |
| **Chassis (NetFn = 0x00)** | | |
| 0x00 | 0x00 | Get Chassis Capabilities |
| 0x00 | 0x01 | Get Chassis Status |
| 0x00 | 0x02 | Chassis Control (Power On/Off/Cycle/Reset) |
| 0x00 | 0x03 | Chassis Reset |
| 0x00 | 0x04 | Chassis Identify (LED é–ƒçˆ) |
| 0x00 | 0x05 | Set Chassis Capabilities |
| 0x00 | 0x06 | Set Power Restore Policy |
| 0x00 | 0x07 | Get System Restart Cause |
| 0x00 | 0x08 | Set System Boot Options |
| 0x00 | 0x09 | Get System Boot Options |
| 0x00 | 0x0F | Get POH Counter (Power-On Hours) |
| **Sensor/Event (NetFn = 0x04)** | | |
| 0x04 | 0x10 | Sensor Event Enable |
| 0x04 | 0x20 | Get Device SDR Info |
| 0x04 | 0x21 | Get Device SDR |
| 0x04 | 0x22 | Reserve Device SDR |
| 0x04 | 0x2D | Get Sensor Reading (â˜…æœ€å¸¸ç”¨ï¼) |
| 0x04 | 0x2E | Get Sensor Type |
| 0x04 | 0x2F | Get Sensor Threshold |
| 0x04 | 0x30 | Set Sensor Threshold |
| **App (NetFn = 0x06)** | | |
| 0x06 | 0x01 | Get Device ID (â˜…å¾ˆå¸¸ç”¨ï¼æŸ¥ BMC ç‰ˆæœ¬) |
| 0x06 | 0x02 | Cold Reset |
| 0x06 | 0x03 | Warm Reset |
| 0x06 | 0x24 | Get Watchdog Timer |
| 0x06 | 0x25 | Set Watchdog Timer |
| 0x06 | 0x38 | Get Channel Authentication Capabilities |
| 0x06 | 0x39 | Get Session Challenge |
| 0x06 | 0x3A | Activate Session |
| 0x06 | 0x3B | Set Session Privilege Level |
| 0x06 | 0x3C | Close Session |
| **Storage (NetFn = 0x0A)** | | |
| 0x0A | 0x10 | Get FRU Inventory Area Info |
| 0x0A | 0x11 | Read FRU Data |
| 0x0A | 0x12 | Write FRU Data |
| 0x0A | 0x20 | Get SDR Repository Info |
| 0x0A | 0x21 | Get SDR Repository Allocation Info |
| 0x0A | 0x22 | Reserve SDR Repository |
| 0x0A | 0x23 | Get SDR (â˜…è®€å–æ„Ÿæ¸¬å™¨å®šç¾©) |
| 0x0A | 0x40 | Get SEL Info |
| 0x0A | 0x41 | Get SEL Allocation Info |
| 0x0A | 0x42 | Reserve SEL |
| 0x0A | 0x43 | Get SEL Entry (â˜…è®€å–äº‹ä»¶æ—¥èªŒ) |
| 0x0A | 0x44 | Add SEL Entry |
| 0x0A | 0x47 | Clear SEL |
| **OEM (NetFn = 0x30-0x3F)** | | |
| 0x30 | varies | å» å•†è‡ªå®šç¾©å‘½ä»¤ï¼ˆè¦‹ä¸‹æ–¹èªªæ˜ï¼‰ |
| ... | ... | |
| 0x3E | varies | å» å•†è‡ªå®šç¾©å‘½ä»¤ |

### IPMI OEM Command è¨­è¨ˆ

```c
/* OEM Command ç¯„ä¾‹ - Meta/Facebook é¢¨æ ¼ */

/* OEM NetFn å®šç¾© */
#define NETFN_OEM              0x30      /* Meta ä½¿ç”¨ 0x30 */
#define NETFN_OEM_NVIDIA       0x3C      /* NVIDIA ä½¿ç”¨ 0x3C */

/* OEM Command çµæ§‹ */
/*
 * Request:
 *   Byte 1-3: Manufacturer ID (IANA Number)
 *             Meta = 0x00 0x75 0x4B (0x4B7500)
 *   Byte 4:   OEM Command Code
 *   Byte 5+:  Command-specific Data
 *
 * Response:
 *   Byte 1:   Completion Code
 *   Byte 2-4: Manufacturer ID (Echo)
 *   Byte 5+:  Response Data
 */

/* ç¯„ä¾‹ï¼šè®€å– Meta å¹³å°ç‰¹å®šè³‡è¨Š */
/* Request: 30 00 4B 75 00 01  (NetFn=0x30, CMD=0x00, IANA=Meta, SubCmd=0x01) */

/* OpenBMC OEM Handler å¯¦ä½œä½ç½® */
/* openbmc/phosphor-host-ipmid ä¸­çš„ oemhandler.cpp */

/* å¯¦ä½œç¯„ä¾‹ */
namespace ipmi
{

static ipmi::RspType<uint8_t, std::vector<uint8_t>>
    oemGetPlatformId(ipmi::Context::ptr ctx)
{
    // å›å‚³å¹³å°è­˜åˆ¥ç¢¼
    std::vector<uint8_t> platformId = {0x59, 0x34};  // "Y4" = Yosemite 4
    return ipmi::responseSuccess(0x00, platformId);
}

void registerOemFunctions()
{
    ipmi::registerHandler(ipmi::prioOemBase,
                          NETFN_OEM,
                          CMD_OEM_GET_PLATFORM_ID,
                          ipmi::Privilege::Admin,
                          oemGetPlatformId);
}

} // namespace ipmi
```

### IPMI SDR (Sensor Data Record) çµæ§‹

```c
/* SDR ç”¨æ–¼æè¿°ç³»çµ±ä¸­çš„æ„Ÿæ¸¬å™¨ */

/* SDR Header (æ‰€æœ‰ SDR éƒ½æœ‰) */
struct sdr_header {
    uint16_t record_id;      /* Record ID (å‹•æ…‹åˆ†é…) */
    uint8_t  sdr_version;    /* SDR Version (0x51 for IPMI 2.0) */
    uint8_t  record_type;    /* Type 01=Full, 02=Compact, 03=Event-Only */
    uint8_t  record_length;  /* å¾ŒçºŒè³‡æ–™é•·åº¦ */
} __attribute__((packed));

/* SDR Type 01: Full Sensor Record (æœ€å¸¸è¦‹) */
struct sdr_full_record {
    struct sdr_header header;
    
    /* Key (ç”¨æ–¼è­˜åˆ¥æ„Ÿæ¸¬å™¨) */
    uint8_t  owner_id;       /* Sensor æ‰€å±¬çš„ Slave Address */
    uint8_t  owner_lun;      /* LUN */
    uint8_t  sensor_number;  /* Sensor Number (å”¯ä¸€è­˜åˆ¥) */
    
    /* Entity Information */
    uint8_t  entity_id;      /* 0x07=System Board, 0x0B=Add-in Card */
    uint8_t  entity_instance;
    
    /* Sensor Info */
    uint8_t  sensor_init;    /* åˆå§‹åŒ–è¨­å®š */
    uint8_t  sensor_caps;    /* èƒ½åŠ› (Threshold support) */
    uint8_t  sensor_type;    /* 0x01=Temperature, 0x02=Voltage */
    uint8_t  event_type;     /* Event/Reading Type */
    
    /* Thresholds */
    uint8_t  upper_critical;
    uint8_t  upper_non_critical;
    uint8_t  lower_non_critical;
    uint8_t  lower_critical;
    
    /* Conversion Formula: y = (M * x + B) * 10^K */
    uint8_t  m_lsb;          /* M å€¼ä½ 8 ä½ */
    uint8_t  m_msb_tolerance;
    uint8_t  b_lsb;          /* B å€¼ä½ 8 ä½ */
    uint8_t  b_msb_accuracy;
    uint8_t  r_exp_b_exp;    /* æŒ‡æ•¸ K */
    
    /* Sensor Name (æœ€å¤š 16 bytes) */
    uint8_t  id_type_len;    /* Bit 7:6 = Type, Bit 4:0 = Length */
    char     id_string[16];  /* Sensor åç¨± */
} __attribute__((packed));

/* ipmitool è®€å– SDR ç¯„ä¾‹ */
/*
 * $ ipmitool sdr list
 * CPU0 Temp        | 45 degrees C    | ok
 * Inlet Temp       | 28 degrees C    | ok
 * PSU0 Power       | 350 Watts       | ok
 * Fan0             | 6000 RPM        | ok
 *
 * $ ipmitool sdr get "CPU0 Temp"
 * Sensor ID              : CPU0 Temp (0x01)
 * Entity ID              : 7.1 (System Board)
 * Sensor Type            : Temperature
 * Sensor Reading         : 45 (+/- 0) degrees C
 * Status                 : ok
 * Upper non-critical     : 80.000
 * Upper critical         : 90.000
 */
```

### Redfishï¼ˆé¢è©¦å¿…è€ƒï¼ï¼‰

Redfish æ˜¯ DMTF åˆ¶å®šçš„ç¾ä»£ RESTful API æ¨™æº–ï¼ˆ2015å¹´ï¼‰ã€‚
ç›®æ¨™æ˜¯å–ä»£ IPMIï¼Œæˆç‚ºä¼ºæœå™¨ç®¡ç†çš„æ–°æ¨™æº–ã€‚

**Redfish æ¶æ§‹åœ–ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Redfish API æ¶æ§‹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  /redfish/v1/                                               â”‚
â”‚  â”œâ”€â”€ Systems/                # ä¸»æ©Ÿç³»çµ±                     â”‚
â”‚  â”‚   â””â”€â”€ system/                                            â”‚
â”‚  â”‚       â”œâ”€â”€ Processors/     # CPU è³‡è¨Š                     â”‚
â”‚  â”‚       â”œâ”€â”€ Memory/         # è¨˜æ†¶é«”è³‡è¨Š                   â”‚
â”‚  â”‚       â”œâ”€â”€ Storage/        # å„²å­˜è£ç½®                     â”‚
â”‚  â”‚       â”œâ”€â”€ NetworkInterfaces/                             â”‚
â”‚  â”‚       â””â”€â”€ Actions/        # é›»æºæ§åˆ¶                     â”‚
â”‚  â”‚           â””â”€â”€ ComputerSystem.Reset                       â”‚
â”‚  â”‚                                                          â”‚
â”‚  â”œâ”€â”€ Chassis/                # æ©Ÿç®±                         â”‚
â”‚  â”‚   â””â”€â”€ chassis/                                           â”‚
â”‚  â”‚       â”œâ”€â”€ Thermal/        # æº«åº¦ã€é¢¨æ‰‡                   â”‚
â”‚  â”‚       â”‚   â”œâ”€â”€ Temperatures/                              â”‚
â”‚  â”‚       â”‚   â””â”€â”€ Fans/                                      â”‚
â”‚  â”‚       â”œâ”€â”€ Power/          # é›»æºã€é›»å£“                   â”‚
â”‚  â”‚       â”‚   â”œâ”€â”€ PowerSupplies/                             â”‚
â”‚  â”‚       â”‚   â””â”€â”€ Voltages/                                  â”‚
â”‚  â”‚       â””â”€â”€ Sensors/        # æ‰€æœ‰æ„Ÿæ¸¬å™¨ï¼ˆæ–°ç‰ˆï¼‰           â”‚
â”‚  â”‚                                                          â”‚
â”‚  â”œâ”€â”€ Managers/               # BMC æœ¬èº«                     â”‚
â”‚  â”‚   â””â”€â”€ bmc/                                               â”‚
â”‚  â”‚       â”œâ”€â”€ NetworkProtocol/  # ç¶²è·¯å”å®šè¨­å®š               â”‚
â”‚  â”‚       â”œâ”€â”€ LogServices/      # BMC Log                    â”‚
â”‚  â”‚       â””â”€â”€ VirtualMedia/     # è™›æ“¬åª’é«”                   â”‚
â”‚  â”‚                                                          â”‚
â”‚  â”œâ”€â”€ AccountService/         # å¸³è™Ÿç®¡ç†                     â”‚
â”‚  â”œâ”€â”€ SessionService/         # ç™»å…¥ Session                 â”‚
â”‚  â”œâ”€â”€ EventService/           # äº‹ä»¶è¨‚é–±                     â”‚
â”‚  â”œâ”€â”€ UpdateService/          # éŸŒé«”æ›´æ–°                     â”‚
â”‚  â””â”€â”€ CertificateService/     # æ†‘è­‰ç®¡ç†                     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¸¸ç”¨ Redfish API æ“ä½œï¼ˆé¢è©¦æœƒå•ï¼ï¼‰ï¼š**
```bash
# å–å¾—ç³»çµ±è³‡è¨Š
curl -k -u root:password https://bmc-ip/redfish/v1/Systems/system

# é›»æºæ§åˆ¶ - é–‹æ©Ÿ
curl -k -u root:password \
  -X POST \
  -H "Content-Type: application/json" \
  -d '{"ResetType": "On"}' \
  https://bmc-ip/redfish/v1/Systems/system/Actions/ComputerSystem.Reset

# é›»æºæ§åˆ¶ - é—œæ©Ÿ
curl -k -u root:password \
  -X POST \
  -H "Content-Type: application/json" \
  -d '{"ResetType": "ForceOff"}' \
  https://bmc-ip/redfish/v1/Systems/system/Actions/ComputerSystem.Reset

# è®€å–æº«åº¦æ„Ÿæ¸¬å™¨
curl -k -u root:password \
  https://bmc-ip/redfish/v1/Chassis/chassis/Thermal

# è®€å–é›»æºç‹€æ…‹
curl -k -u root:password \
  https://bmc-ip/redfish/v1/Chassis/chassis/Power

# éŸŒé«”æ›´æ–°
curl -k -u root:password \
  -X POST \
  -H "Content-Type: application/octet-stream" \
  --data-binary @firmware.bin \
  https://bmc-ip/redfish/v1/UpdateService/update

# è¨‚é–±äº‹ä»¶ï¼ˆEventServiceï¼‰
curl -k -u root:password \
  -X POST \
  -H "Content-Type: application/json" \
  -d '{
    "Destination": "https://my-server:8080/events",
    "Protocol": "Redfish",
    "EventTypes": ["Alert", "StatusChange"]
  }' \
  https://bmc-ip/redfish/v1/EventService/Subscriptions
```

**Redfish vs IPMI æ¯”è¼ƒï¼ˆèƒŒèµ·ä¾†ï¼ï¼‰ï¼š**
| | IPMI | Redfish |
| :--- | :--- | :--- |
| **å¹´ä»½** | 1998 | 2015 |
| **æ ¼å¼** | äºŒé€²ä½ | JSON |
| **å‚³è¼¸** | UDP 623 / KCS | HTTPS (TCP 443) |
| **å®‰å…¨æ€§** | å¼±ï¼ˆæ˜æ–‡/å¼±åŠ å¯†ï¼‰ | å¼·ï¼ˆTLS + Tokenï¼‰ |
| **æ“´å±•æ€§** | OEM Command | Schema + OEM |
| **å¯è®€æ€§** | éœ€è¦å·¥å…·è§£æ | äººé¡å¯è®€ |
| **é™¤éŒ¯** | Wireshark + è§£ç¢¼ | curl å³å¯ |
| **äº‹ä»¶é€šçŸ¥** | PET (SNMP trap) | EventService (SSE) |
| **æ¨™æº–çµ„ç¹”** | Intel â†’ DMTF | DMTF |

### Redfish æ·±å…¥ï¼šSchema è¨­è¨ˆ

Redfish ä½¿ç”¨ JSON Schema å®šç¾© API çµæ§‹ï¼š

Schema ä¾†æºï¼š
1. DMTF æ¨™æº– Schemaï¼ˆå¤§å¤šæ•¸åŠŸèƒ½ï¼‰
   https://redfish.dmtf.org/schemas/

2. OEM Extensionï¼ˆå» å•†æ“´å±•ï¼‰
   /redfish/v1/Schemas/OEM/xxx

Schema ç‰ˆæœ¬ç®¡ç†ï¼š
- æ¯å€‹ Resource æœ‰ç‰ˆæœ¬è™Ÿï¼Œå¦‚ 1.14.0
- æ ¼å¼ï¼šResource.vX_Y_Z.Schema
- å‘å¾Œç›¸å®¹ï¼šæ–°ç‰ˆå¿…é ˆæ”¯æ´èˆŠç‰ˆ client

**Redfish Schema ç¯„ä¾‹ï¼ˆThermalï¼‰ï¼š**
```json
{
    "@odata.type": "#Thermal.v1_7_0.Thermal",
    "@odata.id": "/redfish/v1/Chassis/chassis/Thermal",
    "Name": "Thermal",
    "Temperatures": [
        {
            "@odata.id": "/redfish/v1/Chassis/chassis/Thermal#/Temperatures/0",
            "MemberId": "0",
            "Name": "CPU0_Temp",
            "Status": {
                "State": "Enabled",
                "Health": "OK"
            },
            "ReadingCelsius": 45.0,
            "UpperThresholdCritical": 95.0,
            "UpperThresholdNonCritical": 80.0,
            "MinReadingRangeTemp": 0,
            "MaxReadingRangeTemp": 127,
            "PhysicalContext": "CPU"
        },
        {
            "@odata.id": "/redfish/v1/Chassis/chassis/Thermal#/Temperatures/1",
            "MemberId": "1",
            "Name": "GPU0_Temp",
            "ReadingCelsius": 55.0,
            "UpperThresholdCritical": 90.0,
            "PhysicalContext": "GPU"
        }
    ],
    "Fans": [
        {
            "@odata.id": "/redfish/v1/Chassis/chassis/Thermal#/Fans/0",
            "MemberId": "0",
            "Name": "System_Fan0",
            "Reading": 6500,
            "ReadingUnits": "RPM",
            "Status": {
                "State": "Enabled",
                "Health": "OK"
            }
        }
    ]
}
```

### Redfish æ·±å…¥ï¼šOEM Extension

OEM Extension å…è¨±å» å•†åœ¨æ¨™æº– Redfish å¤–æ–°å¢è‡ªè¨‚æ¬„ä½ã€‚

æ¨™æº–è¦ç¯„ï¼š
- OEM æ¬„ä½å¿…é ˆæ”¾åœ¨ "Oem" ç‰©ä»¶ä¸‹
- æ ¼å¼ï¼š{"Oem": {"VendorName": {...}}}
- VendorName æ‡‰è©²æ˜¯ IANA è¨»å†Šçš„å» å•†åç¨±

å¸¸è¦‹å» å•†ï¼š
- OpenBmc (OpenBMC ç¤¾ç¾¤)
- Facebook (Meta)
- Nvidia
- Intel

**OEM Extension ç¯„ä¾‹ï¼š**
```json
{
    "@odata.type": "#Sensor.v1_1_0.Sensor",
    "@odata.id": "/redfish/v1/Chassis/chassis/Sensors/GPU0_Power",
    "Name": "GPU0_Power",
    "Reading": 350.5,
    "ReadingUnits": "W",
    
    "Oem": {
        "OpenBmc": {
            "@odata.type": "#OpenBmcSensor.v1_0_0.OpenBmcSensor",
            "SensorType": "Power",
            "DbusPath": "/xyz/openbmc_project/sensors/power/GPU0_Power"
        },
        "Nvidia": {
            "@odata.type": "#NvidiaSensor.v1_0_0.NvidiaSensor",
            "NVLinkStatus": "Active",
            "ThermalThrottlePercentage": 0
        }
    }
}
```

**bmcweb æ–°å¢ OEM Extensionï¼š**
```cpp
// åœ¨ bmcweb ä¸­æ–°å¢ OEM æ¬„ä½

// ä½ç½®ï¼šredfish-core/lib/sensors.hpp
void getOemProperties(
    const std::shared_ptr<SensorContext>& ctx,
    nlohmann::json& response)
{
    // æ–°å¢ OpenBmc OEM æ¬„ä½
    response["Oem"]["OpenBmc"]["@odata.type"] = 
        "#OpenBmcSensor.v1_0_0.OpenBmcSensor";
    response["Oem"]["OpenBmc"]["DbusPath"] = ctx->dbusPath;
    
    // æ–°å¢å» å•†ç‰¹å®šæ¬„ä½
    if (ctx->sensorType == "gpu")
    {
        response["Oem"]["Nvidia"]["NVLinkStatus"] = "Active";
    }
}
```

### Redfish æ·±å…¥ï¼šEventService èˆ‡ SSE

EventService æ˜¯ Redfish çš„äº‹ä»¶é€šçŸ¥æ©Ÿåˆ¶ã€‚

é€šçŸ¥æ–¹å¼ï¼š
1. Server-Sent Events (SSE)
   - **æ©Ÿåˆ¶**ï¼šClient ä¸»å‹•é€£ä¸Š Serverï¼Œä¸¦ä¿æŒé€£ç·šï¼ˆè¨‚é–±åˆ¶ï¼‰ã€‚
   - **æ¯”å–»**ï¼šåƒè¨‚é–±é›œèªŒã€‚ä½ å¡«å¥½è¨‚é–±å–®ï¼ˆå»ºç«‹é€£ç·šï¼‰ï¼Œä»¥å¾Œæœ‰æ–°é›œèªŒï¼ˆEventï¼‰ï¼Œå‡ºç‰ˆç¤¾ç›´æ¥å¯„çµ¦ä½ ï¼Œä¸ç”¨ä½ é€™æ¯å¤©å»æ›¸åº—å•ã€‚
   - **å„ªé»**ï¼šå³æ™‚ã€é˜²ç«ç‰†é€šå¸¸å…è¨±ï¼ˆClient å¾€å¤–é€£ï¼‰ã€‚
   - **æ¨è–¦**ï¼šRedfish å®˜æ–¹æ¨è–¦æ–¹å¼ï¼Œé©åˆç€è¦½å™¨æˆ– Dashboard ç›£æ§ã€‚

2. Webhook (HTTP POST)
   - **æ©Ÿåˆ¶**ï¼šServer (BMC) ä¸»å‹•ç™¼é€ request åˆ° Client æŒ‡å®šçš„ URLã€‚
   - **æ¯”å–»**ï¼šåƒç•™é›»è©±è™Ÿç¢¼ã€‚ä½ æŠŠè»Šä¸Ÿçµ¦ä¿®è»Šå» ï¼Œç•™ç´™æ¢èªªã€Œä¿®å¥½æ‰“é€™æ”¯é›»è©±çµ¦æˆ‘ã€ï¼ˆè¨»å†Š URLï¼‰ã€‚ä½ äººå¯ä»¥å›å®¶ï¼ˆç„¡é€£ç·šï¼‰ï¼Œä¿®å¥½æ™‚è€é—†ä¸»å‹•æ‰“çµ¦ä½ ã€‚
   - **é™åˆ¶**ï¼šéœ€è¦ Destination (ä½ çš„æ¥æ”¶ç«¯) å¯è¢« BMC å­˜å–ã€‚å¦‚æœä½ çš„æ¥æ”¶ç«¯åœ¨é˜²ç«ç‰†å…§æˆ–ç„¡å›ºå®š IPï¼ŒBMC æœƒé€£ä¸åˆ°ä½ ï¼ˆè€é—†æ‰“ä¸é€šé›»è©±ï¼‰ã€‚

3. SNMPv3 Trap
   - ç›¸å®¹èˆŠç³»çµ±

**SSE è¨‚é–±æµç¨‹ï¼š**
```bash
# 1. å»ºç«‹ SSE è¨‚é–±
curl -k -u root:password \
  -X POST \
  -H "Content-Type: application/json" \
  -d '{
    "Destination": "https://my-server:8080/redfish/events",
    "Protocol": "Redfish",
    "Context": "MyEventContext",
    "SubscriptionType": "SSE",
    "EventFormatType": "Event",
    "RegistryPrefixes": ["Base", "OpenBMC"]
  }' \
  https://bmc-ip/redfish/v1/EventService/Subscriptions

# å›æ‡‰ï¼š
# {
#   "@odata.id": "/redfish/v1/EventService/Subscriptions/1",
#   "Id": "1",
#   "Context": "MyEventContext"
# }

# 2. é–‹å•Ÿ SSE é€£ç·šï¼ˆä½¿ç”¨å›å‚³çš„ Subscription IDï¼‰
curl -k -u root:password \
  -H "Accept: text/event-stream" \
  https://bmc-ip/redfish/v1/EventService/SSE/1

# ä¿æŒé€£ç·šï¼ŒæœƒæŒçºŒæ”¶åˆ°äº‹ä»¶ï¼š
# data: {"@odata.type":"#Event.v1_6_0.Event","Events":[...]}
# 
# data: {"@odata.type":"#Event.v1_6_0.Event","Events":[
#   {"MessageId":"OpenBMC.0.1.SensorThresholdCrossed",
#    "Message":"Sensor CPU0_Temp crossed upper threshold",
#    "Severity":"Warning"}
# ]}
```

**bmcweb SSE å¯¦ä½œï¼š**
```cpp
// bmcweb ä¸­ SSE çš„æ ¸å¿ƒé‚è¼¯
// ä½ç½®ï¼šredfish-core/lib/event_service.hpp

void handleSSEConnection(
    const crow::Request& req,
    const std::shared_ptr<bmcweb::AsyncResp>& asyncResp)
{
    // 1. é©—è­‰æ¬Šé™
    if (!req.session)
    {
        asyncResp->res.result(boost::beast::http::status::unauthorized);
        return;
    }
    
    // 2. è¨­å®š SSE æ¨™é ­
    asyncResp->res.set("Content-Type", "text/event-stream");
    asyncResp->res.set("Cache-Control", "no-cache");
    asyncResp->res.set("Connection", "keep-alive");
    
    // 3. è¨»å†Š D-Bus Signal ç›£è½
    auto dbusMatch = std::make_shared<sdbusplus::bus::match::match>(
        *crow::connections::systemBus,
        "type='signal',interface='org.freedesktop.DBus.Properties'",
        [asyncResp](sdbusplus::message::message& msg) {
            // ç•¶æ”¶åˆ°å±¬æ€§è®Šæ›´æ™‚ï¼Œç™¼é€ SSE äº‹ä»¶
            sendSSEEvent(asyncResp, msg);
        });
}
```

### Redfish æ·±å…¥ï¼šSession èªè­‰

Redfish æ”¯æ´å¤šç¨®èªè­‰æ–¹å¼ï¼š

1. Basic Authentication
   - Header: Authorization: Basic base64(user:pass)
   - æ¯æ¬¡è«‹æ±‚éƒ½å¸¶å¯†ç¢¼
   - ç°¡å–®ä½†ä¸å®‰å…¨

2. Session Token
   - å…ˆ POST /redfish/v1/SessionService/Sessions å–å¾— Token
   - ä¹‹å¾Œç”¨ X-Auth-Token Header
   - æ¨è–¦æ–¹å¼

3. OAuth 2.0 / MTLS
   - é€²éšèªè­‰æ–¹å¼
   - éƒ¨åˆ†å¯¦ä½œæ”¯æ´

**Session èªè­‰æµç¨‹ï¼š**
```bash
# 1. å»ºç«‹ Session
curl -k -X POST \
  -H "Content-Type: application/json" \
  -d '{"UserName": "root", "Password": "0penBmc"}' \
  https://bmc-ip/redfish/v1/SessionService/Sessions

# å›æ‡‰ Header åŒ…å«ï¼š
# X-Auth-Token: <token-value>
# Location: /redfish/v1/SessionService/Sessions/abcd1234

# 2. ä½¿ç”¨ Token å­˜å– API
curl -k -H "X-Auth-Token: <token-value>" \
  https://bmc-ip/redfish/v1/Systems/system

# 3. ç™»å‡ºï¼ˆåˆªé™¤ Sessionï¼‰
curl -k -X DELETE \
  -H "X-Auth-Token: <token-value>" \
  https://bmc-ip/redfish/v1/SessionService/Sessions/abcd1234
```

### Redfish æ·±å…¥ï¼šbmcweb æ¶æ§‹

```
bmcweb æ˜¯ OpenBMC çš„ Redfish ä¼ºæœå™¨å¯¦ä½œã€‚

æ¶æ§‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        bmcweb                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Crow      â”‚  â”‚   Boost     â”‚  â”‚  OpenSSL    â”‚      â”‚
â”‚  â”‚ (HTTP/WS)   â”‚  â”‚   Beast     â”‚  â”‚  (TLS)      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                â”‚                â”‚              â”‚
â”‚         â–¼                â–¼                â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚               Request Router                     â”‚    â”‚
â”‚  â”‚    (routes requests to appropriate handler)      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚                                â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚         â–¼               â–¼                   â–¼            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Systems   â”‚  â”‚  Chassis   â”‚  â”‚  Managers...   â”‚     â”‚
â”‚  â”‚  Handler   â”‚  â”‚  Handler   â”‚  â”‚  Handlers      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚        â”‚               â”‚                  â”‚              â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                        â”‚                                 â”‚
â”‚                        â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                 D-Bus Client                     â”‚    â”‚
â”‚  â”‚    (sdbusplus - èˆ‡å…¶ä»– OpenBMC æœå‹™é€šè¨Š)         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¨‹å¼ç¢¼çµæ§‹ï¼š
bmcweb/
â”œâ”€â”€ http/                    # HTTP æ ¸å¿ƒ
â”œâ”€â”€ include/                 # Header files
â”œâ”€â”€ redfish-core/
â”‚   â”œâ”€â”€ include/            # Redfish utility
â”‚   â””â”€â”€ lib/                # Resource handlers
â”‚       â”œâ”€â”€ systems.hpp     # /redfish/v1/Systems
â”‚       â”œâ”€â”€ chassis.hpp     # /redfish/v1/Chassis
â”‚       â”œâ”€â”€ sensors.hpp     # Sensor handling
â”‚       â”œâ”€â”€ thermal.hpp     # Thermal resource
â”‚       â””â”€â”€ power.hpp       # Power resource
â””â”€â”€ src/
    â””â”€â”€ webserver_main.cpp  # Main entry
```

**æ–°å¢ Redfish Resource çš„æ­¥é©Ÿï¼š**
```cpp
// 1. åœ¨é©ç•¶çš„ lib/*.hpp ä¸­æ–°å¢ handler

// ä½ç½®ï¼šredfish-core/lib/my_resource.hpp
inline void requestRoutesMyResource(App& app)
{
    BMCWEB_ROUTE(app, "/redfish/v1/MyResource/")
        .privileges(redfish::privileges::getMyResourceCollection)
        .methods(boost::beast::http::verb::get)(
            [](const crow::Request& req,
               const std::shared_ptr<bmcweb::AsyncResp>& asyncResp) {
            
            // è¨­å®šå›æ‡‰
            asyncResp->res.jsonValue["@odata.type"] = 
                "#MyResourceCollection.v1_0_0.MyResourceCollection";
            asyncResp->res.jsonValue["Name"] = "My Resource Collection";
            
            // å¾ D-Bus æŸ¥è©¢è³‡æ–™
            sdbusplus::message::object_path basePath(
                "/xyz/openbmc_project/myresource");
            
            crow::connections::systemBus->async_method_call(
                [asyncResp](const boost::system::error_code ec,
                            const std::vector<std::string>& paths) {
                    if (ec)
                    {
                        messages::internalError(asyncResp->res);
                        return;
                    }
                    // è™•ç†å›æ‡‰...
                },
                "xyz.openbmc_project.ObjectMapper",
                "/xyz/openbmc_project/object_mapper",
                "xyz.openbmc_project.ObjectMapper", "GetSubTreePaths",
                basePath, 0, std::array<const char*, 1>{"xyz.openbmc..."});
        });
}

// 2. åœ¨ webserver_main.cpp ä¸­è¨»å†Š
requestRoutesMyResource(app);
```

---

### PLDM / MCTPï¼ˆé€²éšé‡é»ï¼ï¼‰

PLDM (Platform Level Data Model) æ˜¯ BMC å’Œ Host ä¹‹é–“çš„é€šè¨Šå”å®šã€‚
MCTP (Management Component Transport Protocol) æ˜¯ PLDM çš„å‚³è¼¸å±¤ã€‚

é€™å…©å€‹æ˜¯ NVIDIA/AMD é¢è©¦çš„é‡é»ï¼å› ç‚º GPU ç®¡ç†å¤§é‡ä½¿ç”¨é€™äº›å”å®šã€‚

**PLDM/MCTP æ¶æ§‹ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PLDM/MCTP å”å®šå †ç–Š                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Application Layer                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  PLDM Types (å„ç¨®åŠŸèƒ½)                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚Type0â”‚ â”‚Type1â”‚ â”‚Type2â”‚ â”‚Type3â”‚ â”‚Type4â”‚ â”‚Type5â”‚  â”‚   â”‚
â”‚  â”‚  â”‚Base â”‚ â”‚SMBIOâ”‚ â”‚Monitâ”‚ â”‚BIOS â”‚ â”‚FW   â”‚ â”‚FRU  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â–²                                â”‚
â”‚                            â”‚                                â”‚
â”‚  Transport Layer           â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      MCTP                            â”‚   â”‚
â”‚  â”‚  (å°åŒ…æ ¼å¼ã€å®šå€ã€åˆ†ç‰‡/é‡çµ„)                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                â”‚
â”‚  Physical Layer            â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ SMBus/  â”‚ â”‚  PCIe   â”‚ â”‚   USB   â”‚ â”‚  Serial â”‚          â”‚
â”‚  â”‚  I2C    â”‚ â”‚  VDM    â”‚ â”‚         â”‚ â”‚         â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**PLDM Types è©³è§£ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Type  â”‚      åç¨±       â”‚             ç”¨é€”                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Type 0 â”‚ Base/Messaging  â”‚ åŸºæœ¬è¨Šæ¯ã€ç‰ˆæœ¬å”å•†                â”‚
â”‚ Type 1 â”‚ SMBIOS          â”‚ ç³»çµ±è³‡è¨Šï¼ˆSMBIOS over PLDMï¼‰      â”‚
â”‚ Type 2 â”‚ Monitoring      â”‚ æ„Ÿæ¸¬å™¨ã€äº‹ä»¶ã€PDR                 â”‚
â”‚ Type 3 â”‚ BIOS Control    â”‚ BIOS å±¬æ€§è¨­å®š                     â”‚
â”‚ Type 4 â”‚ FW Update       â”‚ éŸŒé«”æ›´æ–°ï¼ˆHost BIOS/GPU FWç­‰ï¼‰    â”‚
â”‚ Type 5 â”‚ FRU             â”‚ FRU è³‡æ–™å­˜å–                      â”‚
â”‚ Type 6 â”‚ RDE             â”‚ Redfish Device Enablement        â”‚
â”‚ OEM    â”‚ 0x3F+           â”‚ å» å•†è‡ªå®šç¾©                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PLDM æ·±å…¥ï¼šPDR (Platform Descriptor Records)

```
PDR æ˜¯ PLDM Type 2 çš„æ ¸å¿ƒï¼Œç”¨æ–¼æè¿°å¹³å°çš„ç¡¬é«”é…ç½®ã€‚

PDR é¡å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        PDR Type        â”‚              èªªæ˜                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Terminus Locator PDR   â”‚ æè¿° PLDM Terminus ä½ç½®               â”‚
â”‚ Numeric Sensor PDR     â”‚ æ•¸å€¼å‹æ„Ÿæ¸¬å™¨å®šç¾©                      â”‚
â”‚ State Sensor PDR       â”‚ ç‹€æ…‹å‹æ„Ÿæ¸¬å™¨å®šç¾©                      â”‚
â”‚ Numeric Effecter PDR   â”‚ æ•¸å€¼å‹æ•ˆæœå™¨ï¼ˆå¦‚é¢¨æ‰‡ PWMï¼‰           â”‚
â”‚ State Effecter PDR     â”‚ ç‹€æ…‹å‹æ•ˆæœå™¨ï¼ˆå¦‚ Power Controlï¼‰     â”‚
â”‚ Compact Numeric Sensor â”‚ ç²¾ç°¡ç‰ˆæ•¸å€¼æ„Ÿæ¸¬å™¨                      â”‚
â”‚ FRU Record Set PDR     â”‚ FRU è³‡æ–™é—œè¯                          â”‚
â”‚ Entity Association PDR â”‚ å¯¦é«”é—œè¯ï¼ˆA åŒ…å« Bï¼‰                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Numeric Sensor PDR çµæ§‹ï¼š**
```c
/* PLDM Numeric Sensor PDR çµæ§‹ */
struct pldm_numeric_sensor_pdr {
    /* PDR é€šç”¨ Header */
    uint32_t record_handle;        /* PDR è­˜åˆ¥ç¢¼ */
    uint8_t  pdr_header_version;   /* å›ºå®š 0x01 */
    uint8_t  pdr_type;             /* 0x02 = Numeric Sensor */
    uint16_t record_change_number;
    uint16_t data_length;
    
    /* Terminus è³‡è¨Š */
    uint16_t pldm_terminus_handle;
    uint16_t sensor_id;            /* Sensor è­˜åˆ¥ç¢¼ */
    
    /* Entity è³‡è¨Š */
    uint16_t entity_type;          /* 0x42=Processor, 0x43=GPU */
    uint16_t entity_instance;
    uint16_t container_id;
    
    /* Sensor é¡å‹ */
    uint8_t  sensor_init;
    uint8_t  sensor_auxiliary_names_pdr;
    uint8_t  base_unit;            /* 0x02=Celsius, 0x03=RPM */
    int8_t   unit_modifier;        /* 10^x å–®ä½ä¿®æ­£ */
    uint8_t  rate_unit;
    
    /* Thresholds */
    uint8_t  range_field_support;
    int32_t  warning_high;
    int32_t  critical_high;
    int32_t  fatal_high;
    int32_t  warning_low;
    int32_t  critical_low;
    int32_t  fatal_low;
    
    /* è®€æ•¸è½‰æ› (y = (offset + resolution * raw) * 10^modifier) */
    float    resolution;
    float    offset;
    
} __attribute__((packed));

/* è®€å–ç¯„ä¾‹ï¼š
 * PDR å®šç¾© GPU0_Tempï¼š
 *   base_unit = 0x02 (Celsius)
 *   unit_modifier = 0 (10^0 = 1)
 *   resolution = 1.0
 *   offset = 0.0
 *   warning_high = 80
 *   critical_high = 95
 *
 * Sensor Reading = 45
 * â†’ å¯¦éš›æº«åº¦ = (0 + 1.0 * 45) * 10^0 = 45Â°C
 */
```

### PLDM æ·±å…¥ï¼šMCTP å°åŒ…æ ¼å¼

```
MCTP (Management Component Transport Protocol) æ˜¯ PLDM çš„å‚³è¼¸å±¤ã€‚

MCTP å°åŒ…çµæ§‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MCTP å°åŒ…                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Transport Header (ä¾å‚³è¼¸åª’ä»‹ä¸åŒ)                    â”‚ â”‚
â”‚  â”‚  ä¾‹å¦‚ SMBus: Slave Address + Command Code            â”‚ â”‚
â”‚  â”‚  ä¾‹å¦‚ PCIe VDM: Vendor Defined Message Header        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                â”‚
â”‚                            â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  MCTP Transport Header (4 bytes)                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚ â”‚
â”‚  â”‚  â”‚ Rsvd (4) â”‚ HDR Ver  â”‚ Dest EID â”‚ Src EID  â”‚        â”‚ â”‚
â”‚  â”‚  â”‚  + SOM   â”‚  (4 bit) â”‚ (8 bit)  â”‚ (8 bit)  â”‚        â”‚ â”‚
â”‚  â”‚  â”‚  + EOM   â”‚          â”‚          â”‚          â”‚        â”‚ â”‚
â”‚  â”‚  â”‚  + PktSeqâ”‚          â”‚          â”‚          â”‚        â”‚ â”‚
â”‚  â”‚  â”‚  + TO    â”‚          â”‚          â”‚          â”‚        â”‚ â”‚
â”‚  â”‚  â”‚  + TagOwnâ”‚          â”‚          â”‚          â”‚        â”‚ â”‚
â”‚  â”‚  â”‚  + MsgTagâ”‚          â”‚          â”‚          â”‚        â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                â”‚
â”‚                            â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  MCTP Message Header (1 byte)                         â”‚ â”‚
â”‚  â”‚  Bit 7: IC (Integrity Check)                          â”‚ â”‚
â”‚  â”‚  Bit 6-0: Message Type (0x01 = PLDM)                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                â”‚
â”‚                            â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  PLDM Message (N bytes)                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Instance ID (1 byte)                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Header Version + PLDM Type (1 byte)             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Command Code (1 byte)                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  [Payload Data] (0-N bytes)                       â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é—œéµæ¬„ä½ï¼š
- Dest EID: ç›®çš„ç«¯é» IDï¼ˆBMC é€šå¸¸æ˜¯ 0x08ï¼‰
- Src EID: ä¾†æºç«¯é» IDï¼ˆGPU å¯èƒ½æ˜¯ 0x10ï¼‰
- SOM/EOM: åˆ†ç‰‡æ¨™è¨˜ï¼ˆStart/End of Messageï¼‰
- Message Type: 0x01 è¡¨ç¤º PLDM
```

**MCTP over SMBus ç¯„ä¾‹ï¼š**
```c
/* MCTP over SMBus (I2C) */

/* SMBus MCTP å‚³è¼¸æ ¼å¼ï¼š
 * [Slave Addr] [Cmd=0x0F] [Byte Count] [MCTP Header] [PLDM Data]
 *    7 bit         1 byte     1 byte      4 bytes      N bytes
 */

/* ç™¼é€ PLDM GetTID åˆ° GPU (EID=0x10) */
uint8_t pldm_get_tid[] = {
    /* SMBus éƒ¨åˆ† */
    0x32,              /* Slave Address (GPU) << 1 */
    0x0F,              /* MCTP Command Code */
    0x08,              /* Byte Count (å¾ŒçºŒè³‡æ–™é•·åº¦) */
    
    /* MCTP Transport Header */
    0x01,              /* Header Version = 1 */
    0x10,              /* Dest EID = 0x10 (GPU) */
    0x08,              /* Src EID = 0x08 (BMC) */
    0xC8,              /* SOM=1, EOM=1, Pkt Seq=0, TO=1, Tag=0 */
    
    /* MCTP Message Header */
    0x01,              /* Message Type = PLDM */
    
    /* PLDM Message */
    0x80,              /* Instance ID + Rq=1 */
    0x00,              /* HDR Ver=0 + PLDM Type=0 (Base) */
    0x02               /* Command = GetTID */
};

/* å›æ‡‰ (GPU â†’ BMC) */
uint8_t pldm_get_tid_resp[] = {
    /* ... MCTP headers ... */
    0x00,              /* Instance ID (echo) + Rq=0 */
    0x00,              /* HDR Ver=0 + PLDM Type=0 */
    0x02,              /* Command = GetTID */
    0x00,              /* Completion Code = Success */
    0x10               /* TID = 0x10 (å›å‚³è‡ªå·±çš„ Terminus ID) */
};
```

### ä»€éº¼æ˜¯ã€Œè£¸æ©Ÿ (Bare-metal) é¢¨æ ¼ã€çš„å°åŒ…å»ºæ§‹ï¼Ÿ

ä¸Šé¢çš„ç¯„ä¾‹ç¨‹å¼ç¢¼æ˜¯ã€Œè£¸æ©Ÿé¢¨æ ¼ã€çš„åŸå§‹å°åŒ…å»ºæ§‹ã€‚

ã€Œè£¸æ©Ÿ (Bare-metal)ã€æŒ‡çš„æ˜¯ï¼š
1. ä¸ä¾è³´ä½œæ¥­ç³»çµ±çš„æŠ½è±¡å±¤
2. ç›´æ¥æ“ä½œç¡¬é«”æš«å­˜å™¨æˆ–åŸå§‹è³‡æ–™
3. å®Œå…¨æ‰‹å‹•è™•ç†æ¯ä¸€å€‹ byte çš„æ’åˆ—

é€™ç¨®é¢¨æ ¼å¸¸è¦‹æ–¼ï¼š
- Bootloader é–‹ç™¼ï¼ˆU-Bootã€UEFIï¼‰
- åµŒå…¥å¼éŸŒé«”ï¼ˆMCUã€RTOSï¼‰
- å”å®šæ•™å­¸èˆ‡é™¤éŒ¯ï¼ˆå±•ç¤ºæ¯å€‹æ¬„ä½çš„æ„ç¾©ï¼‰
- é©…å‹•ç¨‹å¼åº•å±¤å¯¦ä½œ

å„ªé»ï¼š
âœ“ å®Œå…¨æŒæ§æ¯ä¸€å€‹ bit
âœ“ é©åˆé€†å‘å·¥ç¨‹èˆ‡å”å®šåˆ†æ
âœ“ ç„¡ä¾è³´ï¼Œå¯ç§»æ¤åˆ°ä»»ä½•å¹³å°

ç¼ºé»ï¼š
âœ— å®¹æ˜“å‡ºéŒ¯ï¼ˆbyte é †åºã€å°é½Šï¼‰
âœ— ç¶­è­·æˆæœ¬é«˜
âœ— ç¼ºä¹é¡å‹å®‰å…¨

### OpenBMC æ¶æ§‹å°æ¯”ï¼šBare-metal vs. Production

```
å¯¦éš› OpenBMC é–‹ç™¼ä¸æœƒæ‰‹åˆ»å°åŒ…ï¼Œè€Œæ˜¯ä½¿ç”¨åˆ†å±¤æ¶æ§‹ï¼š

è£¸æ©Ÿé¢¨æ ¼ï¼ˆå¦‚ä¸Šé¢çš„ç¯„ä¾‹ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  uint8_t pldm_get_tid[] = {                                â”‚
â”‚      0x32, 0x0F, 0x08,           /* SMBus å±¤ */            â”‚
â”‚      0x01, 0x10, 0x08, 0xC8,    /* MCTP å±¤ */             â”‚
â”‚      0x01,                       /* Message Type */        â”‚
â”‚      0x80, 0x00, 0x02           /* PLDM å±¤ */             â”‚
â”‚  };                                                         â”‚
â”‚  i2c_smbus_write_block_data(fd, 0x0F, sizeof(buf), buf);   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

OpenBMC ç”Ÿç”¢æ¶æ§‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  Application Layer (pldmd)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  // ä½¿ç”¨ libpldm çµ„åŒ…                               â”‚   â”‚
â”‚  â”‚  encode_get_tid_req(instance_id, request_buf);      â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  // é€é socket ç™¼é€                                â”‚   â”‚
â”‚  â”‚  sendmsg(sock, &msg, 0);                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                                   â”‚
â”‚                         â–¼                                   â”‚
â”‚  libpldm Layer                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  // openbmc/pldm/src/base.c                         â”‚   â”‚
â”‚  â”‚  #define PLDM_GET_TID 0x02                          â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  encode_pldm_header(instance_id, PLDM_BASE,         â”‚   â”‚
â”‚  â”‚                     PLDM_GET_TID, request);         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                                   â”‚
â”‚                         â–¼                                   â”‚
â”‚  Kernel MCTP Stack (AF_MCTP Socket)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  // è‡ªå‹•è™•ç† MCTP Headerã€åˆ†ç‰‡ã€é‡çµ„                 â”‚   â”‚
â”‚  â”‚  // è‡ªå‹•è·¯ç”±åˆ°æ­£ç¢ºçš„ EID                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                                   â”‚
â”‚                         â–¼                                   â”‚
â”‚  mctp-i2c.c Driver (Physical Layer)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  // drivers/net/mctp/mctp-i2c.c                     â”‚   â”‚
â”‚  â”‚  #define MCTP_I2C_COMMAND 0x0f                      â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  i2c_smbus_write_block_data(adapter, cmd, len, buf);â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®˜æ–¹ Source Code åƒè€ƒé€£çµ

```
ä»¥ä¸‹æ˜¯é©—è­‰ä¸Šè¿°ç¯„ä¾‹æ­£ç¢ºæ€§çš„å®˜æ–¹ç¨‹å¼ç¢¼ä¾†æºï¼š

1. SMBus Command Code 0x0F
   â”œâ”€â”€ Linux Kernel: drivers/net/mctp/mctp-i2c.c
   â”‚   #define MCTP_I2C_COMMAND 0x0f
   â”‚   URL: https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/net/mctp/mctp-i2c.c
   â”‚
   â””â”€â”€ libmctp (OpenBMC): libmctp-smbus.c
       #define MCTP_COMMAND_CODE 0x0f
       URL: https://github.com/openbmc/libmctp/blob/master/libmctp-smbus.c

2. MCTP Message Type 0x01 (PLDM)
   â””â”€â”€ libmctp: libmctp.h
       #define MCTP_MESSAGE_TYPE_PLDM 0x01
       URL: https://github.com/openbmc/libmctp/blob/master/libmctp.h

3. PLDM GetTID Command 0x02
   â”œâ”€â”€ libpldm: include/libpldm/base.h
   â”‚   #define PLDM_GET_TID 0x02
   â”‚   URL: https://github.com/openbmc/pldm/blob/master/include/libpldm/base.h
   â”‚
   â””â”€â”€ libpldm: src/base.c (encode/decode å¯¦ä½œ)
       encode_get_tid_req() / decode_get_tid_resp()
       URL: https://github.com/openbmc/pldm/blob/master/src/base.c

4. DMTF å®˜æ–¹è¦æ ¼
   â”œâ”€â”€ DSP0236: MCTP Base Specification
   â”œâ”€â”€ DSP0237: MCTP SMBus/I2C Transport Binding
   â”œâ”€â”€ DSP0240: PLDM Base Specification
   â””â”€â”€ DSP0241: PLDM over MCTP Binding
       URL: https://www.dmtf.org/standards/pmci
```

**é¢è©¦åŠ åˆ†å›ç­”ï¼š**
ç•¶è¢«å•åˆ° MCTP/PLDM æ™‚ï¼Œå±•ç¤ºä½ ç†è§£å®Œæ•´æ¶æ§‹ï¼š

ã€Œé€™æ®µ Code æ˜¯å±•ç¤ºåº•å±¤ SMBus å‚³è¼¸çš„ Raw Data æ ¼å¼ï¼Œ
æ¯å€‹ byte éƒ½å°æ‡‰ DMTF è¦æ ¼ (DSP0236, DSP0237, DSP0240)ã€‚

åœ¨å¯¦éš› OpenBMC é–‹ç™¼ä¸­ï¼Œæˆ‘å€‘æœƒä½¿ç”¨ libpldm çš„ 
encode_get_tid_req() ä¾†çµ„åŒ…ï¼Œé€é AF_MCTP Socket 
äº¤çµ¦ Kernel çš„ mctp-i2c Driver è™•ç†ã€‚

é€™æ¨£çš„åˆ†å±¤è¨­è¨ˆè®“ Application ä¸éœ€è¦é—œå¿ƒ Transportï¼Œ
ä¹Ÿæ–¹ä¾¿åˆ‡æ›ä¸åŒçš„ Physical Layer (SMBus/PCIe/USB)ã€‚ã€

### PLDM æ·±å…¥ï¼šType 2 Sensor å¯¦ä½œ

```c
/* OpenBMC PLDM Type 2 Sensor è³‡æ–™æµ */

/*
 * 1. pldmd å•Ÿå‹•æ™‚ï¼Œå‘å„ Terminus è«‹æ±‚ PDR
 *    â†’ å–å¾—æ‰€æœ‰ Sensor å®šç¾©
 *
 * 2. pldmd å»ºç«‹ D-Bus ç‰©ä»¶
 *    â†’ /xyz/openbmc_project/sensors/temperature/GPU0_Temp
 *    â†’ å¯¦ä½œ xyz.openbmc_project.Sensor.Value interface
 *
 * 3. pldmd é€±æœŸæ€§è®€å– Sensor
 *    â†’ ç™¼é€ GetSensorReading (Type 2, Cmd 0x11)
 *    â†’ æ›´æ–° D-Bus Property
 *
 * 4. bmcweb è®€å– D-Bus
 *    â†’ æš´éœ²ç‚º Redfish Sensor
 */

/* GetSensorReading Request (PLDM Type 2, Cmd 0x11) */
struct pldm_get_sensor_reading_req {
    uint16_t sensor_id;
    bool8_t  rearm_event_state;
} __attribute__((packed));

/* GetSensorReading Response */
struct pldm_get_sensor_reading_resp {
    uint8_t  completion_code;
    uint8_t  sensor_data_size;     /* 0=uint8, 1=int8, 2=uint16, ... */
    uint8_t  sensor_operational_state;
    uint8_t  sensor_event_msg_enable;
    uint8_t  present_state;
    uint8_t  previous_state;
    uint8_t  event_state;
    union {
        uint8_t  value_u8;
        int8_t   value_s8;
        uint16_t value_u16;
        int16_t  value_s16;
        uint32_t value_u32;
        int32_t  value_s32;
    } present_reading;
} __attribute__((packed));

/* OpenBMC pldmd ç¨‹å¼ç¢¼ä½ç½® */
/* openbmc/pldm/libpldmresponder/platform.cpp */
/* openbmc/pldm/requester/handler.hpp */
```

### PLDM æ·±å…¥ï¼šType 4 éŸŒé«”æ›´æ–°

```
PLDM Type 4 ç”¨æ–¼åœ¨ BMC å’Œè¨­å‚™ä¹‹é–“å‚³è¼¸éŸŒé«”ã€‚

æ›´æ–°æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 PLDM Type 4 éŸŒé«”æ›´æ–°æµç¨‹                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Update Agent (BMC)              Firmware Device (GPU)      â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚  1. QueryDeviceIdentifiers â”€â”€â”€â”€â”€â”€â†’ â”‚                â”‚
â”‚       â”‚  â†â”€â”€â”€â”€â”€ DeviceIdentifiers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Descriptor    â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚  2. GetFirmwareParameters â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                â”‚
â”‚       â”‚  â†â”€â”€â”€â”€â”€ FirmwareParameters â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Version info  â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚  --- ç¢ºèªéœ€è¦æ›´æ–° ---               â”‚                â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚  3. RequestUpdate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                â”‚
â”‚       â”‚  â†â”€â”€â”€â”€â”€ RequestUpdateResponse â”€â”€â”€â”€â”‚  Accept        â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚  4. PassComponentTable â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                â”‚
â”‚       â”‚  â†â”€â”€â”€â”€â”€ PassComponentResponse â”€â”€â”€â”€â”‚                 â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚  5. UpdateComponent â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                â”‚
â”‚       â”‚  â†â”€â”€â”€â”€â”€ UpdateComponentResponse â”€â”€â”‚                 â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚  6. TransferData (å¤šæ¬¡) â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  å‚³è¼¸éŸŒé«”      â”‚
â”‚       â”‚  â†â”€â”€â”€â”€â”€ TransferResponse â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  è³‡æ–™          â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚  7. VerifyComplete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                â”‚
â”‚       â”‚  â†â”€â”€â”€â”€â”€ VerifyCompleteResponse â”€â”€â”‚  é©—è­‰æˆåŠŸ      â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚  8. ApplyComplete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                â”‚
â”‚       â”‚  â†â”€â”€â”€â”€â”€ ApplyCompleteResponse â”€â”€â”€â”‚  å¥—ç”¨å®Œæˆ      â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚  9. ActivateFirmware â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                â”‚
â”‚       â”‚  â†â”€â”€â”€â”€â”€ ActivateResponse â”€â”€â”€â”€â”€â”€â”€â”€â”‚  é‡å•Ÿç”Ÿæ•ˆ      â”‚
â”‚       â”‚                                    â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**OpenBMC PLDM å·¥å…·ï¼š**
```bash
# æŸ¥çœ‹ PLDM Terminusï¼ˆç«¯é»ï¼‰
pldmtool base GetTID -m <mctp_eid>

# æŸ¥çœ‹ PLDM ç‰ˆæœ¬
pldmtool base GetPLDMTypes -m <mctp_eid>
pldmtool base GetPLDMVersion -m <mctp_eid> -t <pldm_type>

# è®€å– PDR (Platform Descriptor Records)
pldmtool platform GetPDR -m <mctp_eid> -d <record_handle>
pldmtool platform GetPDR -m <mctp_eid> -t <pdr_type>

# è®€å–æ„Ÿæ¸¬å™¨
pldmtool platform GetSensorReading -m <mctp_eid> -i <sensor_id>

# è¨­å®š Effecter
pldmtool platform SetNumericEffecterValue -m <mctp_eid> \
    -i <effecter_id> -d <value>

# BIOS å±¬æ€§
pldmtool bios GetBIOSTable -m <mctp_eid> -t StringTable
pldmtool bios GetBIOSTable -m <mctp_eid> -t AttributeTable
pldmtool bios GetBIOSTable -m <mctp_eid> -t AttributeValueTable
pldmtool bios GetBIOSAttributeCurrentValueByHandle -m <mctp_eid> \
    -a <attr_handle>

# éŸŒé«”æ›´æ–°
pldmtool fwupdate GetFwParams -m <mctp_eid>
pldmtool fwupdate Update -m <mctp_eid> -p <package_path>

# D-Bus ä¸ŠæŸ¥çœ‹ PLDM Sensor
busctl tree xyz.openbmc_project.PLDM
busctl introspect xyz.openbmc_project.PLDM \
    /xyz/openbmc_project/sensors/temperature/GPU0_Temp
```

---

### SPDMï¼ˆå®‰å…¨é‡é»ï¼ï¼‰

SPDM (Security Protocol and Data Model) æ˜¯ DMTF åˆ¶å®šçš„å®‰å…¨å”å®šã€‚
ç”¨æ–¼é©—è­‰å…ƒä»¶èº«ä»½ï¼Œæ˜¯ Supply Chain Security çš„æ ¸å¿ƒï¼

NVIDIA/AMD éå¸¸é‡è¦–é€™å€‹ï¼Œå› ç‚ºéœ€è¦é©—è­‰ GPU éŸŒé«”çš„åˆæ³•æ€§ã€‚

**SPDM èªè­‰æµç¨‹ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SPDM èªè­‰æµç¨‹                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚   Requester (BMC)                    Responder (GPU/Device) â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚  1. GET_VERSION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                â”‚
â”‚       â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ VERSION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚  2. GET_CAPABILITIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                â”‚
â”‚       â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€ CAPABILITIES â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚  3. NEGOTIATE_ALGORITHMS â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                â”‚
â”‚       â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€ ALGORITHMS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚  4. GET_DIGESTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                â”‚
â”‚       â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€ DIGESTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  (æ†‘è­‰ Hash)  â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚  5. GET_CERTIFICATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                â”‚
â”‚       â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€ CERTIFICATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  (å®Œæ•´æ†‘è­‰)   â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚  6. CHALLENGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                â”‚
â”‚       â”‚     (å« Nonce)                      â”‚                â”‚
â”‚       â”‚  â†â”€â”€â”€â”€â”€â”€â”€ CHALLENGE_AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  (ç°½ç« å›æ‡‰)   â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚  é©—è­‰ç°½ç«  âœ“                         â”‚                â”‚
â”‚       â”‚  å»ºç«‹ä¿¡ä»»é€£ç·š                        â”‚                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**SPDM é‡è¦æ¦‚å¿µï¼š**
1. Root of Trust (RoT)
   - æœ€åº•å±¤çš„ä¿¡ä»»ä¾†æº
   - é€šå¸¸æ˜¯æ™¶ç‰‡å…§å»ºçš„å…¬é‘°æˆ– OTP
   - ç”¨ä¾†é©—è­‰ç¬¬ä¸€å±¤æ†‘è­‰

2. Certificate Chainï¼ˆæ†‘è­‰éˆï¼‰
   Root CA â†’ Intermediate CA â†’ Device Certificate
   æ¯ä¸€å±¤éƒ½ç”±ä¸Šä¸€å±¤ç°½ç« 

3. Measurementï¼ˆæ¸¬é‡å€¼ï¼‰
   - éŸŒé«”çš„ Hash å€¼
   - å¯ç”¨ä¾†é©—è­‰éŸŒé«”å®Œæ•´æ€§
   - é˜²æ­¢éŸŒé«”è¢«ç«„æ”¹

4. Secure Session
   - SPDM èªè­‰å¾Œå¯å»ºç«‹åŠ å¯†é€šé“
   - ç”¨ AES-GCM åŠ å¯†å¾ŒçºŒé€šè¨Š

### SPDM æ·±å…¥ï¼šCertificate Chain è©³è§£

```
SPDM Certificate Chain ç”¨æ–¼å»ºç«‹è¨­å‚™èº«ä»½ä¿¡ä»»ã€‚

æ†‘è­‰éšå±¤ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Certificate Chain                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Root CA Certificate                                â”‚   â”‚
â”‚  â”‚  - è‡ªç°½æ†‘è­‰ï¼ˆSelf-signedï¼‰                         â”‚   â”‚
â”‚  â”‚  - Hash ç‡’éŒ„åœ¨ BMC çš„ OTP ä¸­                       â”‚   â”‚
â”‚  â”‚  - ç”±è¨­å‚™å» å•†ï¼ˆå¦‚ NVIDIAï¼‰ç®¡ç†                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â”‚ ç°½ç«                                 â”‚
â”‚                       â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Intermediate CA Certificateï¼ˆå¯é¸ï¼‰                â”‚   â”‚
â”‚  â”‚  - ç”± Root CA ç°½ç«                                   â”‚   â”‚
â”‚  â”‚  - å¯èƒ½æœ‰å¤šå±¤                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â”‚ ç°½ç«                                 â”‚
â”‚                       â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Device Certificateï¼ˆLeaf Certificateï¼‰             â”‚   â”‚
â”‚  â”‚  - åŒ…å«è¨­å‚™çš„å…¬é‘°                                   â”‚   â”‚
â”‚  â”‚  - åŒ…å«è¨­å‚™è­˜åˆ¥è³‡è¨Šï¼ˆåºè™Ÿã€å‹è™Ÿï¼‰                   â”‚   â”‚
â”‚  â”‚  - å„²å­˜åœ¨è¨­å‚™çš„å®‰å…¨å€åŸŸ                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  é©—è­‰æµç¨‹ï¼š                                                  â”‚
â”‚  1. BMC å–å¾— Device Certificate                             â”‚
â”‚  2. ç”¨ Intermediate CA çš„å…¬é‘°é©—è­‰ Device Cert               â”‚
â”‚  3. ç”¨ Root CA çš„å…¬é‘°é©—è­‰ Intermediate Cert                 â”‚
â”‚  4. ç¢ºèª Root CA Hash èˆ‡ OTP ä¸­çš„å€¼ç›¸ç¬¦                      â”‚
â”‚  5. ç¢ºèª Certificate æœªéæœŸã€æœªè¢« revoke                     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SPDM æ·±å…¥ï¼šMeasurement æ©Ÿåˆ¶

```
Measurement ç”¨æ–¼é©—è­‰è¨­å‚™éŸŒé«”çš„å®Œæ•´æ€§ã€‚

å·¥ä½œåŸç†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SPDM Measurement                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  è¨­å‚™é–‹æ©Ÿæ™‚ï¼š                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Boot ROM                                            â”‚   â”‚
â”‚  â”‚    â”‚                                                 â”‚   â”‚
â”‚  â”‚    â–¼  è¨ˆç®— Hash                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚   â”‚
â”‚  â”‚  â”‚  Stage 1 FW   â”‚â”€â”€â†’ Measurement Index 0           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚   â”‚
â”‚  â”‚          â”‚                                           â”‚   â”‚
â”‚  â”‚          â–¼  è¨ˆç®— Hash                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚   â”‚
â”‚  â”‚  â”‚  Stage 2 FW   â”‚â”€â”€â†’ Measurement Index 1           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚   â”‚
â”‚  â”‚          â”‚                                           â”‚   â”‚
â”‚  â”‚          â–¼  è¨ˆç®— Hash                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚   â”‚
â”‚  â”‚  â”‚  Application  â”‚â”€â”€â†’ Measurement Index 2           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  BMC é©—è­‰æ™‚ï¼š                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. ç™¼é€ GET_MEASUREMENTS è«‹æ±‚                      â”‚   â”‚
â”‚  â”‚  2. è¨­å‚™å›å‚³å„ Index çš„ Hash å€¼                     â”‚   â”‚
â”‚  â”‚  3. BMC æ¯”å°ã€Œå·²çŸ¥è‰¯å¥½å€¼ã€ï¼ˆGolden Image Hashï¼‰     â”‚   â”‚
â”‚  â”‚  4. ä¸ç¬¦åˆå‰‡æ‹’çµ•ä¿¡ä»»è©²è¨­å‚™                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  Measurement Record æ ¼å¼ï¼š                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Index    â”‚  0x01                                  â”‚   â”‚
â”‚  â”‚   Type     â”‚  0x05 (Raw Bit Stream)                 â”‚   â”‚
â”‚  â”‚   Size     â”‚  48 bytes                              â”‚   â”‚
â”‚  â”‚   Hash     â”‚  SHA-384 of Firmware Stage 1           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SPDM æ·±å…¥ï¼šOpenBMC libspdm æ•´åˆ

```c
/* OpenBMC ä½¿ç”¨ libspdm å¯¦ä½œ SPDM å”å®š */

/* å°ˆæ¡ˆçµæ§‹ï¼š
 * openbmc/libspdm - SPDM å”å®šåº«
 * openbmc/spdmd - OpenBMC SPDM Daemon
 */

/* åˆå§‹åŒ– SPDM Context */
#include <library/spdm_requester_lib.h>

void init_spdm_requester(void *spdm_context)
{
    libspdm_return_t status;
    
    /* è¨­å®šç‰ˆæœ¬ */
    libspdm_data_parameter_t parameter;
    parameter.location = LIBSPDM_DATA_LOCATION_LOCAL;
    
    spdm_version_number_t version = SPDM_MESSAGE_VERSION_12;
    libspdm_set_data(spdm_context, LIBSPDM_DATA_SPDM_VERSION,
                     &parameter, &version, sizeof(version));
    
    /* è¨­å®šèƒ½åŠ› */
    uint32_t capabilities = 
        SPDM_GET_CAPABILITIES_REQUESTER_FLAGS_CERT_CAP |
        SPDM_GET_CAPABILITIES_REQUESTER_FLAGS_CHAL_CAP |
        SPDM_GET_CAPABILITIES_REQUESTER_FLAGS_MEAS_CAP_SIG;
    
    libspdm_set_data(spdm_context, LIBSPDM_DATA_CAPABILITY_FLAGS,
                     &parameter, &capabilities, sizeof(capabilities));
    
    /* è¨­å®šæ¼”ç®—æ³• */
    uint32_t base_hash_algo = SPDM_ALGORITHMS_BASE_HASH_ALGO_TPM_ALG_SHA_384;
    libspdm_set_data(spdm_context, LIBSPDM_DATA_BASE_HASH_ALGO,
                     &parameter, &base_hash_algo, sizeof(base_hash_algo));
}

/* åŸ·è¡Œè¨­å‚™èªè­‰ */
libspdm_return_t authenticate_device(void *spdm_context)
{
    libspdm_return_t status;
    uint8_t slot_id = 0;
    
    /* 1. GET_VERSION */
    status = libspdm_get_version(spdm_context, NULL, NULL);
    if (LIBSPDM_STATUS_IS_ERROR(status)) return status;
    
    /* 2. GET_CAPABILITIES */
    status = libspdm_get_capabilities(spdm_context);
    if (LIBSPDM_STATUS_IS_ERROR(status)) return status;
    
    /* 3. NEGOTIATE_ALGORITHMS */
    status = libspdm_negotiate_algorithms(spdm_context);
    if (LIBSPDM_STATUS_IS_ERROR(status)) return status;
    
    /* 4. GET_DIGESTS */
    uint8_t digests[LIBSPDM_MAX_DIGEST_SIZE];
    status = libspdm_get_digest(spdm_context, NULL, 
                                 NULL, digests);
    if (LIBSPDM_STATUS_IS_ERROR(status)) return status;
    
    /* 5. GET_CERTIFICATE */
    size_t cert_chain_size = LIBSPDM_MAX_CERT_CHAIN_SIZE;
    uint8_t cert_chain[LIBSPDM_MAX_CERT_CHAIN_SIZE];
    status = libspdm_get_certificate(spdm_context, NULL,
                                      slot_id, &cert_chain_size, 
                                      cert_chain);
    if (LIBSPDM_STATUS_IS_ERROR(status)) return status;
    
    /* 6. CHALLENGE */
    uint8_t measurement_hash[64];
    status = libspdm_challenge(spdm_context, NULL,
                                slot_id, 
                                SPDM_CHALLENGE_REQUEST_ALL_MEASUREMENTS_HASH,
                                measurement_hash, NULL);
    if (LIBSPDM_STATUS_IS_ERROR(status)) return status;
    
    /* èªè­‰æˆåŠŸï¼ */
    return LIBSPDM_STATUS_SUCCESS;
}
```

### SPDM æ·±å…¥ï¼šSupply Chain Security

```
SPDM åœ¨ä¾›æ‡‰éˆå®‰å…¨ä¸­çš„è§’è‰²ï¼š

å•é¡Œå ´æ™¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¨­å‚™å¾å·¥å» åˆ°éƒ¨ç½²çš„éç¨‹ä¸­å¯èƒ½è¢«ç«„æ”¹ï¼š                        â”‚
â”‚                                                             â”‚
â”‚  åŸå»  â”€â†’ é‹è¼¸ â”€â†’ ç¶“éŠ·å•† â”€â†’ é‹è¼¸ â”€â†’ è³‡æ–™ä¸­å¿ƒ                 â”‚
â”‚   â†‘         ?         ?         ?         â†‘                 â”‚
â”‚  å¯ä¿¡                                    éœ€é©—è­‰              â”‚
â”‚                                                             â”‚
â”‚  æ”»æ“Šè€…å¯èƒ½ï¼š                                                â”‚
â”‚  - æ›¿æ› GPU éŸŒé«”                                            â”‚
â”‚  - åŠ å…¥å¾Œé–€                                                 â”‚
â”‚  - å½é€ è¨­å‚™                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SPDM è§£æ±ºæ–¹æ¡ˆï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  1. è¨­å‚™èº«ä»½é©—è­‰                                            â”‚
â”‚     - æ¯å€‹è¨­å‚™æœ‰å”¯ä¸€çš„ç§é‘°å’Œæ†‘è­‰                            â”‚
â”‚     - ç„¡æ³•å½é€ èº«ä»½                                          â”‚
â”‚                                                             â”‚
â”‚  2. éŸŒé«”å®Œæ•´æ€§                                              â”‚
â”‚     - Measurement è¨˜éŒ„é–‹æ©Ÿæ™‚å„éšæ®µéŸŒé«”çš„ Hash               â”‚
â”‚     - å¯åµæ¸¬ä»»ä½•éŸŒé«”ä¿®æ”¹                                    â”‚
â”‚                                                             â”‚
â”‚  3. å®‰å…¨é€šè¨Š                                                â”‚
â”‚     - èªè­‰å¾Œå¯å»ºç«‹åŠ å¯† Session                              â”‚
â”‚     - é˜²æ­¢ä¸­é–“äººæ”»æ“Š                                        â”‚
â”‚                                                             â”‚
â”‚  å¯¦éš›æ‡‰ç”¨ï¼š                                                  â”‚
â”‚  - NVIDIA GPUï¼šæ¯å¼µå¡æœ‰å”¯ä¸€æ†‘è­‰                             â”‚
â”‚  - AMD Instinctï¼šæ”¯æ´ SPDM èªè­‰                             â”‚
â”‚  - è³‡æ–™ä¸­å¿ƒï¼šBMC å•Ÿå‹•æ™‚é©—è­‰æ‰€æœ‰è¨­å‚™                         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”· BMC å¸¸è¦‹ç¡¬é«”çŸ¥è­˜ï¼ˆé¢è©¦æœƒå•ï¼ï¼‰

### BMC SoC æ¯”è¼ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å¸¸è¦‹ BMC SoC æ¯”è¼ƒ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚ AST2500      â”‚ AST2600      â”‚ NPCM845            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å» å•†         â”‚ ASPEED       â”‚ ASPEED       â”‚ Nuvoton            â”‚
â”‚ CPU          â”‚ ARM926EJ-S   â”‚ Cortex-A7 x2 â”‚ Cortex-A35 x4      â”‚
â”‚ æ™‚è„ˆ         â”‚ 200~250MHz   â”‚ 800MHz       â”‚ 1GHz               â”‚
â”‚ RAM          â”‚ 512MB DDR3   â”‚ 1GB DDR4     â”‚ 2GB DDR4           â”‚
â”‚ Flash        â”‚ 32MB SPI     â”‚ 64MB SPI     â”‚ 128MB SPI          â”‚
â”‚ Ethernet     â”‚ 2x 1GbE      â”‚ 2x 1GbE      â”‚ 2x 1GbE            â”‚
â”‚ PCIe         â”‚ âŒ           â”‚ âœ… (Host é€šè¨Š)â”‚ âœ…                 â”‚
â”‚ USB          â”‚ 2.0          â”‚ 2.0 Host     â”‚ 2.0 + 3.0          â”‚
â”‚ Video        â”‚ VGA          â”‚ VGA/eDP      â”‚ VGA                â”‚
â”‚ Secure Boot  â”‚ åŸºæœ¬         â”‚ å®Œæ•´æ”¯æ´     â”‚ å®Œæ•´æ”¯æ´           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¸‚å ´ç‹€æ…‹ï¼š                                                       â”‚
â”‚ - ASPEED ç´„ä½” 70-80% å¸‚ä½”ç‡                                      â”‚
â”‚ - AST2600 æ˜¯ç›®å‰ä¸»æµï¼ŒAST2500 é€æ¼¸æ·˜æ±°                           â”‚
â”‚ - Nuvoton NPCM845 æ˜¯å¾Œèµ·ä¹‹ç§€ï¼ŒGoogle æ”¯æŒ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**AST2500 vs AST2600 å·®ç•°ï¼ˆé«˜é »å•é¡Œï¼ï¼‰ï¼š**
AST2600 çš„ä¸»è¦å‡ç´šï¼š
1. CPU å‡ç´š
   - AST2500: å–®æ ¸ ARM926EJ-S (200MHz)
   - AST2600: é›™æ ¸ Cortex-A7 (800MHz)
   - æ•ˆèƒ½æå‡ç´„ 4-5 å€

2. PCIe æ”¯æ´ï¼ˆé‡è¦ï¼ï¼‰
   - AST2600 æ”¯æ´ PCIeï¼Œå¯ç”¨æ–¼ MCTP over PCIe
   - é€™å° PLDM é€šè¨Šå¾ˆé‡è¦ï¼ˆæ›´å¿«ã€æ›´å¯é ï¼‰

3. å®‰å…¨åŠŸèƒ½å¢å¼·
   - å®Œæ•´çš„ Secure Boot æ”¯æ´
   - Hardware Root of Trust
   - OTP (One-Time Programmable) å„²å­˜é‡‘é‘°

4. è¨˜æ†¶é«”å‡ç´š
   - AST2500: DDR3
   - AST2600: DDR4

### é€£æ¥ä»‹é¢è©³è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BMC é€£æ¥ä»‹é¢è©³è§£                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  å°å¤–ä»‹é¢ (External)                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Ethernet   â”‚ ç®¡ç†ç¶²è·¯ï¼ŒRedfish/IPMI/SSH                  â”‚  â”‚
â”‚  â”‚            â”‚ Dedicated (ç¨ç«‹ç¶²å£) æˆ– Shared (å…±äº«)        â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ USB        â”‚ Virtual Media (é ç«¯æ›è¼‰ ISO/FD)             â”‚  â”‚
â”‚  â”‚            â”‚ Virtual Keyboard/Mouse (KVM)                â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ VGA/HDMI   â”‚ Video output (ç›´æ¥é€£æ¥è¢å¹•)                 â”‚  â”‚
â”‚  â”‚            â”‚ KVM over IP (é ç«¯è¢å¹•)                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  å°å…§ä»‹é¢ (Internal)                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ I2C/SMBus  â”‚ æ„Ÿæ¸¬å™¨ï¼ˆæº«åº¦ã€é›»å£“ã€é›»æµï¼‰                  â”‚  â”‚
â”‚  â”‚            â”‚ EEPROM (FRU Data)ã€DIMM SPD                 â”‚  â”‚
â”‚  â”‚            â”‚ é›»æºç®¡ç† IC (PSU, VR)                       â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ LPC/eSPI   â”‚ Host â†” BMC é€šè¨Š (IPMI KCS/BT)              â”‚  â”‚
â”‚  â”‚            â”‚ SPI Flash å­˜å–ï¼ˆBIOS/MEï¼‰                   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ PCIe       â”‚ é«˜é€Ÿ Host é€šè¨Š (MCTP)                       â”‚  â”‚
â”‚  â”‚            â”‚ AST2600 é–‹å§‹æ”¯æ´                            â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ GPIO       â”‚ é›»æºæ§åˆ¶ (Power Button, Reset)              â”‚  â”‚
â”‚  â”‚            â”‚ ç‹€æ…‹è®€å– (Power Good, SLP_S3)               â”‚  â”‚
â”‚  â”‚            â”‚ LED æ§åˆ¶                                    â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ UART       â”‚ Debug Console (SOL)                         â”‚  â”‚
â”‚  â”‚            â”‚ Host Serial console redirect                â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ SPI        â”‚ BMC SPI Flashï¼ˆå­˜ BMC éŸŒé«”ï¼‰                â”‚  â”‚
â”‚  â”‚            â”‚ Host SPI Flashï¼ˆå­˜ BIOSï¼ŒæŸäº›è¨­è¨ˆå¯å­˜å–ï¼‰   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ PECI       â”‚ Intel å°ˆç”¨ä»‹é¢ï¼Œè®€å– CPU è³‡è¨Š              â”‚  â”‚
â”‚  â”‚            â”‚ æº«åº¦ã€åŠŸç‡ã€éŒ¯èª¤ç­‰                          â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ JTAG       â”‚ Debug ç”¨é€”                                  â”‚  â”‚
â”‚  â”‚            â”‚ BIOS/CPLD æ›´æ–°                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ å¸¸è¦‹ BMC é¢è©¦å•é¡Œ

**Q1ï¼šä»€éº¼æ˜¯ BMCï¼Ÿç‚ºä»€éº¼éœ€è¦å®ƒï¼Ÿ**
BMC (Baseboard Management Controller) æ˜¯ä¼ºæœå™¨çš„ç¨ç«‹ç®¡ç†è™•ç†å™¨ã€‚

ç‚ºä»€éº¼éœ€è¦ï¼š
1. å³ä½¿ä¸»æ©Ÿé—œæ©Ÿä¹Ÿèƒ½é ç«¯ç®¡ç†
2. ç›£æ§ç¡¬é«”å¥åº·ç‹€æ…‹
3. æä¾›æ•…éšœè¨ºæ–·å’Œå›å¾©æ©Ÿåˆ¶
4. æ”¯æ´å¤§è¦æ¨¡æ•¸æ“šä¸­å¿ƒçš„è‡ªå‹•åŒ–ç®¡ç†

BMC è®“ç®¡ç†è€…ä¸éœ€è¦å¯¦é«”æ¥è§¸ä¼ºæœå™¨å°±èƒ½é€²è¡Œç®¡ç†æ“ä½œã€‚

**Q1-1ï¼šè«‹è§£é‡‹ In-band å’Œ Out-of-band Management çš„å·®ç•°ï¼Ÿ**
æ ¸å¿ƒå·®ç•°åœ¨æ–¼ã€Œæ˜¯å¦ä¾è³´ä½œæ¥­ç³»çµ±ã€ä¾†ç®¡ç†ä¼ºæœå™¨ã€‚

1. In-band Management (å¸¶å…§ç®¡ç†)ï¼š
   - ä¾è³´ OS (Windows/Linux) é‹ä½œã€‚
   - ä½¿ç”¨ Host ç«¯çš„ç¶²è·¯ (LAN) å’Œè»Ÿé«” (SSH, RDP, Agent)ã€‚
   - ç¼ºé»ï¼šOS ç•¶æ©Ÿæˆ–ç¶²è·¯æ–·ç·šæ™‚ç„¡æ³•æ•‘æ´ã€‚

2. Out-of-band Management (å¸¶å¤–ç®¡ç†, OOB)ï¼š
   - ä¸ä¾è³´ OSï¼Œç”± BMC æ™¶ç‰‡ç¨ç«‹é‹ä½œåŠä¾›é›»ã€‚
   - ä½¿ç”¨ç¨ç«‹æˆ–å…±äº«çš„ BMC ç¶²è·¯é€šé“ã€‚
   - å„ªé»ï¼šå³ä½¿ OS è—å± (BSOD)ã€é—œæ©Ÿæˆ–ç¡¬ç¢Ÿæå£ï¼Œä»å¯æ§åˆ¶ã€‚

å¸¸è¦‹ OOBæ‡‰ç”¨å ´æ™¯ï¼š
- é ç«¯é›»æºæ§åˆ¶ (Power Cycle)ï¼šè§£æ±ºæ­»æ©Ÿå•é¡Œã€‚
- KVM over IPï¼šé ç«¯çœ‹ BIOS ç•«é¢ã€POSTä»£ç¢¼ã€‚
- Virtual Mediaï¼šé ç«¯æ›è¼‰ ISO æª”é‡çŒç³»çµ±ã€‚



å•ï¼š
ã€Œç‚ºä»€éº¼æˆ‘å€‘éœ€è¦ Out-of-band managementï¼Ÿã€æˆ–è€…ã€ŒBMC æä¾›äº†ä»€éº¼åƒ¹å€¼ï¼Ÿã€

ç­”ï¼š
ã€ŒOut-of-band management è®“ç³»çµ±ç®¡ç†å“¡å¯ä»¥åœ¨ä¼ºæœå™¨åŠå…¶ä½œæ¥­ç³»çµ±å®Œå…¨å¤±æ•ˆ (BSOD/Kernel Panic) æˆ–é—œæ©Ÿçš„ç‹€æ…‹ä¸‹ï¼Œä»ç„¶èƒ½é€éç¨ç«‹çš„ BMC ç¶²è·¯é€šé“é€²è¡Œæ•‘æ´ã€é‡å•Ÿæˆ–é‡æ–°å®‰è£ç³»çµ±ã€‚é€™å°æ–¼å¤§è¦æ¨¡è³‡æ–™ä¸­å¿ƒçš„è‡ªå‹•åŒ–ç¶­é‹è‡³é—œé‡è¦ï¼Œå› ç‚ºæˆ‘å€‘ç„¡æ³•æ´¾äººå»ç¾å ´æŒ‰æ¯ä¸€å°æ©Ÿå™¨çš„é›»æºéµã€‚ã€

### æŠ€è¡“è£œå…… (åŠ åˆ†é¡Œ)

1. ç¨ç«‹é€šé“ï¼š
   - OOB é€šå¸¸ä½¿ç”¨èˆ‡ Host OS åˆ†é–‹çš„ç¶²è·¯ä»‹é¢ (Dedicated Mgmt Port)ï¼Œæˆ–è€…é€é NC-SI æŠ€è¡“å…±äº«ç¶²å­” (Shared NIC)ã€‚
   - æµé‡åœ¨ç¶²å¡å…§éƒ¨å°±æœƒåˆ†æµçµ¦ BMCï¼Œä¸æœƒé€²å…¥ Host OSï¼Œç¢ºä¿äº†é€™æ¢é€šé“çš„ç¨ç«‹æ€§èˆ‡å®‰å…¨æ€§ã€‚

2. å®‰å…¨éš±æ†‚ï¼š
   - å› ç‚º OOB æ¬Šé™æ¥µå¤§ï¼ˆèƒ½æ§åˆ¶é›»æºã€çœ‹ç•«é¢ï¼‰ï¼Œæ‰€ä»¥ç¾åœ¨éå¸¸é‡è¦–å®‰å…¨æ€§ï¼ˆSecure Boot, PFR, æ¬Šé™æ§ç®¡ï¼‰ã€‚
   - é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼ IPMI é€æ¼¸è¢« Redfish (HTTPS) å–ä»£çš„åŸå› ä¹‹ä¸€ã€‚


**Q2ï¼šä½ åœ¨ OpenBMC ä¸­åšéä»€éº¼ï¼Ÿ**
æº–å‚™ 2-3 å€‹å…·é«”çš„å°ˆæ¡ˆæ¡ˆä¾‹ï¼Œç”¨ STAR æ³•å‰‡å›ç­”ã€‚

ç¯„ä¾‹ï¼š
ã€Œæˆ‘è² è²¬å¯¦ä½œ XXX sensor çš„æ”¯æ´ã€‚é¦–å…ˆç ”ç©¶äº† datasheetï¼Œ
è¨­å®šäº† I2C device tree node å’Œ hwmon é…ç½®ï¼Œ
ç„¶å¾Œé©—è­‰ D-Bus ä¸Šå¯ä»¥æ­£ç¢ºè®€å–æ•¸å€¼ã€‚
é‡åˆ° sensor æ•¸å€¼ä¸ç©©å®šçš„å•é¡Œï¼Œç¶“éåˆ†æç™¼ç¾æ˜¯ I2C noiseï¼Œ
åŠ äº† retry æ©Ÿåˆ¶å¾Œè§£æ±ºã€‚ã€

**Q3ï¼šå¦‚ä½• debug BMC ä¸Šçš„å•é¡Œï¼Ÿ**
1. æ—¥èªŒåˆ†æï¼š
   - journalctl -f
   - dmesg

2. D-Bus æª¢æŸ¥ï¼š
   - busctl list
   - busctl introspect

3. ç¡¬é«”å±¤ç´šï¼š
   - i2cdetect / i2cget / i2cset
   - devmem (è®€æš«å­˜å™¨)
   - ç¤ºæ³¢å™¨/é‚è¼¯åˆ†æå„€

4. ç¶²è·¯å•é¡Œï¼š
   - ping, tcpdump, wireshark

5. æœå‹™ç‹€æ…‹ï¼š
   - systemctl status

**Q4ï¼šIPMI å’Œ Redfish çš„å·®ç•°ï¼Ÿ**
IPMIï¼š
- è¼ƒèˆŠæ¨™æº–ï¼ˆ1998å¹´ï¼‰
- äºŒé€²ä½å”å®š
- å®‰å…¨æ€§è¼ƒå¼±
- åŠŸèƒ½è¼ƒå›ºå®š

Redfishï¼š
- ç¾ä»£æ¨™æº–ï¼ˆ2015å¹´ï¼‰
- RESTful JSON API
- HTTPS åŠ å¯†
- æ“´å±•æ€§å¥½ã€æ–‡ä»¶æ¸…æ¥š

è¶¨å‹¢ï¼š
- æ–°ç³»çµ±ä»¥ Redfish ç‚ºä¸»
- IPMI ä¿æŒå‘å¾Œç›¸å®¹

**Q5ï¼šå¦‚ä½•è™•ç† sensor è®€å–å•é¡Œï¼Ÿ**
Debug æ­¥é©Ÿï¼š

1. ç¢ºèªç¡¬é«”é€£æ¥
   - i2cdetect çœ‹ device æœ‰æ²’æœ‰å‡ºç¾
   
2. ç¢ºèª driver è¼‰å…¥ï¼ˆé—œéµï¼ï¼‰
   - **lsmod**ï¼šæª¢æŸ¥æ˜¯å¦ç‚º Module (è‹¥ç‚º Built-in å‰‡çœ‹ä¸åˆ°)ã€‚
   - **dmesg**ï¼šæœ€é€šç”¨ã€‚æœå°‹ driver åç¨±æˆ– `probe` è¨Šæ¯ã€‚
     - æˆåŠŸï¼š`detected XXX chip`
     - å¤±æ•—ï¼š`probe failed, error -N`
   - **sysfs** (æœ€æº–ç¢º)ï¼šæª¢æŸ¥ `/sys/bus/i2c/devices/<bus>-<addr>/driver` æ˜¯å¦æœ‰é€£çµã€‚
     - æˆ–çœ‹ `/sys/class/hwmon` ä¸‹æ˜¯å¦æœ‰å°æ‡‰ç¯€é»ã€‚

3. ç¢ºèª sysfs 
   - cat /sys/class/hwmon/hwmonX/temp1_input

4. ç¢ºèª D-Bus
   - busctl get-property ...

5. ç¢ºèª Redfish/IPMI
   - curl Redfish API
   - ipmitool sensor list

é€å±¤æ’æŸ¥ï¼Œæ‰¾å‡ºå•é¡Œé»ã€‚

### è§€å¿µé‡æ¸…ï¼šDriver Loading å¸¸è¦‹èª¤å€

é€™æ˜¯åœ¨åº•å±¤é©…å‹•é¢è©¦ä¸­éå¸¸å®¹æ˜“è¢«æ··æ·†çš„è§€å¿µï¼Œè«‹å‹™å¿…ææ¸…æ¥šã€‚

#### 1. Built-in (`=y`) vs Loadable Module (`=m`)
é€™æ˜¯ Kernel Compile (`make menuconfig`) æ™‚çš„è¨­å®šå·®ç•°ã€‚

| ç‰¹æ€§ | Built-in (`=y`) | Loadable Module (`=m`) |
| :--- | :--- | :--- |
| **å­˜åœ¨å½¢å¼** | ç›´æ¥ç·¨è­¯åœ¨ Kernel Image å…§ | ç¨ç«‹çš„ `.ko` æª”æ¡ˆ (åœ¨ `/lib/modules`) |
| **è¨˜æ†¶é«”** | é–‹æ©Ÿå³ä½”ç”¨ï¼Œç›´åˆ°é—œæ©Ÿ | éœ€è¦æ™‚æ‰è¼‰å…¥ `insmod`ï¼Œä¸ç”¨æ™‚å¯å¸è¼‰ `rmmod` |
| **lsmod** | **çœ‹ä¸è¦‹** (å› ç‚ºæ˜¯ä¸€é«”çš„) | **çœ‹å¾—è¦‹** |
| **OpenBMC** | **90% éƒ½æ˜¯é€™ä¸€é¡** (ç©©å®š/å¿«é€Ÿ) | å°‘ç”¨ï¼Œå¤šç”¨æ–¼ Debug æˆ–éå¿…è¦å‘¨é‚Š |

**è¿·æ€**ï¼šã€Œæˆ‘çœ‹ä¸åˆ° `.ko` æª”æˆ–æ˜¯ `lsmod` æ²’æ±è¥¿ï¼Œå°±æ˜¯æ²’ Driverï¼Ÿã€
**ä¿®æ­£**ï¼šéŒ¯ï¼OpenBMC å¤§å¤šæ•¸ Driver (å¦‚ `lm75`, `tmp421`) éƒ½æ˜¯ Built-in çš„ã€‚

#### 2. Device Tree (DTS) çš„è§’è‰²
DTS æ˜¯ä¸€ä»½**ã€Œéœæ…‹ç¡¬é«”é»åç°¿ã€**ã€‚
*   å®ƒå‘Šè¨´ Kernelï¼šã€Œé€™è£¡æœ‰ä¸€å€‹ç¡¬é«”å«åš `compatible = "aspeed,ast2600-i2c"`ã€ã€‚
*   **é‡é»**ï¼šDTS è£¡çš„è£ç½®ï¼Œå…¶ Driver **å¯ä»¥æ˜¯ Built-in ä¹Ÿå¯ä»¥æ˜¯ Module**ã€‚
*   **æµç¨‹**ï¼šKernel é–‹æ©Ÿ â†’ è®€å– DTS â†’ ç™¼ç¾è£ç½® â†’ åœ¨å·²è¼‰å…¥çš„ Driver ä¸­å°‹æ‰¾é…å° â†’ åŸ·è¡Œ `probe`ã€‚

#### 3. Entity-Manager çš„è§’è‰²
Entity-Manager æ˜¯ä¸€å€‹**ã€Œå‹•æ…‹ç¡¬é«”é»åå“¡ã€** (User Space Service)ã€‚
*   **å ´æ™¯**ï¼šRiser Card æˆ– Backplane é€™ç¨®**é–‹æ©Ÿæ™‚ä¸ä¸€å®šå­˜åœ¨**çš„ç¡¬é«”ã€‚
*   **æµç¨‹**ï¼šEntity-Manager è®€å– FRU â†’ è¾¨è­˜å‡ºç¡¬é«” â†’ é€šçŸ¥ Kernel å»ºç«‹è£ç½® (Instantiate)ã€‚
*   **è¿·æ€**ï¼šã€ŒEntity-Manager æƒæåˆ°æ‰å» Load Driverï¼Ÿã€
*   **ä¿®æ­£**ï¼šéŒ¯ï¼é€šå¸¸ Driver (å¦‚ `tmp75`) **æ—©å°±ä»¥ Built-in çš„å½¢å¼å­˜åœ¨ Kernel è£¡ç­‰å¾…äº†**ã€‚Entity-Manager åªæ˜¯è§¸ç™¼ã€Œè£ç½®ç”Ÿæˆå¯¦ä¾‹ã€ï¼Œè®“ Driver æœ‰å·¥ä½œåšè€Œå·²ã€‚

#### 4. é¢è©¦å›ç­”ç­–ç•¥
> ã€ŒDevice Tree å®šç¾©**éœæ…‹**å­˜åœ¨çš„ç¡¬é«”ï¼ŒEntity-Manager è™•ç†**å‹•æ…‹**ç™¼ç¾çš„ç¡¬é«”ã€‚
> è‡³æ–¼ Driver æ˜¯ Built-in é‚„æ˜¯ Moduleï¼Œå–æ±ºæ–¼ç·¨è­¯è¨­å®šã€‚
> åœ¨ OpenBMC ä¸­ï¼Œç‚ºäº†ç¢ºä¿æ„Ÿæ¸¬å™¨éš¨æ’å³ç”¨ä¸”ç©©å®šï¼Œé€™é¡ Sensor Driver é€šå¸¸éƒ½ç·¨è­¯ç‚º **Built-in**ã€‚ã€

#### 5. æ·±å…¥è§£æï¼šDevice Instantiation (è£ç½®å¯¦ä¾‹åŒ–)

é€™æ˜¯ Linux Driver Model çš„æ ¸å¿ƒè§€å¿µï¼Œæ‡‚é€™å€‹èƒ½è­‰æ˜ä½ ä¸æ˜¯åªæœƒæŠ„ codeã€‚

**è§€å¿µæ¯”å–»ï¼š**
*   **Driver Loading (è¼‰å…¥é©…å‹•)**ï¼š
    *   åƒæ˜¯ã€Œè˜è«‹äº†ä¸€ä½æ°´é›»å·¥ (Driver)ã€ï¼Œä»–æ‡‚ä¿®åœ‹éš›ç‰Œå†·æ°£ã€‚æ­¤æ™‚ä»–åªæ˜¯åœ¨è¾¦å…¬å®¤å–èŒ¶ (Memory Resident)ã€‚
    *   å°æ‡‰ï¼š`insmod` æˆ– `Built-in`ã€‚
*   **Device Instantiation (è£ç½®å¯¦ä¾‹åŒ–)**ï¼š
    *   åƒæ˜¯ã€Œé–‹äº†ä¸€å¼µç¶­ä¿®å–® (Instance)ã€ï¼Œä¸Šé¢å¯«è‘—ã€Œ3 æ¨“æœƒè­°å®¤ (Bus 3) çš„è§’è½ (Address 0x48) æœ‰ä¸€å°åœ‹éš›ç‰Œå†·æ°£ã€ã€‚
    *   å°æ‡‰ï¼šDTS å®šç¾©æˆ– Entity-Manager ç”Ÿæˆã€‚
*   **Binding (é…å°)**ï¼š
    *   å·¥å» ä¸»ç®¡ (Kernel) çœ‹åˆ°å–®å­ï¼Œå«æ°´é›»å·¥å»ç¾å ´ã€‚é€™æ™‚æ°´é›»å·¥æ‰çœŸæ­£é–‹å§‹å·¥ä½œ (`probe`)ã€‚

**æŠ€è¡“å®šç¾©ï¼š**
Instantiation å°±æ˜¯åœ¨ Kernel Space å»ºç«‹ä¸€å€‹ä»£è¡¨è©²ç¡¬é«”çš„ `struct device` (å¦‚ `i2c_client`)ã€‚å¸¸è¦‹æ–¹å¼æœ‰äºŒï¼š

1.  **Static (DTS)**ï¼š
    *   å¯«åœ¨ `.dts` æª”ã€‚é–‹æ©Ÿæ™‚ Kernel è‡ªå‹•è®€æ¸…å–®ä¸¦å¯¦ä¾‹åŒ–ã€‚
    *   é©ç”¨ï¼šä¸»æ©Ÿæ¿ä¸Šç„Šæ­»çš„ ICã€‚

2.  **User-space (sysfs) ïƒ§ Entity-Manager ç”¨çš„æ–¹æ³•**ï¼š
    *   æŒ‡ä»¤ï¼š`echo tmp75 0x48 > /sys/bus/i2c/devices/i2c-1/new_device`
    *   å‘Šè¨´ Kernel åœ¨æŒ‡å®šä½ç½®ç”Ÿæˆå¯¦ä¾‹ï¼ŒKernel éš¨å³å–šé†’ Driver é€²è¡Œ probeã€‚

**çµè«–**ï¼šDriver è¼‰å…¥ä¸ä»£è¡¨æœƒå·¥ä½œï¼Œå¿…é ˆè¦æœ‰ Device Instantiation æ‰æœƒè§¸ç™¼ probeã€‚


**Q6ï¼šä»€éº¼æ˜¯ Secure Bootï¼ŸBMC å¦‚ä½•å¯¦ç¾ï¼Ÿ**
Secure Boot ç¢ºä¿åªæœ‰ç¶“éç°½ç« é©—è­‰çš„ç¨‹å¼ç¢¼æ‰èƒ½åŸ·è¡Œã€‚

BMC Secure Boot æµç¨‹ï¼š
1. Boot ROM é©—è­‰ SPL/U-Boot
2. U-Boot é©—è­‰ Kernel (FIT image)
3. Kernel é©—è­‰ rootfs (å¯é¸)

å¯¦ä½œæ–¹å¼ï¼š
- ä½¿ç”¨éå°ç¨±åŠ å¯†ï¼ˆRSA/ECDSAï¼‰
- å…¬é‘°ç‡’éŒ„åœ¨ OTP (One-Time Programmable) è¨˜æ†¶é«”
- æ¯ä¸€å±¤éƒ½é©—è­‰ä¸‹ä¸€å±¤çš„ç°½ç« 

OpenBMC æ”¯æ´é€šé Phosphor-software-manager é€²è¡Œç°½ç« é©—è­‰ã€‚

---

## ğŸ”· NVIDIA / AMD / Intel ç‰¹å®šæº–å‚™

### NVIDIAï¼ˆé‡é»ç›®æ¨™ï¼ï¼‰

NVIDIA çš„ BMC ç›¸é—œè·ä½æ˜¯ä½ çš„æœ€ä½³ç›®æ¨™ï¼
ä»–å€‘å¤§é‡ä½¿ç”¨ OpenBMCï¼Œä¸”éå¸¸é‡è¦– GPU ç®¡ç†ã€‚

**NVIDIA ç”¢å“ç·šï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NVIDIA ä¼ºæœå™¨ç”¢å“                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. DGX ç³»åˆ—ï¼ˆå®Œæ•´ AI ä¼ºæœå™¨ï¼‰                              â”‚
â”‚     - DGX A100: 8x A100 GPU                                â”‚
â”‚     - DGX H100: 8x H100 GPU                                â”‚
â”‚     - DGX B100: 8x B100 GPUï¼ˆæœ€æ–°ï¼‰                        â”‚
â”‚     BMC è² è²¬ç›£æ§æ‰€æœ‰ GPU æº«åº¦ã€åŠŸç‡ã€éŒ¯èª¤                   â”‚
â”‚                                                             â”‚
â”‚  2. HGX å¹³å°ï¼ˆGPU åŠ é€Ÿå™¨æ¨¡çµ„ï¼Œè³£çµ¦ OEMï¼‰                    â”‚
â”‚     - OEM å¦‚ Dellã€HPEã€Lenovo ä½¿ç”¨                        â”‚
â”‚     - BMC éœ€è¦å’Œ Host BMC æ•´åˆ                             â”‚
â”‚                                                             â”‚
â”‚  3. Grace Hopper Superchip                                  â”‚
â”‚     - ARM CPU + Hopper GPU æ•´åˆ                            â”‚
â”‚     - éœ€è¦åŒæ™‚ç®¡ç† CPU å’Œ GPU                               â”‚
â”‚                                                             â”‚
â”‚  4. BlueField DPU (Data Processing Unit)                    â”‚
â”‚     - æ™ºæ…§ç¶²å¡ï¼Œæœ‰è‡ªå·±çš„ ARM CPU å’Œ BMC                    â”‚
â”‚     - å¦ä¸€å€‹ BMC åœ˜éšŠåœ¨é–‹ç™¼                                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**NVIDIA BMC æŠ€è¡“é‡é»ï¼š**
1. GPU ç›£æ§
   - GPU æº«åº¦è®€å–ï¼ˆé€é I2C/SMBus æˆ– PLDMï¼‰
   - GPU åŠŸç‡ç›£æ§ï¼ˆTDP ç®¡ç†ï¼‰
   - GPU Memory éŒ¯èª¤ï¼ˆECC Errorï¼‰
   - NVLink ç‹€æ…‹ç›£æ§

2. Thermal Management
   - GPU Thermal Throttling
   - é¢¨æ‰‡è½‰é€Ÿæ§åˆ¶ï¼ˆæ ¹æ“š GPU æº«åº¦èª¿ç¯€ï¼‰
   - Power Cappingï¼ˆé™åˆ¶åŠŸç‡ä»¥æ§åˆ¶æº«åº¦ï¼‰

3. PLDM/MCTPï¼ˆéå¸¸é‡è¦ï¼ï¼‰
   - GPU éŸŒé«”é€é PLDM å’Œ BMC é€šè¨Š
   - æ„Ÿæ¸¬å™¨è³‡æ–™é€é PLDM Type 2
   - éŸŒé«”æ›´æ–°é€é PLDM Type 4

4. SPDM å®‰å…¨
   - GPU éŸŒé«”ç°½ç« é©—è­‰
   - Device Authentication

5. Redfish
   - GPU è³‡è¨Šé€é Redfish æš´éœ²
   - å¯èƒ½ä½¿ç”¨ OEM æ“´å±•

**NVIDIA é¢è©¦å¯èƒ½å•é¡Œï¼š**
1. ã€Œå¦‚ä½•é€é BMC ç›£æ§ GPU æº«åº¦ï¼Ÿã€
   â†’ I2C/SMBus è®€å– GPU çš„æº«åº¦æš«å­˜å™¨
   â†’ æˆ–é€é PLDM Type 2 Sensor è®€å–
   â†’ ç™¼å¸ƒåˆ° D-Busï¼Œå†é€é Redfish æš´éœ²

2. ã€Œä»€éº¼æ˜¯ NVLinkï¼ŸBMC å¦‚ä½•ç›£æ§ï¼Ÿã€
   â†’ NVLink æ˜¯ GPU é–“çš„é«˜é€Ÿäº’é€£
   â†’ BMC å¯è®€å– NVLink éŒ¯èª¤è¨ˆæ•¸å™¨
   â†’ åµæ¸¬åˆ°éŒ¯èª¤æ™‚ç”¢ç”Ÿ SEL äº‹ä»¶

3. ã€ŒGPU éç†±æ™‚ BMC æœƒåšä»€éº¼ï¼Ÿã€
   â†’ å…ˆå¢åŠ é¢¨æ‰‡è½‰é€Ÿ
   â†’ é€šçŸ¥ Host é€²è¡Œ Thermal Throttling
   â†’ åš´é‡æ™‚è§¸ç™¼ä¿è­·æ€§é—œæ©Ÿ

4. ã€Œä½ äº†è§£ PLDM/MCTP å—ï¼Ÿã€
   â†’ æº–å‚™å¥½ PLDM æ¶æ§‹çš„å›ç­”ï¼

---

### AMD

AMD çš„ BMC è·ä½ä¹Ÿå¾ˆå¥½ï¼Œç‰¹åˆ¥æ˜¯ EPYC ä¼ºæœå™¨ç›¸é—œã€‚
ä»–å€‘éå¸¸é‡è¦–å®‰å…¨æ€§ï¼

**AMD ç”¢å“ç·šï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AMD ä¼ºæœå™¨ç”¢å“                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. EPYC ä¼ºæœå™¨ CPU                                         â”‚
â”‚     - Genoa (7004 ç³»åˆ—)                                     â”‚
â”‚     - Turin (ä¸‹ä¸€ä»£)                                        â”‚
â”‚     - éœ€è¦ BMC è®€å– CPU æº«åº¦ã€åŠŸç‡ã€éŒ¯èª¤                    â”‚
â”‚                                                             â”‚
â”‚  2. Instinct GPU åŠ é€Ÿå™¨                                     â”‚
â”‚     - MI300X (AI è¨“ç·´)                                      â”‚
â”‚     - MI300A (APU: CPU + GPU)                              â”‚
â”‚     - éœ€è¦ BMC ç›£æ§ GPUï¼Œé¡ä¼¼ NVIDIA                        â”‚
â”‚                                                             â”‚
â”‚  3. Pensando DPU                                            â”‚
â”‚     - é¡ä¼¼ NVIDIA BlueField                                 â”‚
â”‚     - æ™ºæ…§ç¶²å¡                                              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**AMD BMC æŠ€è¡“é‡é»ï¼š**
1. å®‰å…¨æ€§ï¼ˆAMD è¶…é‡è¦–ï¼ï¼‰
   - Secure Bootï¼ˆå¿…é ˆäº†è§£ï¼ï¼‰
   - Root of Trust (RoT)
   - SPDM å…ƒä»¶é©—è­‰
   - SPI ROM å¯«å…¥ä¿è­·

2. AMD PSP (Platform Security Processor)
   - AMD CPU å…§å»ºçš„å®‰å…¨è™•ç†å™¨
   - è² è²¬å®‰å…¨å•Ÿå‹•ã€é‡‘é‘°ç®¡ç†
   - BMC å¯èƒ½éœ€è¦å’Œ PSP äº’å‹•

3. PLDM/MCTP
   - CPU è³‡è¨Šé€é PLDM å–å¾—
   - BIOS è¨­å®šé€é PLDM Type 3

4. é›»æºç®¡ç†
   - EPYC çš„ Power Capping
   - é›»æºç‹€æ…‹å ±å‘Š

**AMD é¢è©¦å¯èƒ½å•é¡Œï¼š**
1. ã€Œä»€éº¼æ˜¯ Secure Bootï¼Ÿå¦‚ä½•åœ¨ BMC ä¸Šå¯¦ç¾ï¼Ÿã€
   â†’ Boot ROM â†’ SPL â†’ U-Boot â†’ Kernel â†’ Rootfs
   â†’ æ¯ä¸€å±¤éƒ½é©—è­‰ä¸‹ä¸€å±¤çš„ç°½ç« 
   â†’ å…¬é‘°å­˜åœ¨ OTPï¼ˆä¸å¯ä¿®æ”¹ï¼‰

2. ã€Œä»€éº¼æ˜¯ Root of Trustï¼Ÿã€
   â†’ å®‰å…¨ä¿¡ä»»çš„æœ€åº•å±¤ä¾†æº
   â†’ é€šå¸¸æ˜¯ Boot ROM + OTP å…¬é‘°
   â†’ å¦‚æœ RoT è¢«ç ´å£ï¼Œæ•´å€‹å®‰å…¨é«”ç³»å´©æ½°

3. ã€ŒSPDM å¦‚ä½•é©—è­‰å…ƒä»¶èº«ä»½ï¼Ÿã€
   â†’ GET_VERSION â†’ CAPABILITIES â†’ 
   â†’ NEGOTIATE_ALGORITHMS â†’ GET_CERTIFICATE â†’ CHALLENGE
   â†’ é©—è­‰ Device çš„ç§é‘°ç°½ç« 

4. ã€Œå¦‚ä½•ä¿è­· SPI Flash ä¸è¢«ç«„æ”¹ï¼Ÿã€
   â†’ ç¡¬é«”å¯«ä¿è­·ï¼ˆWP pinï¼‰
   â†’ è»Ÿé«”å¯«ä¿è­·ï¼ˆStatus Registerï¼‰
   â†’ Verified Bootï¼ˆæ¯æ¬¡é–‹æ©Ÿé©—è­‰ï¼‰

---

### Intel

Intel ä¹Ÿæ˜¯ BMC çš„é‡è¦ç©å®¶ï¼Œä½†ä»–å€‘æ›´å¤šæ˜¯å¹³å°æ•´åˆã€‚

**Intel BMC ç›¸é—œé‡é»ï¼š**
1. Xeon è™•ç†å™¨
   - PECI (Platform Environment Control Interface)
   - CPU æº«åº¦è®€å–
   - Run-time åŠŸç‡æ§åˆ¶

2. BMC æ™¶ç‰‡ç”Ÿæ…‹
   - é›–ç„¶ Intel ä¸åš BMC SoC
   - ä½† x86 å¹³å°çš„ BMC æ•´åˆç”± Intel ä¸»å°

3. å®‰å…¨æŠ€è¡“
   - Intel SGX (Software Guard Extensions)
   - Intel TXT (Trusted Execution Technology)

---

## ğŸŒ å¤–å•†é¢è©¦è‹±æ–‡æº–å‚™

> å¤–å•†é¢è©¦é€šå¸¸æœƒæœ‰è‹±æ–‡ç’°ç¯€ï¼æº–å‚™å¥½æŠ€è¡“è‹±æ–‡ã€‚

**å¸¸è¦‹è‹±æ–‡å•ç­”ï¼š**
**Q: "Can you describe the BMC architecture?"**
*   **A**: "BMC, or Baseboard Management Controller, is an independent 
    embedded system on the server motherboard. It runs Linux and 
    provides out-of-band management capabilities like power control, 
    hardware monitoring, and console access, even when the host 
    system is powered off."

**Q: "What's the difference between IPMI and Redfish?"**
*   **A**: "IPMI is the legacy protocol using binary format over UDP. 
    Redfish is the modern RESTful API using JSON over HTTPS. 
    Redfish provides better security, human readability, and 
    extensibility, which is why it's becoming the industry standard."

**Q: "How do you debug a sensor reading issue?"**
*   **A**: "I would debug from bottom to top: First check I2C connectivity 
    with i2cdetect, then verify the kernel driver with dmesg, 
    check sysfs for raw values, verify D-Bus objects with busctl, 
    and finally confirm the Redfish API response."

**Q: "Tell me about your OpenBMC experience."**
*   **A**: (ç”¨ STAR æ³•å‰‡å›ç­”ï¼Œæº–å‚™å¥½ä½ çš„å°ˆæ¡ˆç¶“é©—ï¼)

**æŠ€è¡“è‹±æ–‡è©å½™ï¼š**
Hardware Layer:
- SoC (System on Chip)
- GPIO (General Purpose Input/Output)
- I2C (Inter-Integrated Circuit)
- SPI (Serial Peripheral Interface)
- UART (Universal Asynchronous Receiver-Transmitter)

BMC Terms:
- Out-of-band management (å¸¶å¤–ç®¡ç†)
- Power cycling (é›»æºé‡å•Ÿ)
- Thermal throttling (éç†±é™é€Ÿ)
- Watchdog timer (çœ‹é–€ç‹—)
- SEL - System Event Log (ç³»çµ±äº‹ä»¶æ—¥èªŒ)
- FRU - Field Replaceable Unit (ç¾å ´å¯æ›¿æ›å–®å…ƒ)
- SDR - Sensor Data Record (æ„Ÿæ¸¬å™¨è³‡æ–™è¨˜éŒ„)

Protocols:
- IPMI - Intelligent Platform Management Interface
- Redfish - RESTful API for server management
- PLDM - Platform Level Data Model
- MCTP - Management Component Transport Protocol
- SPDM - Security Protocol and Data Model

---

## âœ… é¢è©¦å‰æª¢æŸ¥æ¸…å–®

```
=== BMC åŸºç¤ ===
â˜ èƒ½ç”¨ç”Ÿæ´»åŒ–æ¯”å–»è§£é‡‹ BMC æ˜¯ä»€éº¼
â˜ çŸ¥é“ BMC çš„ç¡¬é«”æ¶æ§‹ï¼ˆSoCã€ä»‹é¢ï¼‰
â˜ äº†è§£ BMC å’Œ Host çš„é€šè¨Šæ–¹å¼ï¼ˆLPCã€PCIeã€I2Cï¼‰
â˜ èƒ½è§£é‡‹ç‚ºä»€éº¼éœ€è¦ BMCï¼ˆOut-of-band ç®¡ç†ï¼‰

=== å”å®šçŸ¥è­˜ ===
â˜ èƒ½ç•«å‡º IPMI æ¶æ§‹åœ–
â˜ çŸ¥é“å¸¸ç”¨ IPMI commands å’Œ NetFn
â˜ èƒ½èªªæ˜ IPMI çš„å®‰å…¨å•é¡Œ
â˜ èƒ½ç•«å‡º Redfish API çµæ§‹
â˜ æœƒç”¨ curl æ“ä½œ Redfish API
â˜ èƒ½æ¯”è¼ƒ IPMI vs Redfishï¼ˆå¹´ä»½ã€æ ¼å¼ã€å®‰å…¨æ€§ï¼‰
â˜ äº†è§£ PLDM/MCTP æ¶æ§‹å’Œç”¨é€”
â˜ èƒ½èªªæ˜ SPDM èªè­‰æµç¨‹

=== OpenBMC ç›¸é—œ ===
â˜ èƒ½ç•« OpenBMC å››å±¤æ¶æ§‹åœ–
â˜ èƒ½è§£é‡‹ D-Bus çš„è§’è‰²å’Œå››å¤§åŠŸèƒ½
â˜ çŸ¥é“ entity-manager vs inventory-manager
â˜ äº†è§£ Sensor è³‡æ–™æµç¨‹ï¼ˆç¡¬é«” â†’ sysfs â†’ D-Bus â†’ Redfishï¼‰
â˜ æœƒä½¿ç”¨ busctl æ“ä½œ D-Bus
â˜ æº–å‚™å¥½ 2-3 å€‹å°ˆæ¡ˆç¶“é©—ï¼ˆSTAR æ¡†æ¶ï¼‰

=== å®‰å…¨çŸ¥è­˜ ===
â˜ èƒ½è§£é‡‹ Secure Boot æµç¨‹
â˜ çŸ¥é“ä»€éº¼æ˜¯ Root of Trust
â˜ äº†è§£ SPI Flash ä¿è­·æ©Ÿåˆ¶
â˜ çŸ¥é“ SPDM åœ¨ Supply Chain Security çš„è§’è‰²

=== Debug èƒ½åŠ› ===
â˜ çŸ¥é“ Sensor Debug çš„é€å±¤æ’æŸ¥æ­¥é©Ÿ
â˜ æœƒç”¨ i2c-toolsï¼ˆi2cdetectã€i2cgetã€i2csetï¼‰
â˜ æœƒçœ‹ journalctl å’Œ dmesg
â˜ æœƒç”¨ devmem è®€å–æš«å­˜å™¨

=== å…¬å¸ç‰¹å®š ===
â˜ äº†è§£ NVIDIA DGX/HGX ç”¢å“ç·š
â˜ çŸ¥é“ GPU ç›£æ§çš„æŠ€è¡“é»ï¼ˆæº«åº¦ã€åŠŸç‡ã€NVLinkï¼‰
â˜ äº†è§£ AMD EPYC å’Œ Instinct ç”¢å“
â˜ çŸ¥é“ AMD å°å®‰å…¨çš„é‡è¦–

=== è‹±æ–‡æº–å‚™ ===
â˜ æº–å‚™å¥½è‡ªæˆ‘ä»‹ç´¹ï¼ˆè‹±æ–‡ç‰ˆï¼‰
â˜ æº–å‚™å¥½å°ˆæ¡ˆç¶“é©—çš„è‹±æ–‡èªªæ˜
â˜ ç†Ÿæ‚‰æŠ€è¡“è‹±æ–‡è©å½™
```

---

## ğŸ“ é¢è©¦é¡Œåº«ï¼ˆæ“´å……ç‰ˆ - 20+ é¡Œï¼‰

> ä»¥ä¸‹é¡Œç›®æ¶µè“‹ NVIDIA / AMD / Intel / Meta ç­‰å¤–å•†å¸¸è¦‹çš„ BMC é¢è©¦å•é¡Œ

---

### Q1ï¼šè§£é‡‹ KCS å’Œ BT Interface çš„å·®ç•°

**é›£åº¦**ï¼šâ­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šIntel / NVIDIA

**å•é¡Œ**ï¼š
IPMI çš„ KCS å’Œ BT Interface æœ‰ä»€éº¼å·®ç•°ï¼Ÿä»€éº¼æƒ…æ³ä¸‹ç”¨å“ªå€‹ï¼Ÿ

**æ¨™æº–ç­”æ¡ˆ**ï¼š
```
KCS (Keyboard Controller Style)ï¼š
- ä½¿ç”¨ I/O Port é€šè¨Šï¼ˆå¦‚ 0xCA2ï¼‰
- é€ byte å‚³è¼¸ï¼Œéœ€è¦ç­‰å¾… IBF/OBF ç‹€æ…‹
- ç°¡å–®ä½†è¼ƒæ…¢
- é©åˆèˆŠç³»çµ±æˆ–ç°¡å–®éœ€æ±‚

BT (Block Transfer)ï¼š
- ä¹Ÿä½¿ç”¨ I/O Portï¼ˆå¦‚ 0xE4ï¼‰
- å¯æ‰¹æ¬¡å‚³è¼¸æ•´å€‹ message
- BMC å’Œ Host å„æœ‰ 256-byte buffer
- æ”¯æ´ä¸­æ–·é©…å‹•
- è¼ƒå¿«ï¼Œé©åˆé«˜è² è¼‰å ´æ™¯

é¸æ“‡è€ƒé‡ï¼š
- å¤§å¤šæ•¸ç¾ä»£ç³»çµ±åå¥½ BTï¼ˆè‹¥æ”¯æ´ï¼‰
- KCS ç›¸å®¹æ€§æœ€å¥½ï¼Œæ‰€æœ‰ BMC éƒ½æ”¯æ´
- AST2600 å…©è€…éƒ½æ”¯æ´
```

---

### Q2ï¼šIPMI SDR çš„ç”¨é€”æ˜¯ä»€éº¼ï¼Ÿ

**é›£åº¦**ï¼šâ­â­â­
**å¸¸è¦‹æ–¼**ï¼šæ™®é

**å•é¡Œ**ï¼š
ä»€éº¼æ˜¯ SDR (Sensor Data Record)ï¼Ÿå®ƒåœ¨ IPMI æ¶æ§‹ä¸­çš„è§’è‰²ï¼Ÿ

**æ¨™æº–ç­”æ¡ˆ**ï¼š
SDR æ˜¯ IPMI ä¸­æè¿°æ„Ÿæ¸¬å™¨çš„è³‡æ–™çµæ§‹ã€‚

ä¸»è¦ç”¨é€”ï¼š
1. å®šç¾©æ„Ÿæ¸¬å™¨çš„è­˜åˆ¥è³‡è¨Š
   - Sensor Numberã€Sensor Typeã€Entity ID

2. å®šç¾©è®€æ•¸è½‰æ›
   - y = (M * x + B) * 10^K
   - M, B, K å„²å­˜åœ¨ SDR ä¸­

3. å®šç¾©é–¾å€¼
   - Upper Critical, Upper Non-Critical
   - Lower Critical, Lower Non-Critical

4. å®šç¾©åç¨±
   - äººé¡å¯è®€çš„ Sensor åç¨±

SDR Repositoryï¼š
- å„²å­˜æ‰€æœ‰ SDR çš„è³‡æ–™åº«
- é–‹æ©Ÿæ™‚ç”± BMC å»ºç«‹
- å¯é€é IPMI å‘½ä»¤è®€å–ï¼ˆNetFn=0x0A, CMD=0x23ï¼‰

---

### Q3ï¼šå¦‚ä½•é€é Redfish åŸ·è¡ŒéŸŒé«”æ›´æ–°ï¼Ÿ

**é›£åº¦**ï¼šâ­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šMeta / Google

**å•é¡Œ**ï¼š
æè¿°é€é Redfish API æ›´æ–° BMC éŸŒé«”çš„å®Œæ•´æµç¨‹ã€‚

**æ¨™æº–ç­”æ¡ˆ**ï¼š
```bash
# 1. æª¢æŸ¥ UpdateService
curl -k -u root:password \
  https://bmc-ip/redfish/v1/UpdateService

# 2. æª¢æŸ¥æ”¯æ´çš„ Protocol
# çœ‹ HttpPushUri æ¬„ä½

# 3. ä¸Šå‚³éŸŒé«” (æ–¹æ³•ä¸€ï¼šSimpleUpdate)
curl -k -u root:password \
  -X POST \
  -H "Content-Type: application/json" \
  -d '{
    "ImageURI": "https://firmware-server/bmc.bin",
    "TransferProtocol": "HTTPS"
  }' \
  https://bmc-ip/redfish/v1/UpdateService/Actions/UpdateService.SimpleUpdate

# 4. æˆ–ç›´æ¥ä¸Šå‚³ (æ–¹æ³•äºŒï¼šHttpPushUri)
curl -k -u root:password \
  -X POST \
  -H "Content-Type: application/octet-stream" \
  --data-binary @bmc-firmware.bin \
  https://bmc-ip/redfish/v1/UpdateService/update

# 5. ç›£æ§æ›´æ–°ç‹€æ…‹
curl -k -u root:password \
  https://bmc-ip/redfish/v1/TaskService/Tasks/1

# 6. æ›´æ–°å®Œæˆå¾Œé‡å•Ÿ BMC
curl -k -u root:password \
  -X POST \
  -H "Content-Type: application/json" \
  -d '{"ResetType": "GracefulRestart"}' \
  https://bmc-ip/redfish/v1/Managers/bmc/Actions/Manager.Reset
```

---

### Q4ï¼šPLDM Type 2 å’Œ IPMI Sensor æœ‰ä»€éº¼å·®ç•°ï¼Ÿ

**é›£åº¦**ï¼šâ­â­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šNVIDIA / AMD

**å•é¡Œ**ï¼š
æ¯”è¼ƒ PLDM Type 2 Monitoring å’Œ å‚³çµ± IPMI Sensor çš„æ¶æ§‹å·®ç•°ã€‚

**æ¨™æº–ç­”æ¡ˆ**ï¼š
| | IPMI Sensor | PLDM Type 2 |
| :--- | :--- | :--- |
| **å®šç¾©æ–¹å¼** | SDR | PDR |
| **å‚³è¼¸å”å®š** | IPMI/KCS/BT | PLDM over MCTP |
| **æè¿°èƒ½åŠ›** | åŸºæœ¬ | è±å¯Œï¼ˆEntity Treeï¼‰ |
| **Sensor é¡å‹** | æ•¸å€¼/é›¢æ•£ | æ•¸å€¼/ç‹€æ…‹/è¤‡åˆ |
| **é–¾å€¼å®šç¾©** | åœ¨ SDR | åœ¨ PDR |
| **è½‰æ›å…¬å¼** | ç°¡å–®ç·šæ€§ | è¤‡é›œï¼ˆresolution/offsetï¼‰ |
| **Effecter æ”¯æ´** | ç„¡ | æœ‰ï¼ˆå¯æ§åˆ¶ PWM ç­‰ï¼‰ |
| **ç†±æ’æ‹”åµæ¸¬** | å›°é›£ | åŸç”Ÿæ”¯æ´ |
| **æ“´å±•æ€§** | OEM ä¾è³´ | æ¨™æº–åŒ–æ“´å±• |
|
| **ä½¿ç”¨å ´æ™¯** | | |
| å‚³çµ±ä¼ºæœå™¨ã€ç°¡å–®ç³»çµ± | âœ… | |
| ç¾ä»£ä¼ºæœå™¨ã€GPUã€è¤‡é›œç³»çµ± | | âœ… |
| NVIDIA DGX/HGX | | âœ… (ç®¡ç† GPU) |

---

### Q5ï¼šå¦‚ä½•åµæ¸¬ GPU éç†±ä¸¦åŸ·è¡Œä¿è­·ï¼Ÿ

**é›£åº¦**ï¼šâ­â­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šNVIDIA

**å•é¡Œ**ï¼š
æè¿° BMC å¦‚ä½•åµæ¸¬ GPU éç†±ä¸¦åŸ·è¡Œä¿è­·å‹•ä½œçš„å®Œæ•´æµç¨‹ã€‚

**æ¨™æº–ç­”æ¡ˆ**ï¼š

---

éç†±åµæ¸¬æµç¨‹ï¼š

1. æ„Ÿæ¸¬å™¨è®€å–
   - BMC å®šæœŸé€é PLDM è®€å– GPU æº«åº¦
   - æˆ–é€é I2C è®€å– GPU çš„æº«åº¦æš«å­˜å™¨

2. é–¾å€¼æ¯”è¼ƒ
   - PDR å®šç¾© Warning (80Â°C) å’Œ Critical (95Â°C)
   - pldmd æˆ– dbus-sensors æ¯”è¼ƒä¸¦è¨­å®š alarm ç‹€æ…‹

3. äº‹ä»¶ç”¢ç”Ÿ
   - D-Bus ç™¼å‡º PropertiesChanged Signal
   - phosphor-sel-logger è¨˜éŒ„ SEL

4. ç¬¬ä¸€å±¤ä¿è­·ï¼ˆWarningï¼‰
   - å¢åŠ é¢¨æ‰‡è½‰é€Ÿ
   - phosphor-fan-ctrl æ ¹æ“š sensor value èª¿æ•´

5. ç¬¬äºŒå±¤ä¿è­·ï¼ˆCriticalï¼‰
   - é€šçŸ¥ Host é€²è¡Œ Thermal Throttling (ç†±ç¯€æµ/é™é »ä¿è­·)
   - é€é PLDM Effecter è¨­å®š GPU é™åˆ¶åŠŸç‡

   > **ğŸ’¡ æ ¸å¿ƒè§€å¿µ**ï¼šThermal Throttling é›–ç„¶ä¿è­·äº†ç¡¬é«”ï¼Œä½†ä¹Ÿæ„å‘³è‘—é‹ç®—æ•ˆèƒ½ä¸‹é™ï¼Œå¯èƒ½å°è‡´ SLA(Service Level Agreement) é•ç´„ã€‚BMC æ¼”ç®—æ³•çš„ç²¾éš¨åœ¨æ–¼ï¼šå¦‚ä½•åœ¨ä¸è§¸ç™¼ Throttling çš„å‰æä¸‹ï¼Œç”¨æœ€å°‘çš„é¢¨æ‰‡è½‰é€Ÿç¶­æŒæº«åº¦ã€‚

6. ç¬¬ä¸‰å±¤ä¿è­·ï¼ˆFatal/Emergencyï¼‰
   - å¼·åˆ¶é—œæ©Ÿä¿è­·ç¡¬é«”
   - é€é GPIO æ§åˆ¶ Power ç‹€æ…‹
   - æˆ–ç™¼é€ PLDM å¼·åˆ¶é—œæ©Ÿå‘½ä»¤

7. äº‹å¾Œè™•ç†
   - è¨˜éŒ„å®Œæ•´äº‹ä»¶æ—¥èªŒ
   - å¯é€é Redfish EventService é€šçŸ¥ç®¡ç†ç³»çµ±

---

### Q6ï¼šè§£é‡‹ SPDM Measurement çš„ç”¨é€”

**é›£åº¦**ï¼šâ­â­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šAMD / NVIDIA

**å•é¡Œ**ï¼š
SPDM çš„ Measurement æ©Ÿåˆ¶å¦‚ä½•å¹«åŠ©é©—è­‰è¨­å‚™éŸŒé«”å®Œæ•´æ€§ï¼Ÿ

**æ¨™æº–ç­”æ¡ˆ**ï¼š
Measurement æ©Ÿåˆ¶ï¼š

è¨­å‚™é–‹æ©Ÿæ™‚ï¼š
1. æ¯å€‹éŸŒé«”éšæ®µè¼‰å…¥å‰ï¼Œè¨ˆç®—å…¶ Hash
2. Hash å€¼å„²å­˜åœ¨å®‰å…¨å€åŸŸï¼ˆå¦‚ TPM PCRï¼‰
3. ç”¢ç”Ÿå¤šå€‹ Measurement Index

BMC é©—è­‰æ™‚ï¼š
1. ç™¼é€ GET_MEASUREMENTS è«‹æ±‚
2. è¨­å‚™å›å‚³å„ Index çš„ Hash å€¼
3. è¨­å‚™ç”¨ç§é‘°ç°½ç«  Measurement

é©—è­‰æ­¥é©Ÿï¼š
1. é©—è­‰ç°½ç« ï¼ˆç¢ºèª Measurement ä¾†è‡ªçœŸè¨­å‚™ï¼‰
2. æ¯”å° Hashï¼ˆèˆ‡å·²çŸ¥è‰¯å¥½å€¼æ¯”è¼ƒï¼‰
3. ä¸ç¬¦å‰‡æ‹’çµ•ä¿¡ä»»

å¯¦éš›æ‡‰ç”¨ï¼š
- è³‡æ–™ä¸­å¿ƒéƒ¨ç½²æ–°è¨­å‚™æ™‚å…ˆé©—è­‰
- åµæ¸¬éŸŒé«”è¢«ç«„æ”¹ï¼ˆä¾›æ‡‰éˆæ”»æ“Šï¼‰
- åˆè¦æ€§è¦æ±‚ï¼ˆå¦‚ NIST 800-193ï¼‰

---

### Q7ï¼šbmcweb å¦‚ä½•è™•ç† Redfish è«‹æ±‚ï¼Ÿ

**é›£åº¦**ï¼šâ­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šMeta / Google

**å•é¡Œ**ï¼š
æè¿° bmcweb å¾æ”¶åˆ° HTTP è«‹æ±‚åˆ°å›æ‡‰çš„å®Œæ•´æµç¨‹ã€‚

**æ¨™æº–ç­”æ¡ˆ**ï¼š
bmcweb è™•ç†æµç¨‹ï¼š

1. æ¥æ”¶è«‹æ±‚
   - Crow HTTP Server æ¥æ”¶
   - TLS è§£å¯†ï¼ˆOpenSSLï¼‰

2. è·¯ç”±åŒ¹é…
   - æ ¹æ“š URL æ‰¾åˆ°å°æ‡‰çš„ Handler
   - ä¾‹å¦‚ /redfish/v1/Systems -> systems.hpp

3. èªè­‰é©—è­‰
   - æª¢æŸ¥ X-Auth-Token æˆ– Basic Auth
   - é©—è­‰æ¬Šé™ç­‰ç´š

4. éåŒæ­¥è™•ç†
   - å»ºç«‹ AsyncResp å…±äº«æŒ‡æ¨™
   - Handler ä¸é˜»å¡ä¸»åŸ·è¡Œç·’

5. D-Bus æŸ¥è©¢
   - é€é sdbusplus å‘¼å«å…¶ä»–æœå‹™
   - ä½¿ç”¨ async_method_call éåŒæ­¥è™•ç†

6. è³‡æ–™çµ„è£
   - å°‡ D-Bus å›æ‡‰è½‰æ›ç‚º JSON
   - å¥—ç”¨ Redfish Schema

7. å›æ‡‰ç™¼é€
   - è¨­å®š HTTP Status Code
   - è¿”å› JSON Response

æ•ˆèƒ½è€ƒé‡ï¼š
- æ‰€æœ‰æ“ä½œéƒ½æ˜¯éåŒæ­¥
- é¿å…é˜»å¡ event loop
- ä½¿ç”¨é€£æ¥æ± é‡ç”¨ D-Bus connection

---

### Q8ï¼šå¦‚ä½•åœ¨ OpenBMC æ–°å¢ä¸€å€‹ OEM IPMI å‘½ä»¤ï¼Ÿ

**é›£åº¦**ï¼šâ­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šMeta / Intel

**å•é¡Œ**ï¼š
æè¿°åœ¨ OpenBMC ä¸­æ–°å¢ OEM IPMI å‘½ä»¤çš„æ­¥é©Ÿã€‚

**æ¨™æº–ç­”æ¡ˆ**ï¼š
```cpp
// 1. å®šç¾© OEM å‘½ä»¤çµæ§‹
// ä½ç½®ï¼šmeta-xxx/recipes-phosphor/oem/xxx-oem-ipmi/

// include/oemcmds.hpp
namespace xxx
{
constexpr uint8_t netFnOem = 0x30;
constexpr uint8_t cmdGetChassisId = 0x01;
}

// 2. å¯¦ä½œ Handler
// src/oemcmds.cpp

#include <ipmid/api.hpp>

ipmi::RspType<std::vector<uint8_t>>
ipmiGetChassisId()
{
    std::vector<uint8_t> chassisId = {'Y', '4', '0', '1'};
    return ipmi::responseSuccess(chassisId);
}

void registerOemFunctions()
{
    ipmi::registerHandler(
        ipmi::prioOemBase,
        xxx::netFnOem,
        xxx::cmdGetChassisId,
        ipmi::Privilege::User,
        ipmiGetChassisId);
}

// 3. å»ºç«‹ Yocto Recipe
// meta-xxx/recipes-phosphor/oem/xxx-oem-ipmi_1.0.bb

SUMMARY = "OEM IPMI commands for XXX platform"
DEPENDS = "phosphor-ipmi-host"
inherit pkgconfig meson

// 4. æ¸¬è©¦
// ipmitool raw 0x30 0x01
// è¼¸å‡º: 59 34 30 31 (Y401)
```

---

### Q9-1ï¼šAST2600 Secure Boot Chain (åŸ Q9)

**é›£åº¦**ï¼šâ­â­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šAMD / NVIDIA

**å•é¡Œ**ï¼š
æè¿° AST2600 çš„ Secure Boot å•Ÿå‹•éˆã€‚

**æ¨™æº–ç­”æ¡ˆ**ï¼š
AST2600 Secure Boot Chainï¼š

1. Boot ROM (ä¸å¯ä¿®æ”¹)
   - ä½æ–¼ AST2600 æ™¶ç‰‡å…§éƒ¨ ROM
   - è®€å– OTP ä¸­çš„ Public Key Hash
   - é©—è­‰ SPL ç°½ç« 
   - å¤±æ•—å‰‡åœæ­¢å•Ÿå‹•

2. SPL (Secondary Program Loader)
   - ä½æ–¼ SPI Flash é–‹é ­
   - åˆå§‹åŒ– DDR4 è¨˜æ†¶é«”
   - é©—è­‰ U-Boot ç°½ç« 
   - è·³è½‰åˆ° U-Boot

3. U-Boot
   - åˆå§‹åŒ–å‘¨é‚Šè¨­å‚™
   - è¼‰å…¥ä¸¦é©—è­‰ FIT Image
   - FIT åŒ…å« Kernel + DTB + Initramfs

4. Linux Kernel
   - æ­£å¸¸å•Ÿå‹• Linux
   - å¯é¸ï¼šä½¿ç”¨ dm-verity é©—è­‰ rootfs

é‡‘é‘°ç®¡ç†ï¼š
- OTP å„²å­˜ Public Key Hashï¼ˆ64 bytes SHA-512ï¼‰
- åªèƒ½å¯«å…¥ä¸€æ¬¡ï¼Œç„¡æ³•ä¿®æ”¹
- Private Key ç”±å» å•†å®‰å…¨ä¿ç®¡

é©—è­‰æ¼”ç®—æ³•ï¼š
- RSA-2048 æˆ– RSA-4096
- SHA-256 æˆ– SHA-512

å¤±æ•—è™•ç†ï¼š
- å•Ÿå‹•åœæ­¢ï¼Œç„¡æ³•é€²å…¥ç³»çµ±
- Recovery éœ€è¦ UART æ¨¡å¼

---

### Q9-2ï¼šOpenBMC çš„ Boot Sequence (å•Ÿå‹•æµç¨‹) èˆ‡ Flash Image çµæ§‹

**é›£åº¦**ï¼šâ­â­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šåº•å±¤é©…å‹• / System BSP é¢è©¦

**å•é¡Œ**ï¼š
è«‹æè¿° OpenBMC å¾éé›»åˆ°é€²å…¥ Linux Shell çš„å®Œæ•´å•Ÿå‹•æµç¨‹ï¼Ÿ
ä¸€å€‹æ¨™æº–çš„ Flash åˆ†å€ (Partition Layout) é•·ä»€éº¼æ¨£å­ï¼Ÿç‚ºä»€éº¼ä¿®æ”¹ `/usr` çš„æª”æ¡ˆé‡é–‹æ©Ÿå°±ä¸è¦‹äº†ï¼Ÿ

**æ¨™æº–ç­”æ¡ˆ**ï¼š
1. å•Ÿå‹•æµç¨‹ (The Boot Stack)
   æ­£ç¢ºé †åºæ˜¯ï¼šROM â†’ SPL â†’ U-Boot â†’ Kernel â†’ Rootfs (Systemd)

   1.  **Boot ROM (SoC å…§éƒ¨)**
       *   é€™æ˜¯æ™¶ç‰‡å‡ºå» æ™‚ç‡’æ­»çš„ï¼Œç„¡æ³•æ›´æ”¹ã€‚
       *   è² è²¬æœ€åŸºç¤çš„ç¡¬é«”åˆå§‹åŒ– (SRAM)ï¼Œå¾ SPI Flash è®€å– SPL åˆ° SRAMã€‚

   2.  **SPL (Secondary Program Loader)**
       *   å› ç‚º SRAM å¾ˆå° (ä¾‹å¦‚åªæœ‰ 64KB)ï¼Œæ”¾ä¸ä¸‹å®Œæ•´çš„ U-Bootã€‚
       *   SPL çš„å”¯ä¸€ä»»å‹™ï¼šåˆå§‹ DRAMï¼Œç„¶å¾ŒæŠŠå®Œæ•´çš„ U-Boot è¼‰å…¥åˆ° DRAMã€‚

   3.  **U-Boot (Bootloader)**
       *   é€™æ˜¯åŠŸèƒ½æœ€å¼·å¤§çš„ Bootloaderã€‚
       *   åˆå§‹åŒ–æ›´å¤šå‘¨é‚Š (Network, MMC, USB)ã€‚
       *   å¾ SPI Flash è®€å– Kernel Image (é€šå¸¸æ˜¯ FIT Image) åˆ° DRAMã€‚
       *   æ ¹æ“š Boot Arguments (åŒ…å« DTB ä½å€) è·³è½‰åˆ° Kernelã€‚

   4.  **Linux Kernel**
       *   åˆå§‹åŒ–æ‰€æœ‰é©…å‹•ç¨‹å¼ (Drivers)ã€‚
       *   æ›è¼‰ Root Filesystem (Rootfs)ã€‚
       *   åŸ·è¡Œç¬¬ä¸€å€‹ Processï¼š`/sbin/init` (å³ Systemd)ã€‚

   5.  **Systemd (Userspace)**
       *   å•Ÿå‹• OpenBMC ç›¸é—œæœå‹™ (xyz.openbmc_project...)ã€‚

2. SPI Flash Layout (å…¸å‹ 64MB é…ç½®)
   é€™æ˜¯ä¸€å€‹ç”±ä½ä½å€åˆ°é«˜ä½å€çš„ç·šæ€§æ˜ å°„ï¼š

| Address | Partition Name | Description |
| :--- | :--- | :--- |
| **0x00000000** | `u-boot` | Bootloader (SPL + U-Boot) |
| **0x06000000** | `u-boot-env` | U-Boot ç’°å¢ƒè®Šæ•¸ (bootargs, bootcmd) |
| **0x00080000** | `kernel` | FIT Image (Kernel + DTB + Initramfs) |
| **0x00600000** | `rofs` | Read-Only Rootfs (SquashFS) -> `/usr`, `/bin` |
| **0x03000000** | `rwfs` | Read-Write Config (JFFS2/Overlay) -> `/etc`, `/var` |

   - **u-boot**ï¼šè² è²¬ç¡¬é«”åˆå§‹åŒ–ï¼Œè¼‰å…¥ Kernelã€‚
   - **kernel**ï¼šæ ¸å¿ƒæœ¬é«” (FIT Image)ã€‚
   - **rofs (Read-Only)**ï¼šæ”¾ OS çš„äºŒé€²ä½æª” (`ls`, `systemd`, `pldmd`)ã€‚ç‚ºäº†å£“ç¸®ç‡ (SquashFS) å’Œç©©å®šæ€§ï¼Œé€™è£¡æ˜¯**å”¯è®€**çš„ã€‚
   - **rwfs (Read-Write)**ï¼šæ”¾ä½¿ç”¨è€…çš„è¨­å®šæª” (`network-config`, `sensor-config`)ã€‚

3. OverlayFSï¼šç‚ºä»€éº¼æœ‰äº›æª”æ¡ˆæœƒæ¶ˆå¤±ï¼Ÿ
   OpenBMC ä½¿ç”¨ OverlayFS æŠ€è¡“å°‡ `rofs` (Lower Dir) å’Œ `rwfs` (Upper Dir) åˆä½µèµ·ä¾†çµ¦ä½ çœ‹ã€‚

   - **ç•¶ä½ ä¿® /usr/bin/hello (åœ¨ rofs)**ï¼š
     - å› ç‚º `rofs` æ˜¯å”¯è®€çš„ï¼Œä½ å…¶å¯¦æ˜¯å¯«ä¸é€²å» Flash çš„ã€‚ä½ çœ‹åˆ°çš„ä¿®æ”¹åªæ˜¯æš«å­˜åœ¨ RAM (tmpfs) è£¡ï¼Œ**æ–·é›»å°±æ²’äº†**ã€‚
   - **ç•¶ä½ ä¿® /etc/systemd/network/eth0 (åœ¨ rwfs)**ï¼š
     - `rwfs` è¨­æœ‰ Overlay çš„ Upper Layerï¼Œä½ çš„ä¿®æ”¹æœƒè¢«çœŸæ­£å¯«å…¥ SPI Flash çš„ `rwfs` åˆ†å€ã€‚**æ–·é›»é‡é–‹æ©Ÿé‚„åœ¨**ã€‚

---

### Q9-3ï¼šç‚ºä»€éº¼éœ€è¦ Device Tree (DTS)ï¼Ÿ

**é›£åº¦**ï¼šâ­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šæ‰€æœ‰ Embedded Linux é¢è©¦

**å•é¡Œ**ï¼š
åœ¨ Device Tree å‡ºç¾ä¹‹å‰ (Legacy Linux)ï¼Œæˆ‘å€‘æ˜¯æ€éº¼æè¿°ç¡¬é«”çš„ï¼ŸDTS å¸¶ä¾†äº†ä»€éº¼æ”¹å–„ï¼ŸKernel è·Ÿ DTS çš„é—œä¿‚æ˜¯ä»€éº¼ï¼Ÿ

**æ¨™æº–ç­”æ¡ˆ**ï¼š
1. è§£æ±ºçš„æ ¸å¿ƒå•é¡Œï¼šHardcoding (å¯«æ­»åœ¨ Code è£¡)
   - åœ¨èˆŠç‰ˆ ARM Linux (pre-3.x)ï¼Œç¡¬é«”è³‡è¨Šæ˜¯å¯«æ­»åœ¨ C èªè¨€è£¡çš„ (å¦‚ board-file)ã€‚
   - æ¯æ›ä¸€å¼µæ¿å­ï¼Œå³ä½¿ CPU ä¸€æ¨£ï¼Œåªå› ç‚º I2C åœ°å€ä¸åŒï¼Œå°±è¦æ”¹ C code é‡ç·¨ Kernelã€‚
   - é€™å°è‡´ /arch/arm/ ä¸‹å……æ–¥è‘—æ•¸åƒå€‹åƒåœ¾ board fileã€‚

2. Device Tree çš„æ”¹å–„ï¼š
   - **åˆ†é›¢ç­–ç•¥**ï¼šå°‡ã€Œç¡¬é«”æè¿° (Data)ã€å¾ã€Œé©…å‹•ç¨‹å¼ (Code)ã€ä¸­æŠ½é›¢ã€‚
   - **çµ±ä¸€æ¨™æº–**ï¼šç”¨ä¸€ç¨®æ¨™æº–çš„æ–‡å­—æ ¼å¼ (.dts) æè¿°ç¡¬é«”çµæ§‹ã€‚
   - **é€šç”¨æ€§**ï¼šåŒä¸€ä»½ Kernel Binary (uImage)ï¼Œåªè¦æ­é…ä¸åŒçš„ .dtb (Device Tree Blob)ï¼Œå°±èƒ½åœ¨ä¸åŒçš„æ¿å­ä¸Šé–‹æ©Ÿã€‚

3. å½¢è±¡åŒ–æ¯”å–» (é‡è¦é¢è©¦æŠ€å·§)ï¼š
   
   > **æ¯”å–»ï¼šKernel æ˜¯ã€ŒéŠæˆ²ä¸»æ©Ÿ (Switch)ã€ï¼ŒDevice Tree æ˜¯ã€ŒéŠæˆ²å¡å¸¶ (Cartridge)ã€**
   > 
   > - **Legacy Linux (èˆŠæ™‚ä»£)**
   >   - éŠæˆ²æ˜¯**ç„Šæ­»**åœ¨ä¸»æ©Ÿæ¿ä¸Šçš„ (Hardcoded)ã€‚
   >   - æƒ³æ›éŠæˆ²ç©ï¼ŸæŠ±æ­‰ï¼Œä½ è¦æŠŠæ•´å°ä¸»æ©Ÿæ‹†æ‰ï¼Œé‡æ–°ç„Šæ¥ (Recompile Kernel)ã€‚
   >
   > - **Modern Linux (Device Tree)**
   >   - ä¸»æ©Ÿ (Kernel) è®Šæˆé€šç”¨çš„ï¼Œå®ƒåªè² è²¬é‹ç®—å’Œé¡¯ç¤ºã€‚
   >   - éŠæˆ²å…§å®¹ (ç¡¬é«”æè¿°) å­˜åœ¨å¡å¸¶ (.dtb) è£¡ã€‚
   >   - æƒ³æ›éŠæˆ²ç©ï¼Ÿ**æ›å¼µå¡å¸¶ (.dtb) å°±å¥½ï¼Œä¸»æ©Ÿä¸ç”¨æ› (ä¸ç”¨é‡ç·¨ Kernel)ï¼**

4. é–‹æ©Ÿæµç¨‹ä¸­çš„ DTSï¼š
   U-Boot æœƒå…ˆæŠŠ Kernel è¼‰å…¥è¨˜æ†¶é«”ï¼Œå†æŠŠ DTB è¼‰å…¥è¨˜æ†¶é«”ï¼Œç„¶å¾Œå‘Šè¨´ Kernelï¼šã€Œå˜¿ï¼Œå¡å¸¶åœ¨è¨˜æ†¶é«”ä½å€ 0x50000000ï¼Œç…§è‘—ä¸Šé¢çš„èªªæ˜å»ç©å§ï¼ã€ã€‚

---

### Q9-4ï¼šFIT Image çµæ§‹è§£å¯†ï¼šå®ƒåˆ°åº•åŒ…äº†ä»€éº¼ï¼Ÿ

**é›£åº¦**ï¼šâ­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šU-Boot / Yocto ç›¸é—œé¢è©¦

**å•é¡Œ**ï¼š
FIT Image (`image.itb`) è£¡é¢åŒ…å«å“ªäº›æ±è¥¿ï¼Ÿæœ‰åŒ…å« U-Boot å—ï¼Ÿå¦‚æœä¸é–‹ Secure Bootï¼Œæˆ‘å¯ä»¥å–®ç¨æ› DTB å—ï¼Ÿ

**æ¨™æº–ç­”æ¡ˆ**ï¼š
1. FIT Image (Flattened Image Tree) çµæ§‹å‰–æ
   å®ƒå°±åƒä¸€å€‹å£“å¹³çš„è³‡æ–™å¤¾ (Container)ï¼Œè£¡é¢é€šå¸¸åªåŒ…å«ä¸‰æ¨£æ±è¥¿ï¼š
   - **Kernel Image** (`zImage` æˆ– `Image`)
   - **Device Tree Blobs** (`.dtb`) - å¯èƒ½æœ‰å¤šå€‹ï¼Œå°æ‡‰ä¸åŒæ¿å­
   - **Initramfs** (Optional) - æ¥µå°çš„ Ramdiskï¼Œç”¨æ–¼è¼‰å…¥å¿…è¦é©…å‹•

   **âŒ çµ•å°ä¸åŒ…å«ï¼š**
   - **SPL / U-Boot**ï¼šå®ƒå€‘ä½åœ¨ SPI Flash è¼ƒå‰æ®µçš„ç¨ç«‹åˆ†å€ (`u-boot` partition)ã€‚
   - **Systemd / Rootfs**ï¼šçœŸæ­£çš„ä½œæ¥­ç³»çµ±æª”æ¡ˆç³»çµ±ä½åœ¨å¾Œé¢è¶…å¤§çš„ç¨ç«‹åˆ†å€ (`rofs` partitionï¼Œé€šå¸¸æ˜¯ SquashFS)ã€‚

2. é Secure Boot å ´æ™¯ï¼šå¯ä»¥å–®ç¨æ› DTB å—ï¼Ÿ
   **â­• ç­”æ¡ˆï¼šç•¶ç„¶å¯ä»¥ï¼è€Œä¸”é€™æ˜¯ RD çš„æ—¥å¸¸ (U-Boot æŒ‡ä»¤å¤§æ³•)ã€‚**

   **ğŸ’¡ æ–¹æ³•æ¯”è¼ƒ (Execution Context)**
| æ–¹æ³• | åŸ·è¡Œä½ç½® | ç‹€æ…‹ | æ•ˆåŠ› | éœ€è¦ Reboot? |
| :--- | :--- | :--- | :--- | :--- |
| **æ–¹æ³• A (RD é–‹ç™¼ç”¨)** | U-Boot Console (RAM) | **æš«æ™‚æ€§** (é‡é–‹æ©Ÿæ¶ˆå¤±) | å…ç‡’éŒ„ | å¦ (ç›´æ¥ `bootz`) |
| **æ–¹æ³• B (ä½¿ç”¨è€…æ›´æ–°)** | Linux Shell (Flash) | **æ°¸ä¹…æ€§** (å¯«å…¥ Flash) | éœ€ç‡’éŒ„ | **æ˜¯** (å¿…é ˆ reboot) |

   > **æ–¹æ³• A ç¯„ä¾‹ (RDæœ€æ„›)**ï¼š
   > ```bash
   > tftp 0x81000000 Image       # ä¸‹è¼‰ Kernel
   > tftp 0x82000000 board.dtb   # ä¸‹è¼‰ DTB (æ›é€™è£¡å°±å¥½ï¼)
   > bootz 0x81000000 - 0x82000000
   > ```

---

### Q9-5ï¼šSecure Boot æ·±åº¦è§£æï¼šç°½ç« èˆ‡ Chain of Trust

**é›£åº¦**ï¼šâ­â­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šAMD / NVIDIA / Server ODM

**å•é¡Œ**ï¼š
ä»€éº¼æ˜¯ã€Œæ•¸ä½ç°½ç« ã€ï¼ŸOpenBMC çš„ Chain of Trust æ˜¯å¦‚ä½•å»ºç«‹çš„ï¼Ÿå¦‚æœæˆ‘å·å·æ›äº† Device Tree (DTB) æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ

**æ¨™æº–ç­”æ¡ˆ**ï¼š
1. ä»€éº¼æ˜¯æ•¸ä½ç°½ç«  (Digital Signature)ï¼Ÿ
   - **åŸç†**ï¼šHash (SHA-256) + éå°ç¨±åŠ å¯† (RSA/ECDSA)ã€‚
   - **æµç¨‹**ï¼šåŸå» ç”¨**ç§é‘°**å° Image çš„ Hash åŠ å¯†ï¼›è¨­å‚™ç«¯ç”¨**å…¬é‘°**è§£å¯†é©—è­‰ Hashã€‚

2. Chain of Trust (ä¿¡ä»»éˆ)
   æ¯ä¸€å±¤éƒ½åœ¨åŸ·è¡Œä¸‹ä¸€å±¤ä¹‹å‰å…ˆé©—è­‰å®ƒï¼š
   - **Root of Trust (RoT)**ï¼šSoC å…§éƒ¨çš„ Boot ROM + OTP å…¬é‘° (æœ€æºé ­ï¼Œçµ•å°ä¿¡ä»»)ã€‚
   - **Step 1**ï¼šROM é©—è­‰ SPL çš„ç°½ç«  â†’ é€šéæ‰åŸ·è¡Œ SPLã€‚
   - **Step 2**ï¼šSPL é©—è­‰ U-Boot çš„ç°½ç«  â†’ é€šéæ‰åŸ·è¡Œ U-Bootã€‚
   - **Step 3**ï¼šU-Boot é©—è­‰ Kernel (FIT Image) çš„ç°½ç«  â†’ é€šéæ‰åŸ·è¡Œ Kernelã€‚

3. Device Tree å¯ä»¥è¢«å–®ç¨ç½®æ›å—ï¼Ÿ
   - **ç­”æ¡ˆ**ï¼šå¦‚æœé–‹å•Ÿäº† Secure Bootï¼Œ**ä¸è¡Œï¼**
   - **åŸå› **ï¼š
     - åœ¨ FIT Image æ¶æ§‹ä¸­ï¼ŒDTB æ˜¯è¢«æ‰“åŒ…åœ¨ image.itb è£¡é¢çš„ã€‚
     - ç°½ç« æ˜¯å° **æ•´å€‹ image.itb** (åŒ…å« Kernel + DTB) é€²è¡Œçš„ã€‚
     - åªè¦ä½ å·æ”¹äº† DTB çš„ä»»ä½•ä¸€å€‹ byteï¼Œæ•´å€‹ image çš„ **Hash å€¼å°±æœƒæ”¹è®Š**ã€‚
   - **å¾Œæœ**ï¼š
     - U-Boot é©—è­‰æ™‚ç™¼ç¾ Hash ä¸ç¬¦ (Signature Verification Failed)ã€‚
     - U-Boot æ‹’çµ•å•Ÿå‹• Kernelï¼Œé˜²æ­¢é§­å®¢é€é DTB æ³¨å…¥æƒ¡æ„é©…å‹•ã€‚

---

### Q9-6ï¼šè§€å¿µçµ±æ•´ï¼šæ—¢ç„¶ Kernel é€šç”¨ï¼Œç‚ºä½• FIT Image åˆè¦æ‰“åŒ…åœ¨ä¸€èµ·ï¼Ÿ

**é›£åº¦**ï¼šâ­â­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šé«˜éšç³»çµ±æ¶æ§‹é¢è©¦

**å•é¡Œ**ï¼š
Q9-3 (åŸ Q10-2) èªª DTS è®“ Kernel è®Šé€šç”¨ï¼›ä½† Q9-5 (åŸ Q10-4) åˆèªª FIT Image æŠŠå¤§å®¶æ‰“åŒ…åœ¨ä¸€èµ·ä¸èƒ½æ›ã€‚é€™ä¸æ˜¯çŸ›ç›¾å—ï¼Ÿ

**æ¨™æº–ç­”æ¡ˆ**ï¼š
é€™ä¸çŸ›ç›¾ï¼Œå› ç‚ºé€™æ˜¯**å…©å€‹ä¸åŒéšæ®µ**çš„è­°é¡Œï¼š

1. **Build Time / Development Phase (RD çš„å¿«æ¨‚)**
   - **è¦–è§’**ï¼šé–‹ç™¼è€…ã€‚
   - **ç—›é»è§£æ±º**ï¼šKernel ç·¨ä¸€æ¬¡å°±å¥½ (Universal Binary)ï¼Œéš¨æ„æ­é…ä¸åŒ DTB æ¸¬è©¦ã€‚
   - **æ‰‹æ®µ**ï¼šä½¿ç”¨ Q9-4 (åŸ Q10-3) çš„ã€Œæ–¹æ³• A (RAM è¼‰å…¥)ã€ã€‚

2. **Runtime / Deployment Phase (User çš„é™åˆ¶)**
   - **è¦–è§’**ï¼šçµ‚ç«¯ä½¿ç”¨è€…æˆ–é§­å®¢ã€‚
   - **å®‰å…¨è€ƒé‡**ï¼šç”¢å“å‡ºå» æ™‚ï¼Œç‚ºäº†é˜²æ­¢äº‚æ”¹ç¡¬é«”å®šç¾©æˆ–æƒ¡æ„æ”»æ“Šã€‚
   - **æ‰‹æ®µ**ï¼šä½¿ç”¨ Secure Bootï¼ŒæŠŠ Universal Kernel å’Œ Specific DTB æ‰“åŒ…ç°½ç« æˆ FIT Imageã€‚
   - **çµæœ**ï¼šæŠ€è¡“ä¸Š Kernel æ˜¯é€šç”¨çš„ï¼Œä½†ç‚ºäº†å®‰å…¨ï¼Œè¢«å¼·åˆ¶ç¶å®šã€‚

**ä¸€å¥è©±ç¸½çµ**ï¼š
ã€ŒDTS çš„é€šç”¨æ€§æ˜¯ç‚ºäº†**æ–¹ä¾¿ RD é–‹ç™¼èˆ‡ç¶­è­·**ï¼›FIT Image çš„æ‰“åŒ…èˆ‡ç°½ç« æ˜¯ç‚ºäº†**ç¢ºä¿å‡ºå» å¾Œçš„ç”¢å“å®‰å…¨**ã€‚ã€

---

### Q10ï¼šentity-manager Probe æ©Ÿåˆ¶

**é›£åº¦**ï¼šâ­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šMeta / Intel

**å•é¡Œ**ï¼š
æè¿° entity-manager å¦‚ä½•æ¢æ¸¬ç¡¬é«”ä¸¦å»ºç«‹ D-Bus ç‰©ä»¶ã€‚

**æ¨™æº–ç­”æ¡ˆ**ï¼š
entity-manager Probe æµç¨‹ï¼š

1. è®€å– JSON è¨­å®šæª”
   /usr/share/entity-manager/configurations/*.json

2. è§£æ Probe æ¢ä»¶
   ä¾‹å¦‚ï¼š
   "Probe": "xyz.openbmc_project.FruDevice({'PRODUCT': '.*GPU.*'})"

3. åŸ·è¡Œ Probe
   - è¨‚é–± D-Bus InterfacesAdded Signal
   - æŸ¥è©¢ç¾æœ‰ç‰©ä»¶
   - åŒ¹é…æ­£å‰‡è¡¨é”å¼

4. Probe æˆåŠŸ
   - æ ¹æ“š Exposes å€å¡Šå»ºç«‹ç‰©ä»¶
   - ç™¼å¸ƒåˆ° D-Bus

5. é€šçŸ¥å…¶ä»–æœå‹™
   - dbus-sensors æ”¶åˆ° InterfacesAdded
   - é–‹å§‹è®€å–å°æ‡‰çš„ Sensor

JSON ç¯„ä¾‹ï¼š
```json
{
  "Name": "GPU Card",
  "Probe": "xyz.openbmc_project.FruDevice({'PRODUCT': '.*A100.*'})",
  "Exposes": [
    {
      "Type": "TMP75",
      "Name": "GPU$INDEX Temp",
      "Address": "0x48",
      "Bus": "$bus"
    }
  ]
}
```

å„ªé»ï¼š
- å‹•æ…‹ç¡¬é«”æ¢æ¸¬
- ç„¡éœ€é‡ç·¨è­¯å³å¯æ”¯æ´æ–°ç¡¬é«”
- é›†ä¸­åŒ–è¨­å®šç®¡ç†

**ğŸ’¡ è§€å¿µæ¾„æ¸…ï¼šã€Œç„¡éœ€é‡ç·¨è­¯ã€çš„å‰æ**
é€™è£¡çš„ç„¡éœ€é‡ç·¨è­¯ï¼ŒæŒ‡çš„æ˜¯**ç„¡éœ€å‹•åˆ° Kernel Image**ã€‚
- **å‰æ**ï¼šKernel è£¡å¿…é ˆå·²ç¶“æœ‰å°æ‡‰çš„ Driver (Built-in æˆ– Module)ã€‚
- **Entity-Manager çš„åŠŸç”¨**ï¼šåªæ˜¯è² è²¬åª’åˆ (Binding)ï¼Œå‘Šè¨´ Kernel é€™è£¡æœ‰è£ç½®éœ€è¦æœå‹™ã€‚å¦‚æœé€£ Driver éƒ½æ²’æœ‰ï¼ŒEntity-Manager ä¹Ÿæ˜¯ç„¡èƒ½ç‚ºåŠ›çš„ï¼ˆé€™æ™‚å°±å¾—ä¹–ä¹–é‡ç·¨ Kernel åŠ  Driverï¼‰ã€‚


---

### Q11ï¼šMCTP over PCIe VDM

**é›£åº¦**ï¼šâ­â­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šNVIDIA / AMD

**å•é¡Œ**ï¼š
è§£é‡‹ MCTP over PCIe VDM çš„é‹ä½œæ–¹å¼ã€‚

**æ¨™æº–ç­”æ¡ˆ**ï¼š
MCTP over PCIe VDM (Vendor Defined Message)ï¼š

PCIe VDM æ˜¯ PCIe è¦ç¯„ä¸­å®šç¾©çš„å» å•†æ“´å±•æ©Ÿåˆ¶ã€‚
DMTF å®šç¾©äº†å¦‚ä½•åœ¨ VDM ä¸­å‚³è¼¸ MCTP å°åŒ…ã€‚

å°åŒ…çµæ§‹ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PCIe TLP Header                          â”‚
â”‚  - Type: Message (TLP Type 0x10)         â”‚
â”‚  - Message Code: Vendor Defined (0x7F)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  VDM Header                               â”‚
â”‚  - Vendor ID: 0x1AB4 (DMTF)              â”‚
â”‚  - PCIe Target ID                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MCTP Header                              â”‚
â”‚  - Dest/Src EID                          â”‚
â”‚  - Message Tag                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MCTP Payload (PLDM Message)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å„ªé»ï¼ˆç›¸æ¯” SMBusï¼‰ï¼š
- é »å¯¬æ›´é«˜ï¼ˆPCIe vs 100kHz I2Cï¼‰
- å»¶é²æ›´ä½
- æ›´å¯é ï¼ˆPCIe æœ‰ CRC å’Œé‡å‚³ï¼‰

AST2600 æ”¯æ´ï¼š
- ä½œç‚º PCIe Endpoint
- å¯æ¥æ”¶ Host çš„ VDM
- ç”¨æ–¼ PLDM/SPDM é€šè¨Š

---

### Q12ï¼šæè¿°ä½ å¦‚ä½• Debug ä¸€å€‹ Sensor è®€å€¼å•é¡Œ

**é›£åº¦**ï¼šâ­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šæ™®éï¼ˆè¡Œç‚ºé¢è©¦ï¼‰

**å•é¡Œ**ï¼š
ï¼ˆä½¿ç”¨ STAR æ³•å‰‡æè¿°ä¸€å€‹çœŸå¯¦çš„ Debug ç¶“é©—ï¼‰

**æ¨™æº–ç­”æ¡ˆç¯„ä¾‹**ï¼š
Situation:
åœ¨ Yosemite 4 å°ˆæ¡ˆä¸­ï¼Œç™¼ç¾æŸå€‹ GPU æº«åº¦æ„Ÿæ¸¬å™¨
é¡¯ç¤º -1Â°Cï¼ˆéŒ¯èª¤å€¼ï¼‰ã€‚

Task:
éœ€è¦æ‰¾å‡ºå•é¡Œæ ¹å› ä¸¦ä¿®å¾©ï¼Œä»¥ç¢ºä¿ç›£æ§åŠŸèƒ½æ­£å¸¸ã€‚

Action:
1. Redfish å±¤ç¢ºèª
   curl è®€å– /redfish/v1/Chassis/chassis/Thermal
   â†’ ç¢ºèªå•é¡Œå­˜åœ¨

2. D-Bus å±¤ç¢ºèª
   busctl get-property ... Sensor.Value
   â†’ D-Bus ä¹Ÿæ˜¯ -1

3. Sensor Daemon ç¢ºèª
   journalctl -u dbus-sensors
   â†’ ç™¼ç¾ hwmon-temp-sensor å ±éŒ¯

4. Sysfs å±¤ç¢ºèª
   cat /sys/class/hwmon/hwmon*/temp1_input
   â†’ è®€å–å¤±æ•—ï¼Œå›å‚³ -EIO

5. I2C å±¤ç¢ºèª
   i2cdetect -y 2
   â†’ Device ä½å€ 0x48 æ²’æœ‰å›æ‡‰ï¼

6. ç¡¬é«”ç¢ºèª
   â†’ ç™¼ç¾ I2C Mux è¨­å®šéŒ¯èª¤

7. ä¿®å¾©
   â†’ ä¿®æ­£ Device Tree çš„ I2C Mux è¨­å®š

Result:
- å•é¡Œåœ¨ 2 å°æ™‚å…§è§£æ±º
- ç™¼ç¾æ ¹å› æ˜¯ Device Tree çš„ I2C Mux channel éŒ¯èª¤
- æ–°å¢äº† I2C æ¢æ¸¬çš„è‡ªå‹•åŒ–æ¸¬è©¦

---

### Q13ï¼šPLDM FW Update Package çµæ§‹

**é›£åº¦**ï¼šâ­â­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šNVIDIA / AMD

**å•é¡Œ**ï¼š
æè¿° PLDM FW Update Package çš„çµæ§‹ã€‚

**æ¨™æº–ç­”æ¡ˆ**ï¼š
```
PLDM FW Update Package (PLDM-FWU-PKG)ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Package Header                          â”‚
â”‚  - Package Header Identifier            â”‚
â”‚  - Package Header Format Version        â”‚
â”‚  - Package Header Size                  â”‚
â”‚  - Package Release Date/Time            â”‚
â”‚  - Applicable Components Bitmap         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Firmware Device ID Records             â”‚
â”‚  - Descriptor Count                     â”‚
â”‚  - Descriptor Data (IANA, UUID ç­‰)      â”‚
â”‚  - ç”¨æ–¼è­˜åˆ¥ç›®æ¨™è¨­å‚™                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Component Image Information Area        â”‚
â”‚  - Component Classification              â”‚
â”‚  - Component Identifier                 â”‚
â”‚  - Component Size                       â”‚
â”‚  - Component Version String             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Package Signature (Optional)            â”‚
â”‚  - ç”¨æ–¼é©—è­‰ Package å®Œæ•´æ€§              â”‚
â”‚  - å¯ä½¿ç”¨ RSA ç°½ç«                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Component Images                        â”‚
â”‚  - å¯¦éš›çš„éŸŒé«”äºŒé€²ä½è³‡æ–™                 â”‚
â”‚  - å¯èƒ½æœ‰å¤šå€‹ Component                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å·¥å…·ï¼š
- pldm_fwup_pkg_creatorï¼šå»ºç«‹ Package
- pldmtool fwupdateï¼šåŸ·è¡Œæ›´æ–°
```

---

### Q14ï¼šRedfish EventService SSE vs Webhook

**é›£åº¦**ï¼šâ­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šGoogle / Meta

**å•é¡Œ**ï¼š
æ¯”è¼ƒ Redfish EventService çš„ SSE å’Œ Webhook æ©Ÿåˆ¶ã€‚

**æ¨™æº–ç­”æ¡ˆ**ï¼š
| | SSE | Webhook |
| :--- | :--- | :--- |
| **é€£ç·šæ–¹å¼** | Client é–‹å•Ÿé•·é€£ç·š | BMC ä¸»å‹• POST |
| **å³æ™‚æ€§** | æ¯«ç§’ç´š | å¯èƒ½æœ‰å»¶é² |
| **ç¶²è·¯é…ç½®** | Client éœ€é€£å…¥ BMC | BMC éœ€é€£å‡º |
| **NAT å‹å–„åº¦** | è‰¯å¥½ | å¯èƒ½æœ‰å•é¡Œ |
| **å¤±æ•—è™•ç†** | è‡ªå‹•é‡é€£ | éœ€é‡è©¦é‚è¼¯ |
| **æ•ˆèƒ½** | è¼ƒå¥½ï¼ˆç„¡é€£ç·šå»ºç«‹ï¼‰ | æ¯äº‹ä»¶ä¸€æ¬¡ HTTP |
| **è¤‡é›œåº¦** | Client éœ€è™•ç† SSE | Server ç«¯ç°¡å–® |

SSE é©ç”¨ï¼š
- å³æ™‚ç›£æ§é¢æ¿
- ä½å»¶é²éœ€æ±‚

Webhook é©ç”¨ï¼š
- é›²ç«¯æ•´åˆ
- äº‹ä»¶è™•ç†ç³»çµ±
- ç„¡æ³•ç¶­æŒé•·é€£æ¥çš„ç’°å¢ƒ

OpenBMC å¯¦ä½œï¼š
- bmcweb æ”¯æ´å…©ç¨®
- SSE ç”¨ Boost.Beast å¯¦ä½œ
- Webhook ç”¨ libcurl POST

---

### Q15ï¼šD-Bus PropertyChanged Signal å¦‚ä½•è¨‚é–±ï¼Ÿ

**é›£åº¦**ï¼šâ­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šGoogle / Intel

**ç­”æ¡ˆ**ï¼š
```cpp
// C++ è¨‚é–±ç¯„ä¾‹
#include <sdbusplus/bus.hpp>
#include <sdbusplus/bus/match.hpp>

int main()
{
    auto bus = sdbusplus::bus::new_default();
    
    auto match = sdbusplus::bus::match::match(
        bus,
        sdbusplus::bus::match::rules::propertiesChanged(
            "/xyz/openbmc_project/sensors/temperature/CPU0_Temp",
            "xyz.openbmc_project.Sensor.Value"),
        [](sdbusplus::message::message& msg) {
            std::string interface;
            std::map<std::string, std::variant<double>> props;
            msg.read(interface, props);
            
            if (auto it = props.find("Value"); it != props.end())
            {
                double value = std::get<double>(it->second);
                std::cout << "New value: " << value << std::endl;
            }
        });
    
    while (true)
    {
        bus.process_discard();
        bus.wait();
    }
}

// busctl æ¸¬è©¦
busctl monitor xyz.openbmc_project.HwmonTempSensor
```

---

### Q16ï¼šæ·±å…¥æ•™å­¸ SPDM (Security Protocol and Data Model)

**é›£åº¦**ï¼šâ­â­â­â­â­
**å¸¸è¦‹æ–¼**ï¼šNVIDIA / AMD / Server Security Team

**å•é¡Œ**ï¼š
æˆ‘å®Œå…¨ä¸æ‡‚ SPDMï¼Œè«‹å¾é ­æ•™æˆ‘ï¼šå®ƒæ˜¯åšä»€éº¼çš„ï¼Ÿå¦‚ä½•é‹ä½œï¼Ÿä»€éº¼æ˜¯ Measurementï¼Ÿ

**æ¨™æº–ç­”æ¡ˆ**ï¼š
1.  **SPDM æ˜¯ä»€éº¼ï¼Ÿ**
    *   **å…¨å**ï¼šSecurity Protocol and Data Model (DMTF æ¨™æº–)ã€‚
    *   **ä¸€å¥è©±è§£é‡‹**ï¼šå®ƒæ˜¯ã€Œç¡¬é«”å…ƒä»¶çš„èº«åˆ†è­‰æŸ¥é©—èˆ‡å¥åº·æª¢æŸ¥å”å®šã€ã€‚
    *   **åŸæœ¬**ï¼šMCTP åªèƒ½å‚³è¼¸è³‡æ–™ (PLDM/NVMe-MI)ï¼Œä¸çŸ¥é“å°æ–¹æ˜¯èª°ã€‚
    *   **ç¾åœ¨**ï¼šåœ¨å‚³è³‡æ–™å‰ï¼Œå…ˆç”¨ SPDM ç¢ºèªã€Œä½ æ˜¯çœŸçš„ NVIDIA GPU å—ï¼Ÿã€ä¸”ã€Œä½ çš„éŸŒé«”æœ‰æ²’æœ‰è¢«é§­å®¢ç«„æ”¹ï¼Ÿã€ã€‚

2.  **é‹ä½œæµç¨‹ (The SPDM Handshake)**
    BMC (Requester) èˆ‡ Device (Responder) çš„å°è©±æµç¨‹ï¼š

    1.  **VDO (Vendor Defined Object) - é¸ç”¨**
        *   ç¢ºèªå°æ–¹æ˜¯ä¸æ˜¯æˆ‘è¦æ‰¾çš„ä¾›æ‡‰å•†è¨­å‚™ã€‚

    2.  **GET_VERSION (ç‰ˆæœ¬å”å•†)**
        *   BMC: "æˆ‘æ‡‚ SPDM 1.0 å’Œ 1.1ã€‚"
        *   Device: "é‚£æˆ‘å€‘ç”¨ 1.1 æºé€šå§ã€‚"

    3.  **GET_CAPABILITIES (èƒ½åŠ›ç¢ºèª)**
        *   BMC: "ä½ æœƒåŠ å¯†å—ï¼Ÿä½ æœƒç°½ç« å—ï¼Ÿ"
        *   Device: "æˆ‘æœƒ RSA-4096 ç°½ç« ï¼Œä¹Ÿæœƒ AES-256 åŠ å¯†ã€‚"

    4.  **NEGOTIATE_ALGORITHMS (æ¼”ç®—æ³•å”å•†)**
        *   é›™æ–¹ç´„å®šå¥½æ¥ä¸‹ä¾†ç”¨å“ªå€‹ Hash (SHA-384) å’Œ Signature (ECDSA) æ¼”ç®—æ³•ã€‚

    5.  **GET_DIGESTS / GET_CERTIFICATE (æ†‘è­‰äº¤æ›) - èº«åˆ†æŸ¥é©— (Who are you?)**
        *   BMC: "è«‹æŠŠä½ çš„èº«åˆ†è­‰ (Certificate Chain) æ‹¿å‡ºä¾†ã€‚"
        *   Device: å›å‚³ X.509 æ†‘è­‰éˆ (Root CA -> Intermediate CA -> Device Cert)ã€‚
        *   BMC é©—è­‰ï¼šå»æŸ¥ Root CA æ˜¯å¦åœ¨ä¿¡ä»»æ¸…å–®ä¸­ã€‚é©—è­‰é€šé = é€™æ˜¯çœŸå“ã€‚

    6.  **CHALLENGE / RESPONSE (æŒ‘æˆ°æ‡‰ç­”) - æ´»é«”æª¢æ¸¬ (Are you alive?)**
        *   BMC: "é€™æ˜¯ä¸€å€‹éš¨æ©Ÿæ•¸ (Nonce)ï¼Œè«‹ç”¨ä½ çš„ç§é‘°ç°½åå‚³å›ä¾†ã€‚"
        *   Device: ç”¨ç§é‘°ç°½ç«  (Nonce)ã€‚
        *   BMC: ç”¨å…¬é‘°è§£é–‹é©—è­‰ã€‚
        *   **ç›®çš„**ï¼šé˜²æ­¢é‡æ”¾æ”»æ“Š (Replay Attack)ï¼Œè­‰æ˜å°æ–¹çœŸçš„æŒæœ‰ç§é‘°ã€‚

    7.  **GET_MEASUREMENTS (éŸŒé«”æ¸¬é‡) - å¥åº·æª¢æŸ¥ (Are you healthy?)**
        *   BMC: "è«‹å›å ±ä½ ç›®å‰ Firmware çš„ Hash å€¼ (Measurement)ã€‚"
        *   Device: å›å‚³å„éšæ®µéŸŒé«” block çš„ Hash (Signed)ã€‚
        *   BMC: æ‹¿é€™å€‹ Hash å»è·Ÿã€Œé»ƒé‡‘æ¨™æº– (Reference Manifest/RIM)ã€æ¯”å°ã€‚
        *   **çµæœ**ï¼šå¦‚æœ Hash ä¸ç¬¦ï¼Œä»£è¡¨éŸŒé«”è¢«é§­å®¢æ¤å…¥å¾Œé–€ï¼ŒBMC æ‹’çµ•ä½¿ç”¨æ­¤å¡ã€‚

3.  **ç‚ºä»€éº¼éœ€è¦ SPDMï¼Ÿ (CMA / DICE)**
    *   **CMA (Component Measurement and Authentication)**ï¼šç¢ºä¿ä¼ºæœå™¨ä¸Šçš„æ¯ä¸€å¼µå¡ (ç¶²å¡ã€RAIDå¡ã€GPU) éƒ½æ˜¯å¯ä¿¡çš„ã€‚
    *   **ä¾›æ‡‰éˆå®‰å…¨**ï¼šé˜²æ­¢å·¥å» å…§é¬¼å·æ›å‡è²¨ï¼Œæˆ–é‹é€é€”ä¸­è¢«åˆ·å…¥æƒ¡æ„éŸŒé«”ã€‚

---

## âœ… ç« ç¯€å®Œæˆå ±å‘Š

- æª”æ¡ˆï¼š`/04_OpenBMCæ·±åŒ–/é¢è©¦é‡é».md`
- æ“´å……å¾Œè¡Œæ•¸ï¼šç´„ 2500+ è¡Œ
- æ–°å¢å…§å®¹ï¼š
  - âœ… IPMI æ·±å…¥ï¼ˆKCS/BTã€NetFn/CMD å®Œæ•´åˆ—è¡¨ã€OEM Commandï¼‰
  - âœ… Redfish æ·±å…¥ï¼ˆSchemaã€OEM Extensionã€EventServiceã€bmcwebï¼‰
  - âœ… PLDM æ·±å…¥ï¼ˆPDRã€MCTP å°åŒ…ã€Type 2/4 å¯¦ä½œï¼‰
  - âœ… SPDM æ·±å…¥ï¼ˆCertificate Chainã€Measurementã€libspdmï¼‰
  - âœ… é¢è©¦é¡Œåº«æ“´å……è‡³ 15+ é¡Œ
  - âœ… å®Œæ•´çš„ Debug æ–¹æ³•è«–
  - âœ… è‹±æ–‡é¢è©¦æº–å‚™

