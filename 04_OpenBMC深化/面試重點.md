# 🎯 BMC 相關面試重點

> 針對 NVIDIA / AMD / Intel 的 BMC 韌體職位特別準備

---

## 📌 BMC 是什麼？

```
BMC (Baseboard Management Controller) 是伺服器上的獨立管理處理器。

功能：
- 遠端開關機
- 硬體監控（溫度、電壓、風扇）
- 事件記錄（SEL）
- 韌體更新
- 故障診斷
- KVM over IP（遠端控制台）

特點：
- 獨立於主機運行（主機關機時仍可運作）
- 有自己的作業系統（通常是 Linux）
- 透過 I2C、PCIE、LPC 等與主機通訊
```

---

## 🔷 BMC 相關協定

### IPMI

```
IPMI (Intelligent Platform Management Interface)

特點：
- 傳統標準，廣泛支援
- 二進位協定
- NetFn + CMD 定義操作
- 透過 KCS、BT 或 LAN 傳輸

常見 NetFn：
- 0x00: Chassis   (電源控制)
- 0x04: Sensor/Event (感測器)
- 0x06: App       (通用功能)
- 0x0A: Storage   (SEL、FRU)
- 0x2C: OEM       (廠商自定義)

面試可能問：
- 請解釋 IPMI 的架構
- NetFn 和 CMD 是什麼？
- 你用過哪些 IPMI commands？
```

### Redfish

```
Redfish 是 DMTF 制定的現代 RESTful API 標準。

特點：
- JSON 格式
- HTTPS 加密
- 使用標準 HTTP methods (GET/POST/PATCH/DELETE)
- 支援事件訂閱

架構：
/redfish/v1/
├── Systems/            # 主機系統
│   └── system/
│       ├── Processors/
│       ├── Memory/
│       └── EthernetInterfaces/
├── Chassis/            # 機箱
│   └── chassis/
│       ├── Thermal/    # 溫度和風扇
│       └── Power/      # 電源
├── Managers/           # BMC 本身
│   └── bmc/
├── AccountService/     # 帳號管理
└── SessionService/     # 登入

面試可能問：
- Redfish 和 IPMI 的差異？
- 如何用 Redfish 做電源控制？
- 什麼是 EventService？
```

### PLDM

```
PLDM (Platform Level Data Model)

用途：
- BMC 和 Host 之間的通訊
- 韌體更新
- 感測器數據
- BIOS 設定

傳輸層：
- 通常使用 MCTP (Management Component Transport Protocol)
- MCTP 可以跑在 I2C、PCIe、USB 上

OpenBMC 相關工具：
- pldmtool: 命令列工具
- pldmd: PLDM daemon
```

### SPDM

```
SPDM (Security Protocol and Data Model)

用途：
- 元件身份驗證
- 安全通訊
- 用於 supply chain security

流程：
1. GET_VERSION
2. GET_CAPABILITIES
3. NEGOTIATE_ALGORITHMS
4. GET_DIGESTS
5. GET_CERTIFICATE
6. CHALLENGE (驗證身份)
```

---

## 🔷 BMC 常見硬體知識

### BMC SoC

```
常見 BMC 晶片：

ASPEED：
- AST2500: 較舊，ARM926EJ-S
- AST2600: 較新，ARM Cortex-A7
- 台灣公司，市佔率高

Nuvoton：
- NPCM750: ARM Cortex-A9
- NPCM845: 較新

面試可能問：
- 你們用哪款 BMC 晶片？
- AST2500 和 AST2600 有什麼差異？
```

### 連接介面

```
BMC 和外界的連接：

對外：
- Ethernet (dedicated or shared)
- USB (virtual media)
- Serial (SOL)

對內（和主機/其他元件）：
- I2C/SMBus: 感測器、EEPROM
- LPC: 和 Host 通訊
- PCIe: 高速通訊（新的 AST2600 支援）
- GPIO: 簡單控制訊號
- UART: Debug console, SOL
- JTAG: Debug
```

---

## 📝 常見 BMC 面試問題

**Q1：什麼是 BMC？為什麼需要它？**
```
BMC (Baseboard Management Controller) 是伺服器的獨立管理處理器。

為什麼需要：
1. 即使主機關機也能遠端管理
2. 監控硬體健康狀態
3. 提供故障診斷和回復機制
4. 支援大規模數據中心的自動化管理

BMC 讓管理者不需要實體接觸伺服器就能進行管理操作。
```

**Q2：你在 OpenBMC 中做過什麼？**
```
準備 2-3 個具體的專案案例，用 STAR 法則回答。

範例：
「我負責實作 XXX sensor 的支援。首先研究了 datasheet，
設定了 I2C device tree node 和 hwmon 配置，
然後驗證 D-Bus 上可以正確讀取數值。
遇到 sensor 數值不穩定的問題，經過分析發現是 I2C noise，
加了 retry 機制後解決。」
```

**Q3：如何 debug BMC 上的問題？**
```
1. 日誌分析：
   - journalctl -f
   - dmesg

2. D-Bus 檢查：
   - busctl list
   - busctl introspect

3. 硬體層級：
   - i2cdetect / i2cget / i2cset
   - devmem (讀暫存器)
   - 示波器/邏輯分析儀

4. 網路問題：
   - ping, tcpdump, wireshark

5. 服務狀態：
   - systemctl status
```

**Q4：IPMI 和 Redfish 的差異？**
```
IPMI：
- 較舊標準（1998年）
- 二進位協定
- 安全性較弱
- 功能較固定

Redfish：
- 現代標準（2015年）
- RESTful JSON API
- HTTPS 加密
- 擴展性好、文件清楚

趨勢：
- 新系統以 Redfish 為主
- IPMI 保持向後相容
```

**Q5：如何處理 sensor 讀取問題？**
```
Debug 步驟：

1. 確認硬體連接
   - i2cdetect 看 device 有沒有出現
   
2. 確認 driver 載入
   - lsmod, dmesg

3. 確認 sysfs 
   - cat /sys/class/hwmon/hwmonX/temp1_input

4. 確認 D-Bus
   - busctl get-property ...

5. 確認 Redfish/IPMI
   - curl Redfish API
   - ipmitool sensor list

逐層排查，找出問題點。
```

**Q6：什麼是 Secure Boot？BMC 如何實現？**
```
Secure Boot 確保只有經過簽章驗證的程式碼才能執行。

BMC Secure Boot 流程：
1. Boot ROM 驗證 SPL/U-Boot
2. U-Boot 驗證 Kernel (FIT image)
3. Kernel 驗證 rootfs (可選)

實作方式：
- 使用非對稱加密（RSA/ECDSA）
- 公鑰燒錄在 OTP (One-Time Programmable) 記憶體
- 每一層都驗證下一層的簽章

OpenBMC 支援通過 Phosphor-software-manager 進行簽章驗證。
```

---

## 🔷 NVIDIA/AMD 特定問題準備

### NVIDIA

```
NVIDIA 的 BMC 相關：

產品：
- DGX 系列（AI 伺服器）
- HGX 平台

特色：
- GPU 溫度和功率監控
- NVLink 狀態監控
- GPU 錯誤處理

你應該知道：
- GPU thermal throttling
- nvidia-smi 工具（Host 端）
- BMC 如何和 GPU 互動（I2C/SMBus）
```

### AMD

```
AMD 的 BMC 相關：

產品：
- EPYC 伺服器

特色：
- 強調安全（Secure Boot, RoT）
- SPDM 支援

你應該知道：
- AMD PSP (Platform Security Processor)
- SPI ROM 保護機制
```

---

## ✅ 面試前檢查清單

```
BMC 基礎：
☐ 能解釋 BMC 是什麼
☐ 知道 BMC 常見功能
☐ 了解 BMC 硬體架構

協定知識：
☐ 能解釋 IPMI 和 Redfish
☐ 知道 PLDM/MCTP 的用途
☐ 了解 Secure Boot 概念

OpenBMC 相關：
☐ 能畫 OpenBMC 架構圖
☐ 知道 D-Bus 如何運作
☐ 會使用 busctl
☐ 準備好專案經驗

Debug 能力：
☐ 知道如何追蹤問題
☐ 會用 i2c-tools
☐ 會看 journalctl
```
