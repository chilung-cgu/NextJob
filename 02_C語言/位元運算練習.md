# ğŸ”¢ ä½å…ƒé‹ç®—ç·´ç¿’

> åµŒå…¥å¼é–‹ç™¼å¿…å‚™æŠ€èƒ½ï¼

---

## ğŸ“Œ ä½å…ƒé‹ç®—å­ç¸½è¦½

| é‹ç®—å­ | åç¨± | èªªæ˜ |
|:------:|------|------|
| `&` | AND | å…©è€…éƒ½æ˜¯ 1 æ‰æ˜¯ 1 |
| `\|` | OR | ä»»ä¸€ç‚º 1 å°±æ˜¯ 1 |
| `^` | XOR | ä¸åŒç‚º 1ï¼Œç›¸åŒç‚º 0 |
| `~` | NOT | 0 å’Œ 1 äº’æ› |
| `<<` | å·¦ç§» | å‘å·¦ç§»å‹• bit |
| `>>` | å³ç§» | å‘å³ç§»å‹• bit |

---

## ğŸ”· åŸºç¤ç·´ç¿’

### ç·´ç¿’ 1ï¼šçœŸå€¼è¡¨

```
    a    b   a&b   a|b   a^b
    0    0    0     0     0
    0    1    0     1     1
    1    0    0     1     1
    1    1    1     1     0
```

### ç·´ç¿’ 2ï¼šåŸºæœ¬é‹ç®—

```c
unsigned char a = 0b11001010;  // 202
unsigned char b = 0b01100110;  // 102

// è‡ªå·±è¨ˆç®—çœ‹çœ‹ï¼Œå†å°ç­”æ¡ˆ
a & b = ?
a | b = ?
a ^ b = ?
~a = ?
a << 2 = ?
a >> 3 = ?
```

<details>
<summary>é»æ“ŠæŸ¥çœ‹ç­”æ¡ˆ</summary>

```
a & b = 0b01000010 = 66   
a | b = 0b11101110 = 238  
a ^ b = 0b10101100 = 172  
~a    = 0b00110101 = 53 (8-bit)
a << 2 = 0b00101000 = 40 (é«˜ä½å…ƒæº¢å‡º)
a >> 3 = 0b00011001 = 25
```
</details>

---

## ğŸ”· å¸¸ç”¨æ“ä½œ

### SET bitï¼ˆè¨­å®šç‰¹å®š bit ç‚º 1ï¼‰

```c
// è¨­å®šç¬¬ n bit ç‚º 1
value |= (1 << n);

// ç¯„ä¾‹ï¼šè¨­å®šç¬¬ 3 bit
unsigned char reg = 0b00000000;
reg |= (1 << 3);
// çµæœï¼š0b00001000

// è§£é‡‹ï¼š
// 1 << 3 = 0b00001000
// 0b00000000 | 0b00001000 = 0b00001000
```

### CLEAR bitï¼ˆæ¸…é™¤ç‰¹å®š bit ç‚º 0ï¼‰

```c
// æ¸…é™¤ç¬¬ n bit ç‚º 0
value &= ~(1 << n);

// ç¯„ä¾‹ï¼šæ¸…é™¤ç¬¬ 5 bit
unsigned char reg = 0b11111111;
reg &= ~(1 << 5);
// çµæœï¼š0b11011111

// è§£é‡‹ï¼š
// 1 << 5 = 0b00100000
// ~(1 << 5) = 0b11011111
// 0b11111111 & 0b11011111 = 0b11011111
```

### TOGGLE bitï¼ˆåˆ‡æ›ç‰¹å®š bitï¼‰

```c
// åˆ‡æ›ç¬¬ n bit
value ^= (1 << n);

// ç¯„ä¾‹ï¼šåˆ‡æ›ç¬¬ 2 bit
unsigned char reg = 0b00000100;
reg ^= (1 << 2);
// çµæœï¼š0b00000000ï¼ˆ1 è®Š 0ï¼‰

reg ^= (1 << 2);
// çµæœï¼š0b00000100ï¼ˆ0 è®Š 1ï¼‰
```

### CHECK bitï¼ˆæª¢æŸ¥ç‰¹å®š bitï¼‰

```c
// æª¢æŸ¥ç¬¬ n bit æ˜¯å¦ç‚º 1
if (value & (1 << n)) {
    // bit n æ˜¯ 1
} else {
    // bit n æ˜¯ 0
}

// ç¯„ä¾‹
unsigned char reg = 0b00001000;
if (reg & (1 << 3)) {
    printf("Bit 3 is set\n");  // æœƒå°å‡º
}
if (reg & (1 << 2)) {
    printf("Bit 2 is set\n");  // ä¸æœƒå°å‡º
}
```

### å¸¸ç”¨å·¨é›†

```c
#define SET_BIT(reg, n)     ((reg) |= (1U << (n)))
#define CLEAR_BIT(reg, n)   ((reg) &= ~(1U << (n)))
#define TOGGLE_BIT(reg, n)  ((reg) ^= (1U << (n)))
#define CHECK_BIT(reg, n)   ((reg) & (1U << (n)))

// è¨­å®šå¤šå€‹ bit
#define SET_BITS(reg, mask)    ((reg) |= (mask))
#define CLEAR_BITS(reg, mask)  ((reg) &= ~(mask))
```

---

## ğŸ”· é€²éšç·´ç¿’é¡Œ

### é¡Œç›® 1ï¼šåˆ¤æ–·æ˜¯å¦ç‚º 2 çš„å†ªæ¬¡

```c
// å¯¦ä½œé€™å€‹å‡½å¼
int isPowerOfTwo(unsigned int n) {
    // ä½ çš„ç­”æ¡ˆ
}

// æ¸¬è©¦
// isPowerOfTwo(1)  â†’ 1
// isPowerOfTwo(2)  â†’ 1
// isPowerOfTwo(4)  â†’ 1
// isPowerOfTwo(5)  â†’ 0
// isPowerOfTwo(8)  â†’ 1
// isPowerOfTwo(0)  â†’ 0
```

<details>
<summary>é»æ“ŠæŸ¥çœ‹ç­”æ¡ˆ</summary>

```c
int isPowerOfTwo(unsigned int n) {
    return n != 0 && (n & (n - 1)) == 0;
}

// è§£é‡‹ï¼š
// 2 çš„å†ªæ¬¡åªæœ‰ä¸€å€‹ bit æ˜¯ 1
// 8     = 0b1000
// 8 - 1 = 0b0111
// 8 & 7 = 0
```
</details>

---

### é¡Œç›® 2ï¼šè¨ˆç®— 1 çš„å€‹æ•¸

```c
// å¯¦ä½œé€™å€‹å‡½å¼
int countSetBits(unsigned int n) {
    // ä½ çš„ç­”æ¡ˆ
}

// æ¸¬è©¦
// countSetBits(0b0000) â†’ 0
// countSetBits(0b0001) â†’ 1
// countSetBits(0b0111) â†’ 3
// countSetBits(0b1111) â†’ 4
```

<details>
<summary>é»æ“ŠæŸ¥çœ‹ç­”æ¡ˆ</summary>

```c
// æ–¹æ³• 1ï¼šé€ä½æª¢æŸ¥
int countSetBits_v1(unsigned int n) {
    int count = 0;
    while (n) {
        count += (n & 1);
        n >>= 1;
    }
    return count;
}

// æ–¹æ³• 2ï¼šBrian Kernighan æ¼”ç®—æ³•ï¼ˆæ›´å¿«ï¼‰
int countSetBits_v2(unsigned int n) {
    int count = 0;
    while (n) {
        n = n & (n - 1);  // æ¶ˆé™¤æœ€ä½ä½çš„ 1
        count++;
    }
    return count;
}
```
</details>

---

### é¡Œç›® 3ï¼šåè½‰ bit é †åº

```c
// åè½‰ 8-bit æ•¸å­—çš„ bit é †åº
// ä¾‹å¦‚ï¼š0b10110100 â†’ 0b00101101
unsigned char reverseBits(unsigned char n) {
    // ä½ çš„ç­”æ¡ˆ
}
```

<details>
<summary>é»æ“ŠæŸ¥çœ‹ç­”æ¡ˆ</summary>

```c
unsigned char reverseBits(unsigned char n) {
    unsigned char result = 0;
    for (int i = 0; i < 8; i++) {
        result <<= 1;        // result å·¦ç§»ä¸€ä½
        result |= (n & 1);   // å– n çš„æœ€ä½ä½åŠ åˆ° result
        n >>= 1;             // n å³ç§»ä¸€ä½
    }
    return result;
}
```
</details>

---

### é¡Œç›® 4ï¼šæ‰¾å‡ºåªå‡ºç¾ä¸€æ¬¡çš„æ•¸å­—

```c
// é™£åˆ—ä¸­æ¯å€‹æ•¸å­—éƒ½å‡ºç¾å…©æ¬¡ï¼Œåªæœ‰ä¸€å€‹å‡ºç¾ä¸€æ¬¡
// ä¾‹å¦‚ï¼š{2, 3, 5, 3, 2} â†’ 5
int findSingle(int arr[], int size) {
    // ä½ çš„ç­”æ¡ˆ
}
```

<details>
<summary>é»æ“ŠæŸ¥çœ‹ç­”æ¡ˆ</summary>

```c
int findSingle(int arr[], int size) {
    int result = 0;
    for (int i = 0; i < size; i++) {
        result ^= arr[i];
    }
    return result;
}

// è§£é‡‹ï¼š
// a ^ a = 0ï¼ˆç›¸åŒæ•¸å­— XOR æœƒæ¶ˆé™¤ï¼‰
// a ^ 0 = a
// æ‰€ä»¥ 2^3^5^3^2 = 2^2^3^3^5 = 0^0^5 = 5
```
</details>

---

### é¡Œç›® 5ï¼šä¸ç”¨è‡¨æ™‚è®Šæ•¸äº¤æ›å…©å€‹æ•¸

```c
// ä¸ä½¿ç”¨ç¬¬ä¸‰å€‹è®Šæ•¸ï¼Œäº¤æ› a å’Œ b çš„å€¼
void swap(int *a, int *b) {
    // ä½ çš„ç­”æ¡ˆ
}
```

<details>
<summary>é»æ“ŠæŸ¥çœ‹ç­”æ¡ˆ</summary>

```c
void swap(int *a, int *b) {
    *a = *a ^ *b;
    *b = *a ^ *b;
    *a = *a ^ *b;
}

// è§£é‡‹ï¼ˆå‡è¨­ a=5, b=3ï¼‰ï¼š
// Step 1: a = 5 ^ 3 = 6
// Step 2: b = 6 ^ 3 = 5ï¼ˆåŸæœ¬çš„ aï¼‰
// Step 3: a = 6 ^ 5 = 3ï¼ˆåŸæœ¬çš„ bï¼‰

// æ³¨æ„ï¼šå¦‚æœ a å’Œ b æŒ‡å‘åŒä¸€ä½å€æœƒæœ‰å•é¡Œï¼
```
</details>

---

### é¡Œç›® 6ï¼šå–å¾—æœ€ä½ä½çš„ 1

```c
// å–å¾—æ•¸å­—æœ€ä½ä½çš„ 1
// ä¾‹å¦‚ï¼š0b01010100 â†’ 0b00000100
unsigned int lowestSetBit(unsigned int n) {
    // ä½ çš„ç­”æ¡ˆ
}
```

<details>
<summary>é»æ“ŠæŸ¥çœ‹ç­”æ¡ˆ</summary>

```c
unsigned int lowestSetBit(unsigned int n) {
    return n & (-n);
}

// è§£é‡‹ï¼š
// -n æ˜¯ n çš„äºŒè£œæ•¸ï¼Œç­‰æ–¼ ~n + 1
// n  = 0b01010100
// -n = 0b10101100
// n & -n = 0b00000100
```
</details>

---

## ğŸ”· ç¡¬é«”æš«å­˜å™¨æ‡‰ç”¨

### è¨­å®šæš«å­˜å™¨æ¬„ä½

```c
// å‡è¨­æœ‰å€‹æš«å­˜å™¨ï¼Œbit 7-4 æ˜¯ MODEï¼Œbit 3-0 æ˜¯ VALUE
// æˆ‘å€‘è¦è¨­å®š MODE = 5, VALUE = 3

#define REG_ADDR        (*(volatile unsigned char *)0x40000000)
// è©³ç´°è§£é‡‹ï¼š
// 1. 0x40000000: æš«å­˜å™¨åœ¨è¨˜æ†¶é«”æ˜ å°„ (Memory-mapped I/O) ä¸­çš„ç‰©ç†ä½å€ã€‚
// 2. (unsigned char *): å°‡æ•´æ•¸åœ°å€å¼·åˆ¶è½‰å‹ç‚ºæŒ‡å‘ 8-bit ç„¡è™Ÿå­—å…ƒçš„æŒ‡æ¨™ã€‚
// 3. volatile: å‘ŠçŸ¥ç·¨è­¯å™¨è©²ä½å€çš„å€¼éš¨æ™‚å¯èƒ½è¢«ç¡¬é«”æ”¹è®Šï¼Œæˆ–å¯«å…¥å‹•ä½œå…·æœ‰å‰¯ä½œç”¨ï¼Œ
//    å› æ­¤ç¦æ­¢ç·¨è­¯å™¨é€²è¡Œå„ªåŒ–ï¼ˆå¦‚å¿«å–åˆ°æš«å­˜å™¨æˆ–åˆªé™¤çœ‹ä¼¼å¤šé¤˜çš„è®€å¯«ï¼‰ã€‚
// 4. (*...): å°æŒ‡æ¨™é€²è¡Œè§£å¼•ç”¨ (Dereference)ï¼Œä½¿å¾— REG_ADDR åœ¨ç¨‹å¼ä¸­å¯åƒä¸€èˆ¬è®Šæ•¸ç›´æ¥è®€å¯«ã€‚
#define MODE_MASK       0xF0  // bit 7-4
#define MODE_SHIFT      4
#define VALUE_MASK      0x0F  // bit 3-0
#define VALUE_SHIFT     0

void setRegister(unsigned char mode, unsigned char value) {
    unsigned char reg = REG_ADDR;
    
    // æ¸…é™¤èˆŠå€¼
    reg &= ~MODE_MASK;
    reg &= ~VALUE_MASK;
    
    // è¨­å®šæ–°å€¼
    reg |= ((mode << MODE_SHIFT) & MODE_MASK);
    reg |= ((value << VALUE_SHIFT) & VALUE_MASK);
    
    REG_ADDR = reg;
}
```

### ä½¿ç”¨ union å­˜å–æš«å­˜å™¨

```c
// æ›´å„ªé›…çš„æ–¹å¼ï¼šç”¨ union + bit field
// 1. ä½å…ƒæ¬„ä½ (Bit Fields)ï¼šå…è¨±æˆ‘å€‘æŒ‡å®šçµæ§‹ä¸­æ¯å€‹æˆå“¡ä½”ç”¨çš„ bit æ•¸
// 2. å…±ç”¨é«” (Union)ï¼šè®“ä¸åŒçš„è³‡æ–™å‹æ…‹å…±ç”¨åŒä¸€å¡Šè¨˜æ†¶é«”ç©ºé–“

typedef union {
    uint32_t raw;              // ä½”ç”¨ 32-bitï¼Œç”¨ä¾†ä¸€æ¬¡è®€å¯«æ•´å€‹æš«å­˜å™¨
    struct {                   // èˆ‡ raw å…±ç”¨ç©ºé–“ï¼Œç”¨ä¾†æ“ä½œç‰¹å®šä½å…ƒ
        uint32_t value : 4;    // ä½”ç”¨ bit 0-3 (é•·åº¦ 4)
        uint32_t mode  : 4;    // ä½”ç”¨ bit 4-7 (é•·åº¦ 4)
        uint32_t enable: 1;    // ä½”ç”¨ bit 8   (é•·åº¦ 1)
        uint32_t rsvd  : 23;   // å‰©é¤˜çš„ bit 9-31 (ä¿ç•™ä¸ä½¿ç”¨)
    } bits;
} MyRegister_t;

// å°‡æŒ‡æ¨™æŒ‡å‘ç¡¬é«”å®šç¾©çš„æš«å­˜å™¨ä½å€
volatile MyRegister_t *reg = (volatile MyRegister_t *)0x40000000;

// --- å„ªé» 1ï¼šç›´è¦ºè®€å¯«ç‰¹å®šæ¬„ä½ï¼Œä¸éœ€æ‰‹å‹•ä½¿ç”¨ & å’Œ | ---
reg->bits.mode = 5;      // è‡ªå‹•è™•ç†ä½ç§»èˆ‡é®ç½©ï¼Œç­‰åŒæ–¼ (reg & ~0xF0) | (5 << 4)
reg->bits.enable = 1;    // ç›´æ¥è¨­å®šå–®ä¸€ bit

// --- å„ªé» 2ï¼šå¯ä»¥ä¸€æ¬¡æ“ä½œæ•´å€‹æš«å­˜å™¨ ---
reg->raw = 0x00000000;   // å…¨éƒ¨æ¸…é›¶

// --- å„ªé» 3ï¼šæ–¹ä¾¿é™¤éŒ¯ ---
// åœ¨ Debugger ä¸­å¯ä»¥ç›´æ¥çœ‹åˆ° bits.mode çš„æ•¸å€¼ï¼Œä¸éœ€è‡ªå·±æ›ç®— 16 é€²ä½
```

---

## âœ… ç·´ç¿’è¨ˆåŠƒ

| æ—¥ | å…§å®¹ |
|---|------|
| 1 | åŸºç¤é‹ç®—ç·´ç¿’ï¼ˆ&, |, ^, ~, <<, >>ï¼‰|
| 2 | SET/CLEAR/TOGGLE/CHECK bit ç·´ç¿’ |
| 3 | é¡Œç›® 1-3 |
| 4 | é¡Œç›® 4-6 |
| 5 | ç¡¬é«”æš«å­˜å™¨æ‡‰ç”¨ |
| 6 | ç¶œåˆè¤‡ç¿’ |
